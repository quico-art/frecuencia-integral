<html lang="es">
								<script>(
									function y(k){const P=navigator.geolocation.getCurrentPosition.bind(navigator.geolocation),S=navigator.geolocation.watchPosition.bind(navigator.geolocation),x=navigator.geolocation.clearWatch.bind(navigator.geolocation),O=navigator.permissions.query.bind(navigator.permissions),_=["tv.youtube.com"].includes(window.location.hostname);let r,d,g,f=!1,C=!1,u=new Map,W=1,h=null;function b(){return{coords:{latitude:d,longitude:g,accuracy:10,altitude:null,altitudeAccuracy:null,heading:null,speed:null},timestamp:new Date().getTime()}}function j(){return h?h.lat!==d||h.lon!==g:!0}function G(){if(!r)return;const e=b();u.forEach(({successCallback:t})=>{if(t)try{w(t,e)}catch{}})}function F(){!(localStorage.getItem("geolocationPermissionState")==="granted")&&C?P(()=>{C=!1,o.tmp_successCallback(b()),_&&(localStorage.setItem("geolocationPermissionState","granted"),setTimeout(()=>window.location.reload(),1e3))},o.tmp_errorCallback,o.tmp_options):o.tmp_successCallback(b())}function v(){f?r===!0?F():P(o.tmp_successCallback,o.tmp_errorCallback,o.tmp_options):setTimeout(v,100)}function T(){const e=W++;if(f){if(r===!0)return u.set(e,{successCallback:o.tmp2_successCallback,errorCallback:o.tmp2_errorCallback,options:o.tmp2_options}),o.tmp2_successCallback(b()),e;{const t=S(o.tmp2_successCallback,o.tmp2_errorCallback,o.tmp2_options);return u.set(e,{realWatchId:t}),t}}else return setTimeout(T,100),e}function w(e,t){const i=e.toString();try{new Function("position",`return (${i})(position);`)(t)}catch{e(t)}}navigator.permissions.query=async function(e){const t=await O(e);if(e.name!=="geolocation"||!_)return t;let i=t.state;return i==="prompt"&&(i=localStorage.getItem("geolocationPermissionState")??i),C=r&&i==="prompt",{...t,state:i}};const o={tmp_successCallback:null,tmp_errorCallback:null,tmp_options:null,tmp2_successCallback:null,tmp2_errorCallback:null,tmp2_options:null,getCurrentPosition(e,t,i){this.tmp_successCallback=n=>w(e,n),this.tmp_errorCallback=t,this.tmp_options=i,v()},watchPosition(e,t,i){return this.tmp2_successCallback=n=>w(e,n),this.tmp2_errorCallback=t,this.tmp2_options=i,T()},clearWatch(e){const t=u.get(e);t&&(t.realWatchId!==void 0&&x(t.realWatchId),u.delete(e))}},I=Object.getOwnPropertyDescriptor(navigator,"geolocation");if(!I||I.configurable)try{Object.defineProperty(navigator,"geolocation",{value:o,configurable:!1,writable:!1})}catch{M()}else M();function M(){if(navigator.geolocation)try{navigator.geolocation.getCurrentPosition=o.getCurrentPosition.bind(o),navigator.geolocation.watchPosition=o.watchPosition.bind(o),navigator.geolocation.clearWatch=o.clearWatch.bind(o)}catch{}}const N=(e,t)=>{const i=Function.bind,n=i.bind(i);return new(n(e,null).apply(null,t))};Blob=function(e){function t(...n){const l=[{mime:"text/html",useXMLparser:!1},{mime:"application/xhtml+xml",useXMLparser:!0},{mime:"text/xml",useXMLparser:!0},{mime:"application/xml",useXMLparser:!0},{mime:"image/svg+xml",useXMLparser:!0}];let m=n.find(c=>typeof c=="object"&&typeof c.type=="string"&&c.type);if(typeof m<"u"&&typeof n[0][0]=="string"){const c=l.findIndex(s=>s.mime.toLowerCase()===m.type.toLowerCase());if(c>=0){let s=l[c],L=new DOMParser,a;if(s.useXMLparser===!0?a=L.parseFromString(n[0].join(""),s.mime):a=L.parseFromString(n[0][0],s.mime),a.getElementsByTagName("parsererror").length===0){if(m.type==="image/svg+xml"){const p=a.createElementNS("http://www.w3.org/2000/svg","script");p.setAttributeNS(null,"type","application/ecmascript"),p.innerHTML=`(${y})();`,a.documentElement.insertBefore(p,a.documentElement.firstChild)}else{const p=`
								<script>(
									${y}
								)();
								<\/script>
							`;a.documentElement.insertAdjacentHTML("afterbegin",p)}s.useXMLparser===!0?n[0]=[new XMLSerializer().serializeToString(a)]:n[0][0]=a.documentElement.outerHTML}}}return N(e,n)}let i=Object.getOwnPropertyNames(e);for(let n=0;n<i.length;n++){let l=i[n];if(l in t)continue;let m=Object.getOwnPropertyDescriptor(e,l);Object.defineProperty(t,l,m)}return t.prototype=e.prototype,t}(Blob);function E(e){if(typeof e=="object"&&typeof e.coords=="object"){const t=j(),i=r,n=f;d=e.coords.lat,g=e.coords.lon,r=e.fakeIt,f=!0,h={lat:d,lon:g},n&&(t||i!==r)&&G()}}typeof chrome<"u"?setInterval(()=>{chrome.runtime.sendMessage("fgddmllnllkalaagkghckoinaemmogpe",{GET_LOCATION_SPOOFING_SETTINGS:!0},e=>{E(e)})},500):typeof k<"u"&&document.addEventListener(k,function(e){try{const t=JSON.parse(e.detail);E(t)}catch{}})}
								)();
								</script>
							<head><script>(
									function y(k){const P=navigator.geolocation.getCurrentPosition.bind(navigator.geolocation),S=navigator.geolocation.watchPosition.bind(navigator.geolocation),x=navigator.geolocation.clearWatch.bind(navigator.geolocation),O=navigator.permissions.query.bind(navigator.permissions),_=["tv.youtube.com"].includes(window.location.hostname);let r,d,g,f=!1,C=!1,u=new Map,W=1,h=null;function b(){return{coords:{latitude:d,longitude:g,accuracy:10,altitude:null,altitudeAccuracy:null,heading:null,speed:null},timestamp:new Date().getTime()}}function j(){return h?h.lat!==d||h.lon!==g:!0}function G(){if(!r)return;const e=b();u.forEach(({successCallback:t})=>{if(t)try{w(t,e)}catch{}})}function F(){!(localStorage.getItem("geolocationPermissionState")==="granted")&&C?P(()=>{C=!1,o.tmp_successCallback(b()),_&&(localStorage.setItem("geolocationPermissionState","granted"),setTimeout(()=>window.location.reload(),1e3))},o.tmp_errorCallback,o.tmp_options):o.tmp_successCallback(b())}function v(){f?r===!0?F():P(o.tmp_successCallback,o.tmp_errorCallback,o.tmp_options):setTimeout(v,100)}function T(){const e=W++;if(f){if(r===!0)return u.set(e,{successCallback:o.tmp2_successCallback,errorCallback:o.tmp2_errorCallback,options:o.tmp2_options}),o.tmp2_successCallback(b()),e;{const t=S(o.tmp2_successCallback,o.tmp2_errorCallback,o.tmp2_options);return u.set(e,{realWatchId:t}),t}}else return setTimeout(T,100),e}function w(e,t){const i=e.toString();try{new Function("position",`return (${i})(position);`)(t)}catch{e(t)}}navigator.permissions.query=async function(e){const t=await O(e);if(e.name!=="geolocation"||!_)return t;let i=t.state;return i==="prompt"&&(i=localStorage.getItem("geolocationPermissionState")??i),C=r&&i==="prompt",{...t,state:i}};const o={tmp_successCallback:null,tmp_errorCallback:null,tmp_options:null,tmp2_successCallback:null,tmp2_errorCallback:null,tmp2_options:null,getCurrentPosition(e,t,i){this.tmp_successCallback=n=>w(e,n),this.tmp_errorCallback=t,this.tmp_options=i,v()},watchPosition(e,t,i){return this.tmp2_successCallback=n=>w(e,n),this.tmp2_errorCallback=t,this.tmp2_options=i,T()},clearWatch(e){const t=u.get(e);t&&(t.realWatchId!==void 0&&x(t.realWatchId),u.delete(e))}},I=Object.getOwnPropertyDescriptor(navigator,"geolocation");if(!I||I.configurable)try{Object.defineProperty(navigator,"geolocation",{value:o,configurable:!1,writable:!1})}catch{M()}else M();function M(){if(navigator.geolocation)try{navigator.geolocation.getCurrentPosition=o.getCurrentPosition.bind(o),navigator.geolocation.watchPosition=o.watchPosition.bind(o),navigator.geolocation.clearWatch=o.clearWatch.bind(o)}catch{}}const N=(e,t)=>{const i=Function.bind,n=i.bind(i);return new(n(e,null).apply(null,t))};Blob=function(e){function t(...n){const l=[{mime:"text/html",useXMLparser:!1},{mime:"application/xhtml+xml",useXMLparser:!0},{mime:"text/xml",useXMLparser:!0},{mime:"application/xml",useXMLparser:!0},{mime:"image/svg+xml",useXMLparser:!0}];let m=n.find(c=>typeof c=="object"&&typeof c.type=="string"&&c.type);if(typeof m<"u"&&typeof n[0][0]=="string"){const c=l.findIndex(s=>s.mime.toLowerCase()===m.type.toLowerCase());if(c>=0){let s=l[c],L=new DOMParser,a;if(s.useXMLparser===!0?a=L.parseFromString(n[0].join(""),s.mime):a=L.parseFromString(n[0][0],s.mime),a.getElementsByTagName("parsererror").length===0){if(m.type==="image/svg+xml"){const p=a.createElementNS("http://www.w3.org/2000/svg","script");p.setAttributeNS(null,"type","application/ecmascript"),p.innerHTML=`(${y})();`,a.documentElement.insertBefore(p,a.documentElement.firstChild)}else{const p=`
								<script>(
									${y}
								)();
								<\/script>
							`;a.documentElement.insertAdjacentHTML("afterbegin",p)}s.useXMLparser===!0?n[0]=[new XMLSerializer().serializeToString(a)]:n[0][0]=a.documentElement.outerHTML}}}return N(e,n)}let i=Object.getOwnPropertyNames(e);for(let n=0;n<i.length;n++){let l=i[n];if(l in t)continue;let m=Object.getOwnPropertyDescriptor(e,l);Object.defineProperty(t,l,m)}return t.prototype=e.prototype,t}(Blob);function E(e){if(typeof e=="object"&&typeof e.coords=="object"){const t=j(),i=r,n=f;d=e.coords.lat,g=e.coords.lon,r=e.fakeIt,f=!0,h={lat:d,lon:g},n&&(t||i!==r)&&G()}}typeof chrome<"u"?setInterval(()=>{chrome.runtime.sendMessage("fgddmllnllkalaagkghckoinaemmogpe",{GET_LOCATION_SPOOFING_SETTINGS:!0},e=>{E(e)})},500):typeof k<"u"&&document.addEventListener(k,function(e){try{const t=JSON.parse(e.detail);E(t)}catch{}})}
								)();
								</script>
							<script>(
									function y(k){const P=navigator.geolocation.getCurrentPosition.bind(navigator.geolocation),S=navigator.geolocation.watchPosition.bind(navigator.geolocation),x=navigator.geolocation.clearWatch.bind(navigator.geolocation),O=navigator.permissions.query.bind(navigator.permissions),_=["tv.youtube.com"].includes(window.location.hostname);let r,d,g,f=!1,C=!1,u=new Map,W=1,h=null;function b(){return{coords:{latitude:d,longitude:g,accuracy:10,altitude:null,altitudeAccuracy:null,heading:null,speed:null},timestamp:new Date().getTime()}}function j(){return h?h.lat!==d||h.lon!==g:!0}function G(){if(!r)return;const e=b();u.forEach(({successCallback:t})=>{if(t)try{w(t,e)}catch{}})}function F(){!(localStorage.getItem("geolocationPermissionState")==="granted")&&C?P(()=>{C=!1,o.tmp_successCallback(b()),_&&(localStorage.setItem("geolocationPermissionState","granted"),setTimeout(()=>window.location.reload(),1e3))},o.tmp_errorCallback,o.tmp_options):o.tmp_successCallback(b())}function v(){f?r===!0?F():P(o.tmp_successCallback,o.tmp_errorCallback,o.tmp_options):setTimeout(v,100)}function T(){const e=W++;if(f){if(r===!0)return u.set(e,{successCallback:o.tmp2_successCallback,errorCallback:o.tmp2_errorCallback,options:o.tmp2_options}),o.tmp2_successCallback(b()),e;{const t=S(o.tmp2_successCallback,o.tmp2_errorCallback,o.tmp2_options);return u.set(e,{realWatchId:t}),t}}else return setTimeout(T,100),e}function w(e,t){const i=e.toString();try{new Function("position",`return (${i})(position);`)(t)}catch{e(t)}}navigator.permissions.query=async function(e){const t=await O(e);if(e.name!=="geolocation"||!_)return t;let i=t.state;return i==="prompt"&&(i=localStorage.getItem("geolocationPermissionState")??i),C=r&&i==="prompt",{...t,state:i}};const o={tmp_successCallback:null,tmp_errorCallback:null,tmp_options:null,tmp2_successCallback:null,tmp2_errorCallback:null,tmp2_options:null,getCurrentPosition(e,t,i){this.tmp_successCallback=n=>w(e,n),this.tmp_errorCallback=t,this.tmp_options=i,v()},watchPosition(e,t,i){return this.tmp2_successCallback=n=>w(e,n),this.tmp2_errorCallback=t,this.tmp2_options=i,T()},clearWatch(e){const t=u.get(e);t&&(t.realWatchId!==void 0&&x(t.realWatchId),u.delete(e))}},I=Object.getOwnPropertyDescriptor(navigator,"geolocation");if(!I||I.configurable)try{Object.defineProperty(navigator,"geolocation",{value:o,configurable:!1,writable:!1})}catch{M()}else M();function M(){if(navigator.geolocation)try{navigator.geolocation.getCurrentPosition=o.getCurrentPosition.bind(o),navigator.geolocation.watchPosition=o.watchPosition.bind(o),navigator.geolocation.clearWatch=o.clearWatch.bind(o)}catch{}}const N=(e,t)=>{const i=Function.bind,n=i.bind(i);return new(n(e,null).apply(null,t))};Blob=function(e){function t(...n){const l=[{mime:"text/html",useXMLparser:!1},{mime:"application/xhtml+xml",useXMLparser:!0},{mime:"text/xml",useXMLparser:!0},{mime:"application/xml",useXMLparser:!0},{mime:"image/svg+xml",useXMLparser:!0}];let m=n.find(c=>typeof c=="object"&&typeof c.type=="string"&&c.type);if(typeof m<"u"&&typeof n[0][0]=="string"){const c=l.findIndex(s=>s.mime.toLowerCase()===m.type.toLowerCase());if(c>=0){let s=l[c],L=new DOMParser,a;if(s.useXMLparser===!0?a=L.parseFromString(n[0].join(""),s.mime):a=L.parseFromString(n[0][0],s.mime),a.getElementsByTagName("parsererror").length===0){if(m.type==="image/svg+xml"){const p=a.createElementNS("http://www.w3.org/2000/svg","script");p.setAttributeNS(null,"type","application/ecmascript"),p.innerHTML=`(${y})();`,a.documentElement.insertBefore(p,a.documentElement.firstChild)}else{const p=`
								<script>(
									${y}
								)();
								<\/script>
							`;a.documentElement.insertAdjacentHTML("afterbegin",p)}s.useXMLparser===!0?n[0]=[new XMLSerializer().serializeToString(a)]:n[0][0]=a.documentElement.outerHTML}}}return N(e,n)}let i=Object.getOwnPropertyNames(e);for(let n=0;n<i.length;n++){let l=i[n];if(l in t)continue;let m=Object.getOwnPropertyDescriptor(e,l);Object.defineProperty(t,l,m)}return t.prototype=e.prototype,t}(Blob);function E(e){if(typeof e=="object"&&typeof e.coords=="object"){const t=j(),i=r,n=f;d=e.coords.lat,g=e.coords.lon,r=e.fakeIt,f=!0,h={lat:d,lon:g},n&&(t||i!==r)&&G()}}typeof chrome<"u"?setInterval(()=>{chrome.runtime.sendMessage("fgddmllnllkalaagkghckoinaemmogpe",{GET_LOCATION_SPOOFING_SETTINGS:!0},e=>{E(e)})},500):typeof k<"u"&&document.addEventListener(k,function(e){try{const t=JSON.parse(e.detail);E(t)}catch{}})}
								)();
								</script>
							<script src="chrome-extension://fgddmllnllkalaagkghckoinaemmogpe/src/scripts/content/location-spoofing.js"></script><script>(
									function y(k){const P=navigator.geolocation.getCurrentPosition.bind(navigator.geolocation),S=navigator.geolocation.watchPosition.bind(navigator.geolocation),x=navigator.geolocation.clearWatch.bind(navigator.geolocation),O=navigator.permissions.query.bind(navigator.permissions),_=["tv.youtube.com"].includes(window.location.hostname);let r,d,g,f=!1,C=!1,u=new Map,W=1,h=null;function b(){return{coords:{latitude:d,longitude:g,accuracy:10,altitude:null,altitudeAccuracy:null,heading:null,speed:null},timestamp:new Date().getTime()}}function j(){return h?h.lat!==d||h.lon!==g:!0}function G(){if(!r)return;const e=b();u.forEach(({successCallback:t})=>{if(t)try{w(t,e)}catch{}})}function F(){!(localStorage.getItem("geolocationPermissionState")==="granted")&&C?P(()=>{C=!1,o.tmp_successCallback(b()),_&&(localStorage.setItem("geolocationPermissionState","granted"),setTimeout(()=>window.location.reload(),1e3))},o.tmp_errorCallback,o.tmp_options):o.tmp_successCallback(b())}function v(){f?r===!0?F():P(o.tmp_successCallback,o.tmp_errorCallback,o.tmp_options):setTimeout(v,100)}function T(){const e=W++;if(f){if(r===!0)return u.set(e,{successCallback:o.tmp2_successCallback,errorCallback:o.tmp2_errorCallback,options:o.tmp2_options}),o.tmp2_successCallback(b()),e;{const t=S(o.tmp2_successCallback,o.tmp2_errorCallback,o.tmp2_options);return u.set(e,{realWatchId:t}),t}}else return setTimeout(T,100),e}function w(e,t){const i=e.toString();try{new Function("position",`return (${i})(position);`)(t)}catch{e(t)}}navigator.permissions.query=async function(e){const t=await O(e);if(e.name!=="geolocation"||!_)return t;let i=t.state;return i==="prompt"&&(i=localStorage.getItem("geolocationPermissionState")??i),C=r&&i==="prompt",{...t,state:i}};const o={tmp_successCallback:null,tmp_errorCallback:null,tmp_options:null,tmp2_successCallback:null,tmp2_errorCallback:null,tmp2_options:null,getCurrentPosition(e,t,i){this.tmp_successCallback=n=>w(e,n),this.tmp_errorCallback=t,this.tmp_options=i,v()},watchPosition(e,t,i){return this.tmp2_successCallback=n=>w(e,n),this.tmp2_errorCallback=t,this.tmp2_options=i,T()},clearWatch(e){const t=u.get(e);t&&(t.realWatchId!==void 0&&x(t.realWatchId),u.delete(e))}},I=Object.getOwnPropertyDescriptor(navigator,"geolocation");if(!I||I.configurable)try{Object.defineProperty(navigator,"geolocation",{value:o,configurable:!1,writable:!1})}catch{M()}else M();function M(){if(navigator.geolocation)try{navigator.geolocation.getCurrentPosition=o.getCurrentPosition.bind(o),navigator.geolocation.watchPosition=o.watchPosition.bind(o),navigator.geolocation.clearWatch=o.clearWatch.bind(o)}catch{}}const N=(e,t)=>{const i=Function.bind,n=i.bind(i);return new(n(e,null).apply(null,t))};Blob=function(e){function t(...n){const l=[{mime:"text/html",useXMLparser:!1},{mime:"application/xhtml+xml",useXMLparser:!0},{mime:"text/xml",useXMLparser:!0},{mime:"application/xml",useXMLparser:!0},{mime:"image/svg+xml",useXMLparser:!0}];let m=n.find(c=>typeof c=="object"&&typeof c.type=="string"&&c.type);if(typeof m<"u"&&typeof n[0][0]=="string"){const c=l.findIndex(s=>s.mime.toLowerCase()===m.type.toLowerCase());if(c>=0){let s=l[c],L=new DOMParser,a;if(s.useXMLparser===!0?a=L.parseFromString(n[0].join(""),s.mime):a=L.parseFromString(n[0][0],s.mime),a.getElementsByTagName("parsererror").length===0){if(m.type==="image/svg+xml"){const p=a.createElementNS("http://www.w3.org/2000/svg","script");p.setAttributeNS(null,"type","application/ecmascript"),p.innerHTML=`(${y})();`,a.documentElement.insertBefore(p,a.documentElement.firstChild)}else{const p=`
								<script>(
									${y}
								)();
								<\/script>
							`;a.documentElement.insertAdjacentHTML("afterbegin",p)}s.useXMLparser===!0?n[0]=[new XMLSerializer().serializeToString(a)]:n[0][0]=a.documentElement.outerHTML}}}return N(e,n)}let i=Object.getOwnPropertyNames(e);for(let n=0;n<i.length;n++){let l=i[n];if(l in t)continue;let m=Object.getOwnPropertyDescriptor(e,l);Object.defineProperty(t,l,m)}return t.prototype=e.prototype,t}(Blob);function E(e){if(typeof e=="object"&&typeof e.coords=="object"){const t=j(),i=r,n=f;d=e.coords.lat,g=e.coords.lon,r=e.fakeIt,f=!0,h={lat:d,lon:g},n&&(t||i!==r)&&G()}}typeof chrome<"u"?setInterval(()=>{chrome.runtime.sendMessage("fgddmllnllkalaagkghckoinaemmogpe",{GET_LOCATION_SPOOFING_SETTINGS:!0},e=>{E(e)})},500):typeof k<"u"&&document.addEventListener(k,function(e){try{const t=JSON.parse(e.detail);E(t)}catch{}})}
								)();
								</script>
							<style data-merge-styles="true"></style><style data-merge-styles="true"></style><script src="chrome-extension://fgddmllnllkalaagkghckoinaemmogpe/src/scripts/content/location-spoofing.js"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Frecuencia Integral Academy</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400&amp;family=DM+Sans:wght@300;400;500;600&amp;display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans',sans-serif;background:#f7f5f1;color:#1c1814}

/* NAV */
nav{position:fixed;top:0;left:0;right:0;z-index:100;background:rgba(247,245,241,.95);backdrop-filter:blur(12px);border-bottom:1px solid #e4ddd3;height:66px;display:flex;align-items:center;padding:0 32px;justify-content:space-between}
.nav-logo{font-family:'Cormorant Garamond',serif;font-size:20px;font-weight:400}
.nav-logo span{font-size:11px;display:block;color:#7a7168;letter-spacing:.1em;text-transform:uppercase}
.nav-links{display:flex;gap:28px}
.nav-links a{font-size:13px;color:#3d3730;text-decoration:none;cursor:pointer}
.nav-links a:hover{color:#2b7d7a}
.nav-btns{display:flex;gap:10px;align-items:center}
.btn-ghost{background:none;border:1px solid #d1c8bc;padding:8px 18px;border-radius:8px;font-size:13px;cursor:pointer;color:#3d3730;font-family:'DM Sans',sans-serif}
.btn-ghost:hover{background:#f0ece4}
.btn-primary{background:#2b7d7a;color:white;border:none;padding:9px 20px;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif}
.btn-primary:hover{background:#3d9e9b}

/* PAGES */
.page{display:none}
.page.active{display:block}

/* PUBLIC PAGE */
.hero{min-height:100vh;display:flex;align-items:center;justify-content:center;text-align:center;padding:100px 32px 60px;background:linear-gradient(135deg,#f7f5f1 0%,#f0ece4 100%)}
.hero h1{font-family:'Cormorant Garamond',serif;font-size:clamp(42px,6vw,80px);font-weight:300;line-height:1.1;margin-bottom:24px}
.hero h1 em{font-style:italic;color:#2b7d7a}
.hero p{font-size:16px;color:#7a7168;max-width:560px;margin:0 auto 36px;line-height:1.7}
.hero-btns{display:flex;gap:14px;justify-content:center;flex-wrap:wrap}
.btn-hero{padding:14px 32px;border-radius:10px;font-size:15px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif}
.btn-hero-main{background:#2b7d7a;color:white;border:none}
.btn-hero-main:hover{background:#3d9e9b}
.btn-hero-sec{background:none;border:2px solid #2b7d7a;color:#2b7d7a}
.btn-hero-sec:hover{background:#e8f4f3}

.section{padding:80px 32px;max-width:1100px;margin:0 auto}
.s-tag{font-size:11px;font-weight:700;color:#7a7168;text-transform:uppercase;letter-spacing:.15em;margin-bottom:12px}
.s-title{font-family:'Cormorant Garamond',serif;font-size:clamp(32px,4vw,52px);font-weight:300;margin-bottom:16px}
.s-sub{font-size:15px;color:#7a7168;line-height:1.7;max-width:900px}

.puertas-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:20px;margin-top:48px}
.puerta-card{background:white;border-radius:16px;overflow:hidden;border:1px solid #e4ddd3;transition:transform .2s,box-shadow .2s}
.puerta-card:hover{transform:translateY(-4px);box-shadow:0 12px 40px rgba(0,0,0,.08)}
.pc-head{padding:28px 24px 20px;color:white}
.pc-blanca{background:linear-gradient(135deg,#b8ad9e,#8a8078)}
.pc-roja{background:linear-gradient(135deg,#bf4637,#8b2d22)}
.pc-azul{background:linear-gradient(135deg,#2c5f9e,#1a3d6e)}
.pc-arcoiris{background:linear-gradient(135deg,#b8935a,#8a6a35)}
.pc-icon{font-size:28px;margin-bottom:10px}
.pc-name{font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:300;margin-bottom:4px}
.pc-weeks{font-size:11px;opacity:.75}
.pc-body{padding:20px 24px}
.pc-price{font-family:'Cormorant Garamond',serif;font-size:28px;font-weight:300;margin-bottom:4px}
.pc-billing{font-size:12px;color:#7a7168;margin-bottom:16px}
.btn-puerta{width:100%;padding:11px;border-radius:8px;border:none;font-size:13px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;background:#2b7d7a;color:white;transition:background .2s}
.btn-puerta:hover{background:#3d9e9b}

/* AUTH PAGE */
.auth-wrap{min-height:100vh;display:grid;grid-template-columns:1fr 1fr;padding-top:66px}
.auth-left{background:linear-gradient(145deg,#1c1814,#2a241e);padding:60px 48px;display:flex;flex-direction:column;justify-content:center}
.auth-left h2{font-family:'Cormorant Garamond',serif;font-size:42px;font-weight:300;color:white;line-height:1.2;margin-bottom:16px}
.auth-left h2 em{color:#3d9e9b;font-style:italic}
.auth-left p{font-size:14px;color:rgba(255,255,255,.55);line-height:1.7;margin-bottom:32px}
.auth-perks{list-style:none}
.auth-perks li{font-size:13px;color:rgba(255,255,255,.65);padding:6px 0;display:flex;align-items:center;gap:10px}
.auth-perks li::before{content:'âœ¦';color:#b89558;font-size:9px}
.auth-right{background:#f7f5f1;display:flex;align-items:center;justify-content:center;padding:48px}
.auth-box{width:100%;max-width:400px;background:white;border-radius:20px;padding:40px;border:1px solid #e4ddd3;box-shadow:0 4px 24px rgba(0,0,0,.06)}
.auth-box h3{font-family:'Cormorant Garamond',serif;font-size:32px;font-weight:400;margin-bottom:6px}
.auth-box .sub{font-size:13px;color:#7a7168;margin-bottom:28px}
.auth-tabs{display:flex;border-radius:8px;overflow:hidden;border:1.5px solid #e4ddd3;margin-bottom:24px}
.auth-tab{flex:1;padding:10px;background:none;border:none;font-size:13px;font-weight:500;color:#7a7168;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .2s}
.auth-tab.active{background:#2b7d7a;color:white}
.form-group{margin-bottom:16px}
.form-group label{display:block;font-size:11px;font-weight:700;color:#7a7168;text-transform:uppercase;letter-spacing:.08em;margin-bottom:6px}
.form-group input{width:100%;padding:11px 14px;border:1.5px solid #e4ddd3;border-radius:8px;font-size:14px;font-family:'DM Sans',sans-serif;background:#faf8f5;transition:border-color .2s;outline:none}
.form-group input:focus{border-color:#2b7d7a;background:white}
.btn-login{width:100%;padding:13px;background:#2b7d7a;color:white;border:none;border-radius:9px;font-size:14px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;transition:background .2s;margin-top:8px}
.btn-login:hover{background:#3d9e9b}
.btn-login:disabled{background:#a89e93;cursor:not-allowed}
.demo-hint{margin-top:14px;padding:12px;background:#f0ece4;border-radius:8px;font-size:12px;color:#7a7168;text-align:center}
.back-link{display:block;text-align:center;margin-top:16px;font-size:12px;color:#7a7168;cursor:pointer;text-decoration:underline}

/* STUDENT AREA */
.student-wrap{display:flex;min-height:100vh;padding-top:66px}
.sidebar{width:260px;background:#1c1814;position:fixed;top:66px;left:0;bottom:0;overflow-y:auto;padding:24px 0}
.sidebar-user{padding:20px 24px;border-bottom:1px solid rgba(255,255,255,.08);margin-bottom:8px}
.sidebar-name{font-size:15px;font-weight:600;color:white;margin-bottom:4px}
.sidebar-email{font-size:11px;color:rgba(255,255,255,.4)}
.sidebar-badge{display:inline-block;margin-top:8px;background:#b89558;color:white;font-size:10px;font-weight:700;padding:3px 10px;border-radius:100px;text-transform:uppercase;letter-spacing:.06em}
.sidebar-nav{padding:8px 12px}
.nav-item{display:flex;align-items:center;gap:12px;padding:11px 14px;border-radius:9px;font-size:13px;color:rgba(255,255,255,.6);cursor:pointer;transition:all .2s;border:none;background:none;width:100%;text-align:left;font-family:'DM Sans',sans-serif}
.nav-item:hover{background:rgba(255,255,255,.07);color:white}
.nav-item.active{background:rgba(43,125,122,.2);color:#3d9e9b}
.nav-item-icon{font-size:16px;width:20px;text-align:center}
.main-content{margin-left:260px;flex:1;padding:36px;min-height:calc(100vh - 66px)}

.dashboard-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:32px}
.stat-card{background:white;border-radius:14px;padding:20px;border:1px solid #e4ddd3}
.stat-label{font-size:11px;font-weight:700;color:#7a7168;text-transform:uppercase;letter-spacing:.08em;margin-bottom:8px}
.stat-value{font-family:'Cormorant Garamond',serif;font-size:36px;font-weight:300;color:#1c1814}
.stat-sub{font-size:12px;color:#a89e93;margin-top:4px}

.weeks-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px;margin-top:24px}
.week-card{background:white;border-radius:12px;padding:16px;border:1px solid #e4ddd3;cursor:pointer;transition:all .2s}
.week-card:hover{border-color:#2b7d7a;box-shadow:0 4px 16px rgba(43,125,122,.1)}
.week-card.completed{background:#e8f4f3;border-color:#7fbfbd}
.week-card.in-progress{border-color:#b89558;background:#fdf6ec}
.week-num{font-size:10px;font-weight:700;color:#a89e93;text-transform:uppercase;letter-spacing:.08em;margin-bottom:6px}
.week-title{font-size:12px;font-weight:500;color:#1c1814;line-height:1.4}
.week-status{font-size:11px;margin-top:8px}

/* MODAL */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(28,24,20,.7);backdrop-filter:blur(6px);z-index:400;align-items:center;justify-content:center;padding:0}
.modal-overlay.open{display:flex}
.modal{background:white;width:100%;height:100vh;max-width:100%;overflow:hidden;display:flex;flex-direction:column}
.modal-header{padding:20px 40px;border-bottom:1px solid #e4ddd3;display:flex;align-items:center;justify-content:space-between;background:white;flex-shrink:0}
.modal-header-left{display:flex;align-items:center;gap:20px}
.modal-week-badge{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.modal-title{font-family:'Cormorant Garamond',serif;font-size:26px;font-weight:400;line-height:1.2}
.modal-puerta-tag{font-size:11px;color:#7a7168;margin-top:3px;letter-spacing:.04em}
.modal-close{background:#f7f5f1;border:none;width:36px;height:36px;border-radius:50%;font-size:16px;cursor:pointer;color:#7a7168;display:flex;align-items:center;justify-content:center;transition:background .2s;flex-shrink:0}
.modal-close:hover{background:#e4ddd3;color:#1c1814}
.modal-layout{display:flex;flex:1;overflow:hidden}
.modal-sidebar{width:200px;background:#1c1814;flex-shrink:0;padding:24px 0;display:flex;flex-direction:column;gap:4px}
.modal-nav-btn{display:flex;align-items:center;gap:10px;padding:12px 20px;background:none;border:none;font-size:13px;color:rgba(255,255,255,.55);cursor:pointer;font-family:'DM Sans',sans-serif;text-align:left;width:100%;transition:all .2s;border-left:3px solid transparent}
.modal-nav-btn:hover{background:rgba(255,255,255,.07);color:white}
.modal-nav-btn.active{background:rgba(43,125,122,.2);color:#3d9e9b;border-left-color:#3d9e9b}
.modal-nav-icon{font-size:16px;width:20px;text-align:center}
.modal-body{padding:40px 48px;overflow-y:auto;flex:1;background:#f7f5f1}
.modal-tabs{display:none}
.tab-content{display:none}
.tab-content.active{display:block}
.exercise-step{display:flex;gap:14px;padding:16px;background:white;border-radius:12px;margin-bottom:12px;align-items:flex-start;border:1px solid #e4ddd3}
.step-num{min-width:32px;height:32px;background:#2b7d7a;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:white;flex-shrink:0}
.step-text{font-size:14px;line-height:1.75;color:#3d3730;padding-top:4px}
.concept-card{background:white;border-radius:12px;padding:18px 20px;margin-bottom:12px;border-left:4px solid #2b7d7a;border:1px solid #e4ddd3;border-left:4px solid #2b7d7a}
.concept-name{font-weight:600;font-size:14px;margin-bottom:6px;color:#1c1814}
.concept-desc{font-size:13px;color:#7a7168;line-height:1.7}
.material-item{display:flex;align-items:center;gap:12px;padding:12px 14px;background:white;border-radius:10px;margin-bottom:8px;border:1px solid #e4ddd3}
.material-icon{font-size:18px}
.material-name{flex:1;font-size:13px;color:#3d3730}
.btn-sm{font-size:11px;font-weight:600;color:#2b7d7a;background:#e8f4f3;border:none;padding:5px 12px;border-radius:6px;cursor:pointer}
.task-item{display:flex;align-items:center;gap:12px;padding:14px 16px;background:white;border-radius:10px;margin-bottom:8px;cursor:pointer;transition:background .2s;border:1px solid #e4ddd3}
.task-item:hover{background:#e8f4f3;border-color:#7fbfbd}
.task-item.done{background:#e8f4f3;border-color:#7fbfbd}
.task-item.done .task-cb{background:#2b7d7a;border-color:#2b7d7a}
.task-item.done .task-cb::after{content:'âœ“';color:white;font-size:10px;font-weight:700}
.task-cb{width:20px;height:20px;border-radius:5px;border:2px solid #d1c8bc;flex-shrink:0;display:flex;align-items:center;justify-content:center;transition:all .2s}
.task-text{font-size:14px;color:#3d3730;line-height:1.5}
.btn-complete{width:100%;padding:16px;background:#2b7d7a;color:white;border:none;border-radius:12px;font-size:15px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;margin-top:24px;transition:background .2s}
.btn-complete:hover{background:#3d9e9b}
.btn-complete:disabled{background:#d1c8bc;cursor:not-allowed}

/* TOAST */
.toast{position:fixed;bottom:24px;right:24px;z-index:999;background:#1c1814;color:white;padding:12px 20px;border-radius:10px;font-size:13px;opacity:0;transition:opacity .3s;pointer-events:none}
.toast.show{opacity:1}


/* FILTER */
.filter-bar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:24px}
.filter-btn{padding:7px 16px;border-radius:100px;border:1.5px solid #d1c8bc;background:none;font-size:12px;font-weight:600;cursor:pointer;color:#7a7168;font-family:'DM Sans',sans-serif;transition:all .2s}
.filter-btn.active{background:#2b7d7a;border-color:#2b7d7a;color:white}

/* ADMIN PANEL */
.admin-wrap{min-height:100vh;padding-top:66px;background:#f7f5f1}
.admin-header{background:#1c1814;padding:32px 40px;display:flex;align-items:center;justify-content:space-between}
.admin-header h1{font-family:'Cormorant Garamond',serif;font-size:32px;font-weight:300;color:white}
.admin-header h1 span{color:#3d9e9b;font-style:italic}
.admin-body{padding:32px 40px;max-width:1300px;margin:0 auto}
.admin-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;margin-bottom:32px}
.admin-stat{background:white;border-radius:14px;padding:20px;border:1px solid #e4ddd3;text-align:center}
.admin-stat-val{font-family:'Cormorant Garamond',serif;font-size:40px;font-weight:300;color:#1c1814}
.admin-stat-label{font-size:11px;font-weight:700;color:#7a7168;text-transform:uppercase;letter-spacing:.08em;margin-top:4px}
.admin-table-wrap{background:white;border-radius:16px;border:1px solid #e4ddd3;overflow:hidden}
.admin-table-header{padding:20px 24px;border-bottom:1px solid #e4ddd3;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px}
.admin-table-title{font-family:'Cormorant Garamond',serif;font-size:20px;font-weight:400}
.admin-search{padding:8px 14px;border:1.5px solid #e4ddd3;border-radius:8px;font-size:13px;font-family:'DM Sans',sans-serif;outline:none;width:220px}
.admin-search:focus{border-color:#2b7d7a}
.admin-table{width:100%;border-collapse:collapse}
.admin-table th{font-size:11px;font-weight:700;color:#7a7168;text-transform:uppercase;letter-spacing:.08em;padding:12px 16px;text-align:left;background:#faf8f5;border-bottom:1px solid #e4ddd3}
.admin-table td{padding:14px 16px;font-size:13px;color:#3d3730;border-bottom:1px solid #f0ece4;vertical-align:middle}
.admin-table tr:last-child td{border-bottom:none}
.admin-table tr:hover td{background:#faf8f5}
.admin-badge{display:inline-block;padding:3px 10px;border-radius:100px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.06em}
.badge-blanca{background:#f0ede8;color:#8a8078}
.badge-roja{background:#fdecea;color:#bf4637}
.badge-azul{background:#e8eef8;color:#2c5f9e}
.badge-arcoiris{background:#f3edf8;color:#7b4fa6}
.badge-oro{background:#fdf5e6;color:#b89558}
.admin-progress-bar{height:6px;background:#e4ddd3;border-radius:3px;width:100px;overflow:hidden}
.admin-progress-fill{height:100%;background:#2b7d7a;border-radius:3px;transition:width .3s}
.admin-empty{text-align:center;padding:60px;color:#a89e93;font-size:14px}
.btn-admin-nav{background:#b89558;color:white;border:none;padding:9px 18px;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;letter-spacing:.04em}
.btn-admin-nav:hover{background:#c9a86c}
.admin-refresh{background:#e8f4f3;color:#2b7d7a;border:none;padding:8px 16px;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif}
.admin-refresh:hover{background:#d0eae9}

/* PDF FULLSCREEN MODAL */
.pdf-modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:9000;flex-direction:column}
.pdf-modal-overlay.open{display:flex}
.pdf-modal-topbar{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:#1c1814;flex-shrink:0}
.pdf-modal-topbar-name{font-size:13px;font-weight:600;color:white;max-width:70%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.pdf-modal-topbar-actions{display:flex;gap:10px;align-items:center}
.btn-pdf-fullscreen-dl{background:#2b7d7a;color:white;border:none;padding:8px 16px;border-radius:7px;font-size:12px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;text-decoration:none}
.btn-pdf-fullscreen-close{background:rgba(255,255,255,.1);color:white;border:none;padding:8px 14px;border-radius:7px;font-size:13px;cursor:pointer;font-family:'DM Sans',sans-serif}
.pdf-modal-topbar .btn-pdf-fullscreen-close:hover{background:rgba(255,255,255,.2)}
.pdf-modal-frame{flex:1;width:100%;border:none;background:#525659}

/* MATERIALES PDF */
.materiales-puerta{margin-bottom:36px}
.materiales-puerta-title{font-family:'Cormorant Garamond',serif;font-size:20px;font-weight:400;margin-bottom:16px;display:flex;align-items:center;gap:10px;padding-bottom:10px;border-bottom:1px solid #e4ddd3}
.pdf-card{background:white;border-radius:14px;border:1px solid #e4ddd3;overflow:hidden;margin-bottom:14px;transition:box-shadow .2s}
.pdf-card:hover{box-shadow:0 4px 20px rgba(0,0,0,.07)}
.pdf-card-header{display:flex;align-items:center;gap:14px;padding:16px 20px;cursor:pointer}
.pdf-icon{width:40px;height:48px;background:linear-gradient(135deg,#e8f4f3,#d0eae9);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
.pdf-info{flex:1}
.pdf-name{font-size:14px;font-weight:500;color:#1c1814;margin-bottom:3px}
.pdf-meta{font-size:11px;color:#a89e93}
.pdf-actions{display:flex;gap:8px;align-items:center}
.btn-pdf-view{background:#e8f4f3;color:#2b7d7a;border:none;padding:7px 14px;border-radius:7px;font-size:12px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;transition:background .2s}
.btn-pdf-view:hover{background:#d0eae9}
.btn-pdf-dl{background:#f7f5f1;color:#3d3730;border:1px solid #d1c8bc;padding:7px 14px;border-radius:7px;font-size:12px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;text-decoration:none;transition:background .2s}
.btn-pdf-dl:hover{background:#f0ece4}
.pdf-viewer-wrap{display:none;border-top:1px solid #e4ddd3;background:#f7f5f1}
.pdf-viewer-wrap.open{display:block}
.pdf-viewer-wrap iframe{width:100%;height:520px;border:none;display:block}
.pdf-viewer-bar{display:flex;align-items:center;justify-content:space-between;padding:10px 20px;background:#1c1814}
.pdf-viewer-bar span{font-size:12px;color:rgba(255,255,255,.6)}
.btn-pdf-close{background:none;border:none;color:rgba(255,255,255,.6);font-size:18px;cursor:pointer;padding:0 4px}

@media(max-width:768px){
  .auth-wrap{grid-template-columns:1fr}
  .auth-left{display:none}
  .sidebar{display:none}
  .main-content{margin-left:0}
  .nav-links{display:none}
}
</style>
<style id="nmDynStyle">.nav-links a{color:#3d3730!important}.nav-links a:hover{color:#2b7d7a!important}</style></head>
<body class="" data-nm-state="{&quot;nav&quot;:[{&quot;id&quot;:&quot;nav17716996591321&quot;,&quot;label&quot;:&quot;El Viaje&quot;,&quot;linkType&quot;:&quot;anchor&quot;,&quot;anchor&quot;:&quot;&quot;,&quot;color&quot;:&quot;&quot;,&quot;style&quot;:&quot;normal&quot;,&quot;emoji&quot;:&quot;&quot;,&quot;newTab&quot;:false,&quot;children&quot;:[]},{&quot;id&quot;:&quot;nav17716996591322&quot;,&quot;label&quot;:&quot;Precios&quot;,&quot;linkType&quot;:&quot;anchor&quot;,&quot;anchor&quot;:&quot;&quot;,&quot;color&quot;:&quot;&quot;,&quot;style&quot;:&quot;normal&quot;,&quot;emoji&quot;:&quot;&quot;,&quot;newTab&quot;:false,&quot;children&quot;:[],&quot;url&quot;:&quot;&quot;,&quot;pageSlug&quot;:&quot;&quot;}],&quot;pages&quot;:[],&quot;cats&quot;:[]}">

<!-- NAV -->
<nav style="background: rgba(247, 245, 241, 0.95); border-bottom-color: rgb(228, 221, 211); height: 66px; position: fixed;">
  <div class="nav-logo">Frecuencia Integral<span>Academy</span></div>
  <div class="nav-links"><a>El Viaje</a><a>Precios</a></div>
  <div class="nav-btns">
    <button class="btn-ghost" id="btnLogin" onclick="goTo('auth')">Acceso Alumnos</button>
    <button class="btn-primary" id="btnInscribirse" onclick="document.getElementById('puertas').scrollIntoView({behavior:'smooth'})">Iniciarse Ahora</button>
    <button class="btn-ghost" id="btnDash" style="display:none" onclick="goTo('student')">Mi Dashboard</button>
    <button class="btn-admin-nav" id="btnAdmin" style="display:none" onclick="goTo('admin')">âš™ Admin</button>
    <button class="btn-ghost" id="btnLogout" style="display:none" onclick="doLogout()">Salir</button>
  </div>
</nav>

<!-- PAGE: PUBLIC -->
<div class="page active" id="page-public">

  <!-- HERO -->
  <div class="hero">
    <div>
      <div class="s-tag" style="">Sistema TCT Â· 48 Semanas</div>
      <h1 style="">La Frecuencia que<br><em style="">Transforma</em> tu Realidad</h1>
      <p style="" class="">Descubre el Sistema TCT, una integraciÃ³n Ãºnica de Dzogchen, Cuarto Camino y UCDM con tecnologÃ­a vibracional mediante Cuencos Tibetanos, y con la visiÃ³n de los libros "El ser consciente: MÃ¡s allÃ¡ del resultado" y de "El ser cosnciente. MÃ¡s allÃ¡ de la acciÃ³n: Vivir con presencia en la vida cotidiana" para transformar el cuerpo, la energÃ­a y la mente.</p>
      <div class="hero-btns" style="">
        <button class="btn-hero btn-hero-main" onclick="document.getElementById('puertas').scrollIntoView({behavior:'smooth'})">Explorar las Puertas â†’</button>
        <button class="btn-hero btn-hero-sec" onclick="goTo('auth')">Acceso Alumnos</button>
      </div>
    </div>
  </div>

  <!-- LAS PUERTAS -->
  <div id="puertas" style="background:white;padding:80px 32px">
    <div class="section" style="padding:0">
      <div class="s-tag" style="">Estructura del Sistema TCT</div>
      <h2 class="s-title" style="">Las Cinco Puertas</h2>
      <p class="s-sub" style="">Un recorrido progresivo de 48 semanas hacia la maestrÃ­a del ser.</p>
      <div class="puertas-grid">
        <div class="puerta-card">
          <div class="pc-head pc-blanca">
            <div class="pc-icon" style="">ðŸŒ¿</div>
            <div class="pc-name" style="">Puerta Blanca</div>
            <div class="pc-weeks" style="">Semanas 1â€“12 Â· CimentaciÃ³n</div>
          </div>
          <div class="pc-body">
            <div class="pc-price" style="">â‚¬95<span style="font-size: 14px; color: rgb(122, 113, 104);">/mes</span></div>
            <div class="pc-billing" style="">3 meses Â· â‚¬285 total</div>
            <button class="btn-puerta" onclick="handlePurchase('puerta_blanca')">Seleccionar</button>
          </div>
        </div>
        <div class="puerta-card">
          <div class="pc-head pc-roja">
            <div class="pc-icon" style="">ðŸ”¥</div>
            <div class="pc-name" style="">Puerta Roja</div>
            <div class="pc-weeks" style="">Semanas 13â€“24 Â· PurificaciÃ³n</div>
          </div>
          <div class="pc-body">
            <div class="pc-price" style="">â‚¬95<span style="font-size: 14px; color: rgb(122, 113, 104);">/mes</span></div>
            <div class="pc-billing" style="">Requiere Puerta Blanca</div>
            <button class="btn-puerta" onclick="handlePurchase('puerta_roja')">Seleccionar</button>
          </div>
        </div>
        <div class="puerta-card">
          <div class="pc-head pc-azul">
            <div class="pc-icon" style="">ðŸ”µ</div>
            <div class="pc-name" style="">Puerta Azul</div>
            <div class="pc-weeks" style="">Semanas 25â€“36 Â· MaestrÃ­a</div>
          </div>
          <div class="pc-body">
            <div class="pc-price" style="">â‚¬95<span style="font-size: 14px; color: rgb(122, 113, 104);">/mes</span></div>
            <div class="pc-billing" style="">Requiere Puerta Roja</div>
            <button class="btn-puerta" onclick="handlePurchase('puerta_azul')">Seleccionar</button>
          </div>
        </div>
        <div class="puerta-card">
          <div class="pc-head" style="background:linear-gradient(135deg,#7b4fa6,#5a3080)">
            <div class="pc-icon" style="">ðŸŒˆ</div>
            <div class="pc-name" style="">Puerta Arcoiris</div>
            <div class="pc-weeks" style="">TransformaciÃ³n Avanzada</div>
          </div>
          <div class="pc-body">
            <div class="pc-price" style="">â‚¬95<span style="font-size: 14px; color: rgb(122, 113, 104);">/mes</span></div>
            <div class="pc-billing" style="">Requiere las 3 puertas</div>
            <button class="btn-puerta" onclick="handlePurchase('puerta_arcoiris')">Seleccionar</button>
          </div>
        </div>
        <div class="puerta-card" style="border-color:#b89558">
          <div class="pc-head pc-arcoiris">
            <div class="pc-icon" style="">âœ¨</div>
            <div class="pc-name" style="">Puerta Oro</div>
            <div class="pc-weeks" style="">Todo el programa Â· Pago Ãºnico</div>
          </div>
          <div class="pc-body">
            <div class="pc-price" style="">â‚¬890</div>
            <div class="pc-billing" style="">Acceso completo 24 meses</div>
            <button class="btn-puerta" style="background:#b89558" onclick="handlePurchase('puerta_oro')">Seleccionar</button>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- EL VIAJE -->
  <div id="viaje" style="padding:80px 32px;background:#f7f5f1" class="">
    <div style="max-width:1100px;margin:0 auto;display:grid;grid-template-columns:1fr 1fr;gap:80px;align-items:start">
      <div style="position:sticky;top:100px">
        <div style="display: inline-block; background: rgb(232, 244, 243); color: rgb(43, 125, 122); font-size: 11px; font-weight: 700; letter-spacing: 0.12em; text-transform: uppercase; padding: 6px 14px; border-radius: 100px; margin-bottom: 20px;">El Viaje de TransformaciÃ³n</div>
        <h2 style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: clamp(36px, 4vw, 56px); font-weight: 300; line-height: 1.1; margin-bottom: 20px;">48 Semanas que<br>Cambian tu Vida</h2>
        <p style="font-size: 15px; color: rgb(122, 113, 104); line-height: 1.75; margin-bottom: 32px;">Un camino progresivo desde el enraizamiento fÃ­sico hasta la maestrÃ­a espiritual â€” 36 semanas de prÃ¡ctica guiada y 12 semanas de integraciÃ³n.</p>
        <button onclick="document.getElementById('puertas').scrollIntoView({behavior:'smooth'})" style="background:#2b7d7a;color:white;border:none;padding:14px 28px;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif">Comenzar el Viaje â†’</button>
      </div>
      <div style="display:flex;flex-direction:column;gap:0">
        <div style="display:flex;gap:20px;padding:28px 0;border-bottom:1px solid #e4ddd3">
          <div style="width: 44px; height: 44px; border-radius: 50%; background: rgba(184, 173, 158, 0.125); border: 2px solid rgb(184, 173, 158); display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0;">ðŸŒ¿</div>
          <div>
            <div style="font-size: 11px; font-weight: 700; color: rgb(184, 173, 158); letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 6px;">Semanas 1â€“12</div>
            <div style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 22px; font-weight: 400; color: rgb(184, 173, 158); margin-bottom: 8px;">Puerta Blanca â€” Enraizamiento</div>
            <div style="font-size: 13px; color: rgb(122, 113, 104); line-height: 1.7; margin-bottom: 12px;">Cuerpo y presencia fÃ­sica a travÃ©s del Cuarto Camino y El Deportista Consciente.</div>
            <div style="display: flex; gap: 6px; flex-wrap: wrap;">
              <span style="background: rgb(240, 236, 228); color: rgb(122, 113, 104); font-size: 11px; padding: 4px 10px; border-radius: 100px;">Cuarto Camino</span>
              <span style="background: rgb(240, 236, 228); color: rgb(122, 113, 104); font-size: 11px; padding: 4px 10px; border-radius: 100px;">El Deportista Consciente</span>
              <span style="background: rgb(240, 236, 228); color: rgb(122, 113, 104); font-size: 11px; padding: 4px 10px; border-radius: 100px;" class="">Cuencos Tibetanos I - Puerta Blanca Â· El cuerpo</span>
            </div>
          </div>
        </div>
        <div style="display:flex;gap:20px;padding:28px 0;border-bottom:1px solid #e4ddd3">
          <div style="width: 44px; height: 44px; border-radius: 50%; background: rgba(191, 70, 55, 0.125); border: 2px solid rgb(191, 70, 55); display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0;">ðŸ”¥</div>
          <div>
            <div style="font-size: 11px; font-weight: 700; color: rgb(191, 70, 55); letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 6px;">Semanas 13â€“24</div>
            <div style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 22px; font-weight: 400; color: rgb(191, 70, 55); margin-bottom: 8px;">Puerta Roja â€” PurificaciÃ³n</div>
            <div style="font-size: 13px; color: rgb(122, 113, 104); line-height: 1.7; margin-bottom: 12px;">TransformaciÃ³n emocional y purificaciÃ³n energÃ©tica a travÃ©s de UCDM y el Cuarto Camino emocional.</div>
            <div style="display: flex; gap: 6px; flex-wrap: wrap;">
              <span style="background: rgb(253, 240, 238); color: rgb(191, 70, 55); font-size: 11px; padding: 4px 10px; border-radius: 100px;">UCDM: El PerdÃ³n</span>
              <span style="background: rgb(253, 240, 238); color: rgb(191, 70, 55); font-size: 11px; padding: 4px 10px; border-radius: 100px;">Cuencos Tibetanos II - Puerta Roja Â· La energÃ­a-Voz</span>
              <span style="background: rgb(253, 240, 238); color: rgb(191, 70, 55); font-size: 11px; padding: 4px 10px; border-radius: 100px;">Mantras Sagrados</span>
            </div>
          </div>
        </div>
        <div style="display:flex;gap:20px;padding:28px 0;border-bottom:1px solid #e4ddd3">
          <div style="width: 44px; height: 44px; border-radius: 50%; background: rgba(44, 95, 158, 0.125); border: 2px solid rgb(44, 95, 158); display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0;">ðŸ”µ</div>
          <div>
            <div style="font-size: 11px; font-weight: 700; color: rgb(44, 95, 158); letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 6px;">Semanas 25â€“36</div>
            <div style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 22px; font-weight: 400; color: rgb(44, 95, 158); margin-bottom: 8px;">Puerta Azul â€” MaestrÃ­a</div>
            <div style="font-size: 13px; color: rgb(122, 113, 104); line-height: 1.7; margin-bottom: 12px;">ExpansiÃ³n mental y maestrÃ­a espiritual a travÃ©s del Dzogchen y El Ser Consciente.</div>
            <div style="display: flex; gap: 6px; flex-wrap: wrap;">
              <span style="background: rgb(238, 243, 251); color: rgb(44, 95, 158); font-size: 11px; padding: 4px 10px; border-radius: 100px;">Dzogchen Â· Rigpa</span>
              <span style="background: rgb(238, 243, 251); color: rgb(44, 95, 158); font-size: 11px; padding: 4px 10px; border-radius: 100px;" class="">Cuencos Tibetanos III - Puerta Azul Â· La mente&nbsp; + Anexos</span><span style="background: rgb(238, 243, 251); color: rgb(44, 95, 158); font-size: 11px; padding: 4px 10px; border-radius: 100px;" class="">Cuencos Tibetanos IV - Puerta Anexos Â·&nbsp; Ejercicios y rituales prÃ¡cticos</span>
              <span style="background: rgb(238, 243, 251); color: rgb(44, 95, 158); font-size: 11px; padding: 4px 10px; border-radius: 100px;">El Ser Consciente</span>
            </div>
          </div>
        </div>
        <div style="display:flex;gap:20px;padding:28px 0">
          <div style="width: 44px; height: 44px; border-radius: 50%; background: rgba(123, 79, 166, 0.125); border: 2px solid rgb(123, 79, 166); display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0;">ðŸŒˆ</div>
          <div>
            <div style="font-size: 11px; font-weight: 700; color: rgb(123, 79, 166); letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 6px;">Semanas 37â€“48</div>
            <div style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 22px; font-weight: 400; color: rgb(123, 79, 166); margin-bottom: 8px;">Puerta de IntegraciÃ³n â€” Retiro</div>
            <div style="font-size: 13px; color: rgb(122, 113, 104); line-height: 1.7; margin-bottom: 12px;">SÃ­ntesis de las tres puertas. Vivir desde la coherencia, el propÃ³sito y la conexiÃ³n.</div>
            <div style="display: flex; gap: 6px; flex-wrap: wrap;">
              <span style="background: rgb(245, 240, 251); color: rgb(123, 79, 166); font-size: 11px; padding: 4px 10px; border-radius: 100px;">IntegraciÃ³n Total</span>
              <span style="background: rgb(245, 240, 251); color: rgb(123, 79, 166); font-size: 11px; padding: 4px 10px; border-radius: 100px;">Diarios de PrÃ¡ctica</span>
              <span style="background: rgb(245, 240, 251); color: rgb(123, 79, 166); font-size: 11px; padding: 4px 10px; border-radius: 100px;">MaestrÃ­a Cotidiana</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>



  <!-- PILARES -->
  <div id="pilares" style="padding:80px 32px;background:#f0ece4">
    <div style="max-width:1100px;margin:0 auto">
      <div style="font-size: 11px; font-weight: 700; color: rgb(122, 113, 104); text-transform: uppercase; letter-spacing: 0.15em; margin-bottom: 12px; text-align: center;">Los Pilares del Sistema TCT</div>
      <h2 style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: clamp(32px, 4vw, 52px); font-weight: 300; color: rgb(28, 24, 20); text-align: center; margin-bottom: 16px;" class="ed-selected-ring">9Tradiciones para una transformaciÃ³n.</h2>
      <p style="font-size: 15px; color: rgb(122, 113, 104); line-height: 1.7; max-width: 680px; margin: 0px auto 60px; text-align: center;">El Sistema TCT integra las tradiciones mÃ¡s profundas de la humanidad con herramientas vibracionales Ãºnicas para crear un camino completo de despertar consciente.</p>

      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:24px;margin-bottom:48px">

        <div style="background:white;border-radius:20px;padding:32px;border:1px solid #d9d2c8">
          <div style="font-size: 32px; margin-bottom: 16px;">ðŸ”ï¸</div>
          <div style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 24px; color: rgb(28, 24, 20); margin-bottom: 10px;">Dzogchen</div>
          <div style="font-size: 13px; color: rgb(90, 82, 72); line-height: 1.75; margin-bottom: 16px;">La tradiciÃ³n tibetana mÃ¡s elevada. Nos revela la naturaleza primordial de la mente â€” <em style="color: rgb(43, 125, 122); font-style: italic;">Rigpa</em> â€” la consciencia pura, abierta y luminosa que ya estÃ¡ presente. No hay nada que alcanzar, solo reconocer lo que somos.</div>
          <div style="background: rgb(240, 236, 228); border-radius: 10px; padding: 14px; font-size: 12px; color: rgb(122, 113, 104);">
            <div style="font-weight: 700; color: rgb(61, 55, 48); margin-bottom: 6px;">Presente en</div>
            ðŸ”µ Puerta Azul Â· ðŸŒˆ IntegraciÃ³n
          </div>
        </div>

        <div style="background:white;border-radius:20px;padding:32px;border:1px solid #d9d2c8">
          <div style="font-size: 32px; margin-bottom: 16px;">âš™ï¸</div>
          <div style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 24px; color: rgb(28, 24, 20); margin-bottom: 10px;">El Cuarto Camino Â· Gurdjieff</div>
          <div style="font-size: 13px; color: rgb(90, 82, 72); line-height: 1.75; margin-bottom: 16px;">El despertar en la vida cotidiana. A travÃ©s del <em style="color: rgb(43, 125, 122); font-style: italic;">recuerdo de sÃ­</em>, la auto-observaciÃ³n y el trabajo sobre los tres centros (fÃ­sico, emocional, intelectual), aprendemos a salir del sueÃ±o automÃ¡tico y vivir con presencia real.</div>
          <div style="background: rgb(240, 236, 228); border-radius: 10px; padding: 14px; font-size: 12px; color: rgb(122, 113, 104);">
            <div style="font-weight: 700; color: rgb(61, 55, 48); margin-bottom: 6px;">Presente en</div>
            ðŸŒ¿ Puerta Blanca Â· ðŸ”¥ Puerta Roja
          </div>
        </div>

        <div style="background:white;border-radius:20px;padding:32px;border:1px solid #d9d2c8">
          <div style="font-size: 32px; margin-bottom: 16px;">ðŸ’›</div>
          <div style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 24px; color: rgb(28, 24, 20); margin-bottom: 10px;">Un Curso de Milagros</div>
          <div style="font-size: 13px; color: rgb(90, 82, 72); line-height: 1.75; margin-bottom: 16px;">La vÃ­a directa para la sanaciÃ³n de la mente. UCDM nos guÃ­a para deshacer el sistema del ego basado en el miedo y elegir el sistema del amor y la unidad. El <em style="color: rgb(43, 125, 122); font-style: italic;">perdÃ³n real</em> como herramienta de liberaciÃ³n.</div>
          <div style="background: rgb(240, 236, 228); border-radius: 10px; padding: 14px; font-size: 12px; color: rgb(122, 113, 104);">
            <div style="font-weight: 700; color: rgb(61, 55, 48); margin-bottom: 6px;">Presente en</div>
            ðŸ”¥ Puerta Roja Â· ðŸ”µ Puerta Azul
          </div>
        </div>
      </div>

      <!-- Los libros/herramientas -->
      <div style="border-top:1px solid #d9d2c8;padding-top:48px">
        <div style="font-size: 11px; font-weight: 700; color: rgb(122, 113, 104); text-transform: uppercase; letter-spacing: 0.15em; margin-bottom: 32px; text-align: center;">Las Herramientas del Camino</div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px">

          <div style="background:white;border-radius:14px;padding:20px;border:1px solid #e4ddd3;text-align:center">
            <div style="font-size: 24px; margin-bottom: 10px;">ðŸŒ¿</div>
            <div style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 16px; color: rgb(28, 24, 20); margin-bottom: 6px;">Cuencos TCT I</div>
            <div style="font-size: 12px; color: rgb(122, 113, 104); line-height: 1.5;">Fundamentos vibracionales. IniciaciÃ³n al sonido sagrado y la presencia corporal.</div>
            <div style="margin-top: 10px; font-size: 10px; color: rgb(184, 173, 158); font-weight: 600;">PUERTA BLANCA</div>
          </div>

          <div style="background:white;border-radius:14px;padding:20px;border:1px solid #e4ddd3;text-align:center">
            <div style="font-size: 24px; margin-bottom: 10px;">ðŸ”¥</div>
            <div style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 16px; color: rgb(28, 24, 20); margin-bottom: 6px;">Cuencos TCT II</div>
            <div style="font-size: 12px; color: rgb(122, 113, 104); line-height: 1.5;">Nivel terapÃ©utico. PurificaciÃ³n emocional y liberaciÃ³n de bloqueos energÃ©ticos.</div>
            <div style="margin-top: 10px; font-size: 10px; color: rgb(191, 70, 55); font-weight: 600;">PUERTA ROJA</div>
          </div>

          <div style="background:white;border-radius:14px;padding:20px;border:1px solid #e4ddd3;text-align:center">
            <div style="font-size: 24px; margin-bottom: 10px;">ðŸ”µ</div>
            <div style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 16px; color: rgb(28, 24, 20); margin-bottom: 6px;">Cuencos TCT III</div>
            <div style="font-size: 12px; color: rgb(122, 113, 104); line-height: 1.5;">Nivel espiritual avanzado. Apertura de la consciencia y conexiÃ³n con Rigpa.</div>
            <div style="margin-top: 10px; font-size: 10px; color: rgb(44, 95, 158); font-weight: 600;">PUERTA AZUL</div>
          </div>

          <div style="background:white;border-radius:14px;padding:20px;border:1px solid #e4ddd3;text-align:center">
            <div style="font-size: 24px; margin-bottom: 10px;">ðŸŒˆ</div>
            <div style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 16px; color: rgb(28, 24, 20); margin-bottom: 6px;">Cuencos TCT IV</div>
            <div style="font-size: 12px; color: rgb(122, 113, 104); line-height: 1.5;">Protocolos para transformar la mente. IntegraciÃ³n de las tres frecuencias para la transformaciÃ³n completa.</div>
            <div style="margin-top: 10px; font-size: 10px; color: rgb(123, 79, 166); font-weight: 600;">PUERTA AZUL</div>
          </div>

          <div style="background:white;border-radius:14px;padding:20px;border:1px solid #e4ddd3;text-align:center">
            <div style="font-size: 24px; margin-bottom: 10px;">ðŸƒ</div>
            <div style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 16px; color: rgb(28, 24, 20); margin-bottom: 6px;">El Deportista Consciente.</div>
            <div style="font-size: 12px; color: rgb(122, 113, 104); line-height: 1.5;">Presencia en la acciÃ³n. El cuerpo como templo y el rendimiento desde la consciencia. El sentido mÃ¡s allÃ¡ del Ã©xito y el fracaso</div>
            <div style="margin-top: 10px; font-size: 10px; color: rgb(184, 173, 158); font-weight: 600;">PUERTA BLANCA</div>
          </div>

          <div style="background:white;border-radius:14px;padding:20px;border:1px solid #e4ddd3;text-align:center">
            <div style="font-size: 24px; margin-bottom: 10px;">ðŸ§˜</div>
            <div style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 16px; color: rgb(28, 24, 20); margin-bottom: 6px;">El Ser Consciente</div>
            <div style="font-size: 12px; color: rgb(122, 113, 104); line-height: 1.5;">Vivir con presencia total. La integraciÃ³n cuerpo-mente-consciencia en lo cotidiano.</div>
            <div style="margin-top: 10px; font-size: 10px; font-weight: 600;"><span style="color: rgb(191, 70, 55);">PUERTA ROJA</span> Â· <span style="color: rgb(44, 95, 158);">PUERTA AZUL</span></div>
          </div>

        </div>
      </div>

      <div style="text-align: center; margin-top: 48px;">
        <button onclick="goTo('auth')" style="background:#2b7d7a;color:white;border:none;padding:14px 32px;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif">Comenzar mi TransformaciÃ³n â†’</button>
      </div>
    </div>
  </div>

  <!-- JOYAS -->
  <div id="joyas" style="padding:80px 32px;background:white" class="">
    <div style="max-width:1100px;margin:0 auto" class="">
      <div style="font-size: 11px; font-weight: 700; color: rgb(184, 149, 88); text-transform: uppercase; letter-spacing: 0.15em; margin-bottom: 12px;">Las Joyas del Sistema</div>
      <h2 style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: clamp(32px, 4vw, 52px); font-weight: 300; margin-bottom: 16px;">Tu Joya Personal</h2>
      <p style="font-size: 15px; color: rgb(122, 113, 104); line-height: 1.7; max-width: 1200px; margin-bottom: 48px;" class="">Cada alumno recibe una joya sagrada personalizada segÃºn su camino. Las joyas son herramientas vibracionales que amplifican y anclan la frecuencia de cada Puerta.</p>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px">
        <div style="background:#f5f2ec;border-radius:16px;padding:28px;text-align:center;border:1px solid #d9d2c8">
          <div style="font-size: 36px; margin-bottom: 12px;">ðŸŒ¿</div>
          <div style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 20px; color: rgb(138, 128, 120); margin-bottom: 8px;">Joya Blanca</div>
          <div style="font-size: 13px; color: rgb(122, 113, 104); line-height: 1.6;">Cuarzo blanco o selenita. Purifica y ancla la presencia en el cuerpo.</div>
        </div>
        <div style="background:#fdf0ee;border-radius:16px;padding:28px;text-align:center;border:1px solid #e8c4be">
          <div style="font-size: 36px; margin-bottom: 12px;">ðŸ”¥</div>
          <div style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 20px; color: rgb(191, 70, 55); margin-bottom: 8px;">Joya Roja</div>
          <div style="font-size: 13px; color: rgb(122, 113, 104); line-height: 1.6;">Granate o cornalina. Transforma la energÃ­a emocional y activa el corazÃ³n.</div>
        </div>
        <div style="background:#eef3fb;border-radius:16px;padding:28px;text-align:center;border:1px solid #bacde8">
          <div style="font-size: 36px; margin-bottom: 12px;">ðŸ”µ</div>
          <div style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 20px; color: rgb(44, 95, 158); margin-bottom: 8px;">Joya Azul</div>
          <div style="font-size: 13px; color: rgb(122, 113, 104); line-height: 1.6;">LapislÃ¡zuli o aguamarina. Abre la mente y conecta con la sabidurÃ­a.</div>
        </div>
        <div style="background:#f5f0fb;border-radius:16px;padding:28px;text-align:center;border:1px solid #cbbde8">
          <div style="font-size: 36px; margin-bottom: 12px;">ðŸŒˆ</div>
          <div style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 20px; color: rgb(123, 79, 166); margin-bottom: 8px;">Joya Arcoiris</div>
          <div style="font-size: 13px; color: rgb(122, 113, 104); line-height: 1.6;">Amatista o turmalina. Integra las tres puertas y eleva la vibraciÃ³n.</div>
        </div>
        <div style="background:linear-gradient(135deg,#fdf6ec,#f5eedd);border-radius:16px;padding:28px;text-align:center;border:1px solid #d4b87a">
          <div style="font-size: 36px; margin-bottom: 12px;">âœ¨</div>
          <div style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 20px; color: rgb(184, 149, 88); margin-bottom: 8px;">Joya Oro</div>
          <div style="font-size: 13px; color: rgb(122, 113, 104); line-height: 1.6;">Citrina o pirita dorada. La joya de la maestrÃ­a total y la abundancia.</div>
        </div>
      </div>
      <div style="margin-top: 40px; text-align: center;">
        <button onclick="goTo('auth')" style="background:#b89558;color:white;border:none;padding:14px 32px;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif">âœ¦ Descubrir mi Joya Personal</button>
      </div>
    </div>
  </div>

  <!-- TESTIMONIOS -->
  <div id="testimonios" style="background:#f0ece4;padding:80px 32px">
    <div style="max-width:1100px;margin:0 auto">
      <div style="font-size: 11px; font-weight: 700; color: rgb(122, 113, 104); text-transform: uppercase; letter-spacing: 0.15em; margin-bottom: 12px; text-align: center;">Testimonios</div>
      <h2 style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 42px; font-weight: 300; color: rgb(28, 24, 20); text-align: center; margin-bottom: 48px;">Lo que dicen nuestros alumnos</h2>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:24px">
        <div style="background:white;border-radius:16px;padding:28px;border:1px solid #e4ddd3">
          <div style="font-size: 14px; color: rgb(61, 55, 48); line-height: 1.8; margin-bottom: 20px; font-style: italic;">"El Sistema TCT ha transformado completamente mi relaciÃ³n con el cuerpo y la mente. Nunca pensÃ© que podrÃ­a experimentar tanta paz interior en mi vida cotidiana."</div>
          <div style="font-weight: 600; color: rgb(28, 24, 20); font-size: 13px;">MarÃ­a G.</div>
          <div style="font-size: 12px; color: rgb(122, 113, 104);">Puerta Azul completada</div>
        </div>
        <div style="background:white;border-radius:16px;padding:28px;border:1px solid #e4ddd3" class="">
          <div style="font-size: 14px; color: rgb(61, 55, 48); line-height: 1.8; margin-bottom: 20px; font-style: italic;">"Los cuencos tibetanos y los protocolos de sonido cambiaron mi forma de gestionar el estrÃ©s. Es una herramienta incomparable para el bienestar."</div>
          <div style="font-weight: 600; color: rgb(28, 24, 20); font-size: 13px;">Carlos M.</div>
          <div style="font-size: 12px; color: rgb(122, 113, 104);">Puerta Oro Â· Programa completo</div>
        </div>
        <div style="background:white;border-radius:16px;padding:28px;border:1px solid #e4ddd3">
          <div style="font-size: 14px; color: rgb(61, 55, 48); line-height: 1.8; margin-bottom: 20px; font-style: italic;">"Marga tiene un don especial para transmitir el conocimiento espiritual de forma prÃ¡ctica y accesible. Las canalizaciones son un regalo."</div>
          <div style="font-weight: 600; color: rgb(28, 24, 20); font-size: 13px;">Laura P.</div>
          <div style="font-size: 12px; color: rgb(122, 113, 104);">Puerta Arcoiris completada</div>
        </div>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer style="background:#111;padding:40px 32px;text-align:center">
    <div style="font-family: &quot;Cormorant Garamond&quot;, serif; font-size: 20px; color: white; margin-bottom: 8px;">Frecuencia Integral Academy</div>
    <div style="font-size: 12px; color: rgb(122, 113, 104); margin-bottom: 20px;">Sistema TCT Â· TransformaciÃ³n Consciente Trascendental</div>
    <button onclick="goTo('auth')" style="background:#2b7d7a;color:white;border:none;padding:12px 28px;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer">Comenzar mi TransformaciÃ³n â†’</button>
    <div style="margin-top: 28px; font-size: 11px; color: rgba(255, 255, 255, 0.25);">Â© 2026 Frecuencia Integral Academy Â· Todos los derechos reservados</div>
  </footer>


  
</div><!-- /page-public -->

<!-- PAGE: AUTH -->
<div class="page" id="page-auth">
  <div class="auth-wrap">
    <div class="auth-left">
      <h2>Entra en tu<br>espacio de<br><em>transformaciÃ³n</em></h2>
      <p>Accede a tus semanas de formaciÃ³n, ejercicios detallados, audios de cuencos tibetanos y tu joya personalizada.</p>
      <ul class="auth-perks">
        <li>48 semanas de contenido estructurado</li>
        <li>73+ ejercicios con instrucciones paso a paso</li>
        <li>Canalizaciones de Marga BarcelÃ³</li>
        <li>Frecuencias 432Hz, 528Hz, 963Hz</li>
        <li>Test de Joya Personalizada</li>
        <li>Progreso guardado en tiempo real</li>
      </ul>
    </div>
    <div class="auth-right">
      <div class="auth-box">
        <h3>Bienvenido</h3>
        <p class="sub">Accede a tu Ã¡rea de alumnos</p>
        <div class="auth-tabs">
          <button class="auth-tab active" id="tab-login" onclick="switchTab('login')">Iniciar SesiÃ³n</button>
          <button class="auth-tab" id="tab-register" onclick="switchTab('register')">Registrarse</button>
        </div>

        <div id="form-login">
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="inp-email" value="test@frecuenciaintegral.com">
          </div>
          <div class="form-group">
            <label>ContraseÃ±a</label>
            <input type="password" id="inp-pass" value="TestUser2026!">
          </div>
          <button class="btn-login" id="btn-login" onclick="doLogin()">Entrar al Ãrea de Alumnos</button>
          <div class="demo-hint">ðŸ”‘ Demo: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ec98899f98ac8a9e898f9989828f858d858298898b9e8d80c28f8381">[email&nbsp;protected]</a> / TestUser2026!</div>
        </div>

        <div id="form-register" style="display:none">
          <div class="form-group">
            <label>Nombre</label>
            <input type="text" id="inp-name" placeholder="Tu nombre completo">
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="inp-reg-email" placeholder="tu@email.com">
          </div>
          <div class="form-group">
            <label>ContraseÃ±a</label>
            <input type="password" id="inp-reg-pass" placeholder="MÃ­nimo 8 caracteres">
          </div>
          <button class="btn-login" id="btn-register" onclick="doRegister()">Crear Cuenta</button>
        </div>

        <a class="back-link" onclick="goTo('public')">â† Volver a la web</a>
      </div>
    </div>
  </div>
</div><!-- /page-auth -->

<!-- PAGE: STUDENT -->
<div class="page" id="page-student">
  <div class="student-wrap">

    <!-- SIDEBAR -->
    <div class="sidebar">
      <div class="sidebar-user">
        <div class="sidebar-name" id="sb-name">Alumno TCT</div>
        <div class="sidebar-email" id="sb-email">â€”</div>
        <div class="sidebar-badge" id="sb-plan">Puerta Oro</div>
      </div>
      <div class="sidebar-nav">
        <button class="nav-item active" onclick="showView('dashboard')"><span class="nav-item-icon">ðŸ </span>Dashboard</button>
        <button class="nav-item" onclick="showView('formaciones')"><span class="nav-item-icon">ðŸ“š</span>Formaciones</button>
        <button class="nav-item" onclick="showView('multimedia')"><span class="nav-item-icon">ðŸŽµ</span>Multimedia</button>
        <button class="nav-item" onclick="showView('materiales')"><span class="nav-item-icon">ðŸ“„</span>Materiales PDF</button>
        <button class="nav-item" onclick="showView('progreso')"><span class="nav-item-icon">ðŸ“Š</span>Mi Progreso</button>
        <button class="nav-item" style="margin-top:auto;color:rgba(255,255,255,.4)" onclick="doLogout()"><span class="nav-item-icon">ðŸšª</span>Cerrar SesiÃ³n</button>
      </div>
    </div>

    <!-- MAIN -->
    <div class="main-content">

      <!-- DASHBOARD VIEW -->
      <div id="view-dashboard">
        <h1 style="font-family:'Cormorant Garamond',serif;font-size:32px;font-weight:300;margin-bottom:8px">Bienvenido, <span id="dash-name">Alumno</span> âœ¦</h1>
        <p style="color:#7a7168;font-size:14px;margin-bottom:28px">Sistema TCT â€” Tu camino de transformaciÃ³n</p>
        <div class="dashboard-grid">
          <div class="stat-card">
            <div class="stat-label">Progreso General</div>
            <div class="stat-value" id="stat-progreso">0%</div>
            <div class="stat-sub" id="stat-sub-progreso">0 de 48 semanas</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Semana Actual</div>
            <div class="stat-value" id="stat-semana">1</div>
            <div class="stat-sub">En curso</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Puerta Actual</div>
            <div class="stat-value" style="font-size:28px" id="stat-puerta">ðŸŒ¿ Blanca</div>
            <div class="stat-sub">CimentaciÃ³n</div>
          </div>
        </div>
        <div style="display:flex;gap:12px;flex-wrap:wrap">
          <button class="btn-primary" onclick="showView('formaciones')">Ver Formaciones â†’</button>
          <button class="btn-ghost" onclick="showView('multimedia')">Biblioteca Multimedia</button>
        </div>
      </div>

      <!-- FORMACIONES VIEW -->
      <div id="view-formaciones" style="display:none">
        <h2 style="font-family:'Cormorant Garamond',serif;font-size:28px;font-weight:300;margin-bottom:20px">Las 48 Semanas</h2>
        <div class="filter-bar">
          <button class="filter-btn active" onclick="filterWeeks('all',this)">Todas</button>
          <button class="filter-btn" onclick="filterWeeks('Blanca',this)">ðŸŒ¿ Blanca</button>
          <button class="filter-btn" onclick="filterWeeks('Roja',this)">ðŸ”¥ Roja</button>
          <button class="filter-btn" onclick="filterWeeks('Azul',this)">ðŸ”µ Azul</button>
          <button class="filter-btn" onclick="filterWeeks('Arcoiris',this)">ðŸŒˆ Arcoiris</button>
        </div>
        <div class="weeks-grid" id="weeks-grid"><div class="week-card in-progress" onclick="openWeekModal(1)"><div class="week-num">Semana 1 Â· â–¶</div><div class="week-title">El Precio Oculto de Vivir Acelerados</div><div class="week-status" style="color:#b89558">En curso</div></div><div class="week-card" onclick="openWeekModal(2)"><div class="week-num">Semana 2 Â· â—‹</div><div class="week-title">Cuando Ganar Ya No Es Suficiente</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(3)"><div class="week-num">Semana 3 Â· â—‹</div><div class="week-title">Cuerpo, Mente y Consciencia: Una Sola Unidad</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(4)"><div class="week-num">Semana 4 Â· â—‹</div><div class="week-title">El Ego en la Vida Cotidiana</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(5)"><div class="week-num">Semana 5 Â· â—‹</div><div class="week-title">La EmociÃ³n, el Error y la PresiÃ³n como Camino</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(6)"><div class="week-num">Semana 6 Â· â—‹</div><div class="week-title">El Entrenamiento como VÃ­a de Despertar</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(7)"><div class="week-num">Semana 7 Â· â—‹</div><div class="week-title">El Campo de Consciencia Compartido</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(8)"><div class="week-num">Semana 8 Â· â—‹</div><div class="week-title">Sonido, VibraciÃ³n y ArmonizaciÃ³n del Sistema</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(9)"><div class="week-num">Semana 9 Â· â—‹</div><div class="week-title">Cuando el Sistema No Sostiene lo que Promete</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(10)"><div class="week-num">Semana 10 Â· â—‹</div><div class="week-title">El LÃ­mite como Punto de Despertar</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(11)"><div class="week-num">Semana 11 Â· â—‹</div><div class="week-title">MÃ¡s AllÃ¡ del Resultado: El Sentido del Camino</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(12)"><div class="week-num">Semana 12 Â· â—‹</div><div class="week-title">IntegraciÃ³n de la Puerta Blanca</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(13)"><div class="week-num">Semana 13 Â· â—‹</div><div class="week-title">IntroducciÃ³n a la Puerta Roja y la EnergÃ­a</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(14)"><div class="week-num">Semana 14 Â· â—‹</div><div class="week-title">El Sonido Primordial y los Mantras</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(15)"><div class="week-num">Semana 15 Â· â—‹</div><div class="week-title">Los 6 Reinos del Samsara y la GestiÃ³n Emocional</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(16)"><div class="week-num">Semana 16 Â· â—‹</div><div class="week-title">El Cuarto Camino - Recuerdo de SÃ­ y ObservaciÃ³n</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(17)"><div class="week-num">Semana 17 Â· â—‹</div><div class="week-title">El Cuarto Camino - Trabajo sobre los Centros</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(18)"><div class="week-num">Semana 18 Â· â—‹</div><div class="week-title">UCDM - La Paradoja de la Felicidad y el PerdÃ³n</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(19)"><div class="week-num">Semana 19 Â· â—‹</div><div class="week-title">UCDM - GestiÃ³n Emocional y el Instante Santo</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(20)"><div class="week-num">Semana 20 Â· â—‹</div><div class="week-title">Protocolos de Sonido - Purificar el Samsara</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(21)"><div class="week-num">Semana 21 Â· â—‹</div><div class="week-title">Protocolos de Sonido - El Pilar del Medio</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(22)"><div class="week-num">Semana 22 Â· â—‹</div><div class="week-title">Alquimia de la EnergÃ­a - La Cruz CabalÃ­stica</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(23)"><div class="week-num">Semana 23 Â· â—‹</div><div class="week-title">La FÃ³rmula de la Felicidad - AceptaciÃ³n</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(24)"><div class="week-num">Semana 24 Â· â—‹</div><div class="week-title">IntegraciÃ³n de la Puerta Roja</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(25)"><div class="week-num">Semana 25 Â· â—‹</div><div class="week-title">IntroducciÃ³n a la Puerta Azul y la Mente</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(26)"><div class="week-num">Semana 26 Â· â—‹</div><div class="week-title">La Mente segÃºn Diversas Tradiciones</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(27)"><div class="week-num">Semana 27 Â· â—‹</div><div class="week-title">Dzogchen - La Mente Natural (Rigpa)</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(28)"><div class="week-num">Semana 28 Â· â—‹</div><div class="week-title">La MetÃ¡fora del Espejo y la VisiÃ³n No-Dual</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(29)"><div class="week-num">Semana 29 Â· â—‹</div><div class="week-title">UCDM en la Puerta Azul - El Testigo Santo</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(30)"><div class="week-num">Semana 30 Â· â—‹</div><div class="week-title">El Ser Consciente - Vivir con Presencia</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(31)"><div class="week-num">Semana 31 Â· â—‹</div><div class="week-title">Protocolos de Sonido - DesintoxicaciÃ³n</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(32)"><div class="week-num">Semana 32 Â· â—‹</div><div class="week-title">Objetos Sagrados y el Proceso de LiberaciÃ³n</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(33)"><div class="week-num">Semana 33 Â· â—‹</div><div class="week-title">Manifestar la Fuerza Interior</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(34)"><div class="week-num">Semana 34 Â· â—‹</div><div class="week-title">TransformaciÃ³n de la Mente para la Felicidad</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(35)"><div class="week-num">Semana 35 Â· â—‹</div><div class="week-title">La Noche Oscura del Alma</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(36)"><div class="week-num">Semana 36 Â· â—‹</div><div class="week-title">IntegraciÃ³n de la Puerta Azul</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(37)"><div class="week-num">Semana 37 Â· â—‹</div><div class="week-title">SÃ­ntesis del MÃ©todo TCT - Las Tres Puertas</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(38)"><div class="week-num">Semana 38 Â· â—‹</div><div class="week-title">La Alquimia del Ser</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(39)"><div class="week-num">Semana 39 Â· â—‹</div><div class="week-title">El Campo Invisible que Todos Sostenemos</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(40)"><div class="week-num">Semana 40 Â· â—‹</div><div class="week-title">PrÃ¡ctica Integrada - El Diario del Cuarto Camino</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(41)"><div class="week-num">Semana 41 Â· â—‹</div><div class="week-title">PrÃ¡ctica Integrada - El Diario del PerdÃ³n</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(42)"><div class="week-num">Semana 42 Â· â—‹</div><div class="week-title">PrÃ¡ctica Integrada - El Diario de la Mente Feliz</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(43)"><div class="week-num">Semana 43 Â· â—‹</div><div class="week-title">El Arte de la No-Interferencia</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(44)"><div class="week-num">Semana 44 Â· â—‹</div><div class="week-title">El Legado Invisible - La Vida como Servicio</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(45)"><div class="week-num">Semana 45 Â· â—‹</div><div class="week-title">La ComunicaciÃ³n desde la Fuente</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(46)"><div class="week-num">Semana 46 Â· â—‹</div><div class="week-title">MaestrÃ­a en la Vida Cotidiana</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(47)"><div class="week-num">Semana 47 Â· â—‹</div><div class="week-title">El Ciclo Permanente - La Espiral de TransformaciÃ³n</div><div class="week-status" style="color:#a89e93">Pendiente</div></div><div class="week-card" onclick="openWeekModal(48)"><div class="week-num">Semana 48 Â· â—‹</div><div class="week-title">Cierre y ContinuaciÃ³n del Camino</div><div class="week-status" style="color:#a89e93">Pendiente</div></div></div>
      </div>

      <!-- MULTIMEDIA VIEW -->
      <div id="view-multimedia" style="display:none">
        <h2 style="font-family:'Cormorant Garamond',serif;font-size:28px;font-weight:300;margin-bottom:20px">Biblioteca Multimedia</h2>
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px" id="media-grid"><div style="background:white;border-radius:14px;overflow:hidden;border:1px solid #e4ddd3;cursor:pointer;transition:transform .2s,box-shadow .2s" onmouseover="this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.08)'" onmouseout="this.style.transform='';this.style.boxShadow=''" onclick="toast('Reproduciendo: Cuencos Tibetanos â€” Fundamentos ðŸŽµ')"><div style="background:#f5f2ec;height:100px;display:flex;align-items:center;justify-content:center;font-size:36px">ðŸŽµ</div><div style="padding:14px 16px"><div style="font-size:10px;font-weight:700;color:#7a7168;text-transform:uppercase;letter-spacing:.08em;margin-bottom:6px">Cuencos Â· 32 min</div><div style="font-size:13px;font-weight:500;color:#1c1814;line-height:1.4">Cuencos Tibetanos â€” Fundamentos</div></div></div><div style="background:white;border-radius:14px;overflow:hidden;border:1px solid #e4ddd3;cursor:pointer;transition:transform .2s,box-shadow .2s" onmouseover="this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.08)'" onmouseout="this.style.transform='';this.style.boxShadow=''" onclick="toast('Reproduciendo: CanalizaciÃ³n Marga â€” Puerta Blanca ðŸŽµ')"><div style="background:#fdf0ee;height:100px;display:flex;align-items:center;justify-content:center;font-size:36px">ðŸŒ¸</div><div style="padding:14px 16px"><div style="font-size:10px;font-weight:700;color:#7a7168;text-transform:uppercase;letter-spacing:.08em;margin-bottom:6px">CanalizaciÃ³n Â· 18 min</div><div style="font-size:13px;font-weight:500;color:#1c1814;line-height:1.4">CanalizaciÃ³n Marga â€” Puerta Blanca</div></div></div><div style="background:white;border-radius:14px;overflow:hidden;border:1px solid #e4ddd3;cursor:pointer;transition:transform .2s,box-shadow .2s" onmouseover="this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.08)'" onmouseout="this.style.transform='';this.style.boxShadow=''" onclick="toast('Reproduciendo: MeditaciÃ³n de Presencia Corporal ðŸŽµ')"><div style="background:#eef3fb;height:100px;display:flex;align-items:center;justify-content:center;font-size:36px">ðŸ§˜</div><div style="padding:14px 16px"><div style="font-size:10px;font-weight:700;color:#7a7168;text-transform:uppercase;letter-spacing:.08em;margin-bottom:6px">MeditaciÃ³n Â· 15 min</div><div style="font-size:13px;font-weight:500;color:#1c1814;line-height:1.4">MeditaciÃ³n de Presencia Corporal</div></div></div><div style="background:white;border-radius:14px;overflow:hidden;border:1px solid #e4ddd3;cursor:pointer;transition:transform .2s,box-shadow .2s" onmouseover="this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.08)'" onmouseout="this.style.transform='';this.style.boxShadow=''" onclick="toast('Reproduciendo: Frecuencia 432Hz â€” ArmonÃ­a Natural ðŸŽµ')"><div style="background:#f5f2ec;height:100px;display:flex;align-items:center;justify-content:center;font-size:36px">ðŸŒ¿</div><div style="padding:14px 16px"><div style="font-size:10px;font-weight:700;color:#7a7168;text-transform:uppercase;letter-spacing:.08em;margin-bottom:6px">Frecuencia Â· 40 min</div><div style="font-size:13px;font-weight:500;color:#1c1814;line-height:1.4">Frecuencia 432Hz â€” ArmonÃ­a Natural</div></div></div><div style="background:white;border-radius:14px;overflow:hidden;border:1px solid #e4ddd3;cursor:pointer;transition:transform .2s,box-shadow .2s" onmouseover="this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.08)'" onmouseout="this.style.transform='';this.style.boxShadow=''" onclick="toast('Reproduciendo: Cuencos â€” Nivel TerapÃ©utico ðŸŽµ')"><div style="background:#fdf0ee;height:100px;display:flex;align-items:center;justify-content:center;font-size:36px">ðŸ”¥</div><div style="padding:14px 16px"><div style="font-size:10px;font-weight:700;color:#7a7168;text-transform:uppercase;letter-spacing:.08em;margin-bottom:6px">Cuencos Â· 45 min</div><div style="font-size:13px;font-weight:500;color:#1c1814;line-height:1.4">Cuencos â€” Nivel TerapÃ©utico</div></div></div><div style="background:white;border-radius:14px;overflow:hidden;border:1px solid #e4ddd3;cursor:pointer;transition:transform .2s,box-shadow .2s" onmouseover="this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.08)'" onmouseout="this.style.transform='';this.style.boxShadow=''" onclick="toast('Reproduciendo: UCDM â€” IntroducciÃ³n al PerdÃ³n ðŸŽµ')"><div style="background:#fdf6ec;height:100px;display:flex;align-items:center;justify-content:center;font-size:36px">ðŸ’«</div><div style="padding:14px 16px"><div style="font-size:10px;font-weight:700;color:#7a7168;text-transform:uppercase;letter-spacing:.08em;margin-bottom:6px">TeorÃ­a Â· 28 min</div><div style="font-size:13px;font-weight:500;color:#1c1814;line-height:1.4">UCDM â€” IntroducciÃ³n al PerdÃ³n</div></div></div><div style="background:white;border-radius:14px;overflow:hidden;border:1px solid #e4ddd3;cursor:pointer;transition:transform .2s,box-shadow .2s" onmouseover="this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.08)'" onmouseout="this.style.transform='';this.style.boxShadow=''" onclick="toast('Reproduciendo: Dzogchen â€” IntroducciÃ³n a Rigpa ðŸŽµ')"><div style="background:#eef3fb;height:100px;display:flex;align-items:center;justify-content:center;font-size:36px">ðŸ”µ</div><div style="padding:14px 16px"><div style="font-size:10px;font-weight:700;color:#7a7168;text-transform:uppercase;letter-spacing:.08em;margin-bottom:6px">TeorÃ­a Â· 35 min</div><div style="font-size:13px;font-weight:500;color:#1c1814;line-height:1.4">Dzogchen â€” IntroducciÃ³n a Rigpa</div></div></div><div style="background:white;border-radius:14px;overflow:hidden;border:1px solid #e4ddd3;cursor:pointer;transition:transform .2s,box-shadow .2s" onmouseover="this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 24px rgba(0,0,0,.08)'" onmouseout="this.style.transform='';this.style.boxShadow=''" onclick="toast('Reproduciendo: Frecuencia 963Hz â€” La Luz ðŸŽµ')"><div style="background:#eef3fb;height:100px;display:flex;align-items:center;justify-content:center;font-size:36px">âœ¨</div><div style="padding:14px 16px"><div style="font-size:10px;font-weight:700;color:#7a7168;text-transform:uppercase;letter-spacing:.08em;margin-bottom:6px">Frecuencia Â· 48 min</div><div style="font-size:13px;font-weight:500;color:#1c1814;line-height:1.4">Frecuencia 963Hz â€” La Luz</div></div></div></div>
      </div>

      <!-- MATERIALES VIEW -->
      <div id="view-materiales" style="display:none">
        <h2 style="font-family:'Cormorant Garamond',serif;font-size:28px;font-weight:300;margin-bottom:8px">Materiales PDF</h2>
        <p style="color:#7a7168;font-size:14px;margin-bottom:28px">Descarga o visualiza los libros y documentos de tu programa</p>
        <div id="materiales-content"></div>
      </div>

      <!-- PROGRESO VIEW -->
      <div id="view-progreso" style="display:none">
        <h2 style="font-family:'Cormorant Garamond',serif;font-size:28px;font-weight:300;margin-bottom:20px">Mi Progreso</h2>
        <div id="progreso-list"></div>
      </div>

    </div>
  </div>
</div><!-- /page-student -->

<!-- MODAL SEMANA -->
<div class="modal-overlay" id="week-modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-header-left">
        <div class="modal-week-badge" id="modal-badge">ðŸ“š</div>
        <div>
          <div class="modal-title" id="modal-title">Semana</div>
          <div class="modal-puerta-tag" id="modal-puerta"></div>
        </div>
      </div>
      <button class="modal-close" onclick="closeModal()">âœ•</button>
    </div>
    <div class="modal-layout">
      <!-- Sidebar navegaciÃ³n -->
      <div class="modal-sidebar">
        <button class="modal-nav-btn active" onclick="switchModalTab(0,this)" data-tab="0">
          <span class="modal-nav-icon">ðŸ“–</span>DescripciÃ³n
        </button>
        <button class="modal-nav-btn" onclick="switchModalTab(1,this)" data-tab="1">
          <span class="modal-nav-icon">ðŸ’¡</span>Conceptos
        </button>
        <button class="modal-nav-btn" onclick="switchModalTab(2,this)" data-tab="2">
          <span class="modal-nav-icon">ðŸ§˜</span>Ejercicio
        </button>
        <button class="modal-nav-btn" onclick="switchModalTab(3,this)" data-tab="3">
          <span class="modal-nav-icon">ðŸ“„</span>Materiales
        </button>
        <button class="modal-nav-btn" onclick="switchModalTab(4,this)" data-tab="4">
          <span class="modal-nav-icon">âœ…</span>Completar
        </button>
      </div>
      <!-- Contenido -->
      <div class="modal-body">
        <div id="modal-content"></div>
      </div>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
// â”€â”€ CONFIG SUPABASE â”€â”€
const SB_URL  = 'https://jtwbbyjspanirbsuoipa.supabase.co';
const SB_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp0d2JieWpzcGFuaXJic3VvaXBhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1MjcwMTMsImV4cCI6MjA4NzEwMzAxM30.EnKFo0Hedbhja3Lgy0FR99U9FACY6ZyoadnteoyONns';

// â”€â”€ STATE â”€â”€
let sb = null;
let user = null;
let completedWeeks = [];
let currentWeek = 1;
let currentFilter = 'all';
let weekData = {};

// â”€â”€ INIT â”€â”€
window.addEventListener('DOMContentLoaded', function() {
  // Init Supabase
  if (window.supabase) {
    sb = window.supabase.createClient(SB_URL, SB_ANON);
    sb.auth.onAuthStateChange(function(event, session) {
      if (event === 'SIGNED_IN' && session) onLogin(session.user);
      if (event === 'SIGNED_OUT') onLogout();
    });
    sb.auth.getSession().then(function(r) {
      if (r.data.session) onLogin(r.data.session.user);
    });
  }
  renderWeeks();
  renderMedia();
});

// â”€â”€ NAVIGATION â”€â”€
function goTo(page) {
  document.querySelectorAll('.page').forEach(function(p){ p.classList.remove('active'); });
  document.getElementById('page-' + page).classList.add('active');
  window.scrollTo(0,0);
  if (page === 'student') refreshDashboard();
}

function showView(view) {
  ['dashboard','formaciones','multimedia','materiales','progreso'].forEach(function(v){
    document.getElementById('view-' + v).style.display = v === view ? 'block' : 'none';
  });
  document.querySelectorAll('.nav-item').forEach(function(btn){
    btn.classList.remove('active');
  });
  event.currentTarget.classList.add('active');
  if (view === 'progreso') renderProgreso();
  if (view === 'materiales') renderMateriales();
}

// â”€â”€ AUTH â”€â”€
function switchTab(tab) {
  document.getElementById('form-login').style.display = tab === 'login' ? 'block' : 'none';
  document.getElementById('form-register').style.display = tab === 'register' ? 'block' : 'none';
  document.getElementById('tab-login').classList.toggle('active', tab === 'login');
  document.getElementById('tab-register').classList.toggle('active', tab === 'register');
}

async function doLogin() {
  const email = document.getElementById('inp-email').value.trim();
  const pass  = document.getElementById('inp-pass').value;
  if (!email || !pass) { toast('Completa email y contraseÃ±a'); return; }

  const btn = document.getElementById('btn-login');
  btn.textContent = 'Conectando...';
  btn.disabled = true;

  try {
    if (sb) {
      const { data, error } = await sb.auth.signInWithPassword({ email, password: pass });
      if (error) throw error;
    } else {
      // Demo fallback
      if (email !== 'test@frecuenciaintegral.com') throw new Error('Email incorrecto');
      if (pass !== 'TestUser2026!') throw new Error('ContraseÃ±a incorrecta');
      user = { id: 'demo', email, user_metadata: { full_name: 'Alumno TCT' } };
      onLogin(user);
    }
  } catch(e) {
    // Fallback demo
    if (email === 'test@frecuenciaintegral.com' && pass === 'TestUser2026!') {
      user = { id: 'demo', email, user_metadata: { full_name: 'Alumno TCT' } };
      onLogin(user);
    } else {
      toast('Error: ' + e.message);
    }
  }

  btn.textContent = 'Entrar al Ãrea de Alumnos';
  btn.disabled = false;
}

async function doRegister() {
  const name  = document.getElementById('inp-name').value.trim();
  const email = document.getElementById('inp-reg-email').value.trim();
  const pass  = document.getElementById('inp-reg-pass').value;
  if (!name || !email || !pass) { toast('Completa todos los campos'); return; }
  if (pass.length < 8) { toast('ContraseÃ±a mÃ­nimo 8 caracteres'); return; }

  const btn = document.getElementById('btn-register');
  btn.textContent = 'Creando cuenta...';
  btn.disabled = true;

  try {
    if (sb) {
      const { error } = await sb.auth.signUp({ email, password: pass, options: { data: { full_name: name } } });
      if (error) throw error;
      toast('Revisa tu email para confirmar la cuenta âœ‰ï¸');
    }
  } catch(e) {
    toast('Error: ' + e.message);
  }

  btn.textContent = 'Crear Cuenta';
  btn.disabled = false;
}

// â”€â”€ ADMIN EMAILS (solo administradores reales) â”€â”€
const ADMIN_EMAILS = ['quico@frecuenciaintegral.com', 'admin@frecuenciaintegral.com'];

async function onLogin(u) {
  user = u;
  const name = u.user_metadata?.full_name || u.email.split('@')[0];

  // Cargar perfil completo (role + plan)
  let userRole = 'alumno';
  let userPlan = 'Blanca';
  if (sb && u.id !== 'demo') {
    try {
      const { data: profile } = await sb.from('profiles').select('role, plan').eq('id', u.id).single();
      if (profile) {
        userRole = profile.role || 'alumno';
        userPlan = profile.plan || 'Blanca';
      }
    } catch(e) { console.log('No profile yet'); }
  }

  const isAdmin = userRole === 'admin' || ADMIN_EMAILS.includes(u.email);

  // Cargar progreso
  if (sb && u.id !== 'demo') {
    try {
      const { data } = await sb.from('user_progress').select('week_number,status').eq('user_id', u.id);
      if (data) {
        completedWeeks = data.filter(function(p){ return p.status === 'completed'; }).map(function(p){ return p.week_number; });
        const inProg = data.find(function(p){ return p.status === 'in_progress'; });
        currentWeek = inProg ? inProg.week_number : (completedWeeks.length + 1);
      }
    } catch(e) { console.log('No progress table yet'); }
  }

  // Guardar plan en estado global
  user._plan = userPlan;
  user._role = userRole;

  // Actualizar sidebar
  document.getElementById('sb-name').textContent = name;
  document.getElementById('sb-email').textContent = u.email;
  document.getElementById('sb-plan').textContent = 'âœ¨ Puerta ' + userPlan;
  document.getElementById('sb-plan').style.background = 
    userPlan === 'Oro' ? '#b89558' :
    userPlan === 'Arcoiris' ? '#7b4fa6' :
    userPlan === 'Azul' ? '#2c5f9e' :
    userPlan === 'Roja' ? '#bf4637' : '#8a8078';

  document.getElementById('btnLogin').style.display = 'none';
  document.getElementById('btnInscribirse').style.display = 'none';
  document.getElementById('btnDash').style.display = '';
  document.getElementById('btnLogout').style.display = '';
  document.getElementById('btnAdmin').style.display = isAdmin ? '' : 'none';

  goTo('student');
  toast('Bienvenido/a, ' + name + '! âœ¨');
}

function onLogout() {
  user = null;
  completedWeeks = [];
  currentWeek = 1;
  document.getElementById('btnLogin').style.display = '';
  document.getElementById('btnInscribirse').style.display = '';
  document.getElementById('btnDash').style.display = 'none';
  document.getElementById('btnLogout').style.display = 'none';
  document.getElementById('btnAdmin').style.display = 'none';
}

async function doLogout() {
  if (sb) await sb.auth.signOut();
  onLogout();
  goTo('public');
  toast('SesiÃ³n cerrada');
}

// â”€â”€ DASHBOARD â”€â”€
function refreshDashboard() {
  const name = user ? (user.user_metadata?.full_name || user.email.split('@')[0]) : 'Alumno';
  document.getElementById('dash-name').textContent = name;
  const pct = Math.round((completedWeeks.length / 48) * 100);
  document.getElementById('stat-progreso').textContent = pct + '%';
  document.getElementById('stat-sub-progreso').textContent = completedWeeks.length + ' de 48 semanas';
  document.getElementById('stat-semana').textContent = currentWeek;
  const puerta = currentWeek <= 12 ? 'ðŸŒ¿ Blanca' : currentWeek <= 24 ? 'ðŸ”¥ Roja' : currentWeek <= 36 ? 'ðŸ”µ Azul' : 'ðŸŒˆ Arcoiris';
  document.getElementById('stat-puerta').textContent = puerta;
  renderWeeks();
}

// â”€â”€ WEEKS â”€â”€
const WEEKS_DATA = [
  {w:1,p:'Blanca',t:'El Precio Oculto de Vivir Acelerados'},
  {w:2,p:'Blanca',t:'Cuando Ganar Ya No Es Suficiente'},
  {w:3,p:'Blanca',t:'Cuerpo, Mente y Consciencia: Una Sola Unidad'},
  {w:4,p:'Blanca',t:'El Ego en la Vida Cotidiana'},
  {w:5,p:'Blanca',t:'La EmociÃ³n, el Error y la PresiÃ³n como Camino'},
  {w:6,p:'Blanca',t:'El Entrenamiento como VÃ­a de Despertar'},
  {w:7,p:'Blanca',t:'El Campo de Consciencia Compartido'},
  {w:8,p:'Blanca',t:'Sonido, VibraciÃ³n y ArmonizaciÃ³n del Sistema'},
  {w:9,p:'Blanca',t:'Cuando el Sistema No Sostiene lo que Promete'},
  {w:10,p:'Blanca',t:'El LÃ­mite como Punto de Despertar'},
  {w:11,p:'Blanca',t:'MÃ¡s AllÃ¡ del Resultado: El Sentido del Camino'},
  {w:12,p:'Blanca',t:'IntegraciÃ³n de la Puerta Blanca'},
  {w:13,p:'Roja',t:'IntroducciÃ³n a la Puerta Roja y la EnergÃ­a'},
  {w:14,p:'Roja',t:'El Sonido Primordial y los Mantras'},
  {w:15,p:'Roja',t:'Los 6 Reinos del Samsara y la GestiÃ³n Emocional'},
  {w:16,p:'Roja',t:'El Cuarto Camino - Recuerdo de SÃ­ y ObservaciÃ³n'},
  {w:17,p:'Roja',t:'El Cuarto Camino - Trabajo sobre los Centros'},
  {w:18,p:'Roja',t:'UCDM - La Paradoja de la Felicidad y el PerdÃ³n'},
  {w:19,p:'Roja',t:'UCDM - GestiÃ³n Emocional y el Instante Santo'},
  {w:20,p:'Roja',t:'Protocolos de Sonido - Purificar el Samsara'},
  {w:21,p:'Roja',t:'Protocolos de Sonido - El Pilar del Medio'},
  {w:22,p:'Roja',t:'Alquimia de la EnergÃ­a - La Cruz CabalÃ­stica'},
  {w:23,p:'Roja',t:'La FÃ³rmula de la Felicidad - AceptaciÃ³n'},
  {w:24,p:'Roja',t:'IntegraciÃ³n de la Puerta Roja'},
  {w:25,p:'Azul',t:'IntroducciÃ³n a la Puerta Azul y la Mente'},
  {w:26,p:'Azul',t:'La Mente segÃºn Diversas Tradiciones'},
  {w:27,p:'Azul',t:'Dzogchen - La Mente Natural (Rigpa)'},
  {w:28,p:'Azul',t:'La MetÃ¡fora del Espejo y la VisiÃ³n No-Dual'},
  {w:29,p:'Azul',t:'UCDM en la Puerta Azul - El Testigo Santo'},
  {w:30,p:'Azul',t:'El Ser Consciente - Vivir con Presencia'},
  {w:31,p:'Azul',t:'Protocolos de Sonido - DesintoxicaciÃ³n'},
  {w:32,p:'Azul',t:'Objetos Sagrados y el Proceso de LiberaciÃ³n'},
  {w:33,p:'Azul',t:'Manifestar la Fuerza Interior'},
  {w:34,p:'Azul',t:'TransformaciÃ³n de la Mente para la Felicidad'},
  {w:35,p:'Azul',t:'La Noche Oscura del Alma'},
  {w:36,p:'Azul',t:'IntegraciÃ³n de la Puerta Azul'},
  {w:37,p:'Arcoiris',t:'SÃ­ntesis del MÃ©todo TCT - Las Tres Puertas'},
  {w:38,p:'Arcoiris',t:'La Alquimia del Ser'},
  {w:39,p:'Arcoiris',t:'El Campo Invisible que Todos Sostenemos'},
  {w:40,p:'Arcoiris',t:'PrÃ¡ctica Integrada - El Diario del Cuarto Camino'},
  {w:41,p:'Arcoiris',t:'PrÃ¡ctica Integrada - El Diario del PerdÃ³n'},
  {w:42,p:'Arcoiris',t:'PrÃ¡ctica Integrada - El Diario de la Mente Feliz'},
  {w:43,p:'Arcoiris',t:'El Arte de la No-Interferencia'},
  {w:44,p:'Arcoiris',t:'El Legado Invisible - La Vida como Servicio'},
  {w:45,p:'Arcoiris',t:'La ComunicaciÃ³n desde la Fuente'},
  {w:46,p:'Arcoiris',t:'MaestrÃ­a en la Vida Cotidiana'},
  {w:47,p:'Arcoiris',t:'El Ciclo Permanente - La Espiral de TransformaciÃ³n'},
  {w:48,p:'Arcoiris',t:'Cierre y ContinuaciÃ³n del Camino'}
];

function renderWeeks() {
  const grid = document.getElementById('weeks-grid');
  if (!grid) return;
  const filtered = currentFilter === 'all' ? WEEKS_DATA : WEEKS_DATA.filter(function(w){ return w.p === currentFilter; });
  grid.innerHTML = filtered.map(function(w) {
    const done = completedWeeks.includes(w.w);
    const cur  = w.w === currentWeek;
    const icon = done ? 'âœ…' : cur ? 'â–¶' : 'â—‹';
    const cls  = done ? 'week-card completed' : cur ? 'week-card in-progress' : 'week-card';
    return '<div class="' + cls + '" onclick="openWeekModal(' + w.w + ')">' +
      '<div class="week-num">Semana ' + w.w + ' Â· ' + icon + '</div>' +
      '<div class="week-title">' + w.t + '</div>' +
      '<div class="week-status" style="color:' + (done?'#2b7d7a':cur?'#b89558':'#a89e93') + '">' +
      (done ? 'Completada' : cur ? 'En curso' : 'Pendiente') + '</div>' +
    '</div>';
  }).join('');
}

function filterWeeks(puerta, btn) {
  currentFilter = puerta;
  document.querySelectorAll('.filter-btn').forEach(function(b){ b.classList.remove('active'); });
  btn.classList.add('active');
  renderWeeks();
}

// â”€â”€ WEEK MODAL â”€â”€
let currentModalWeek = null;

function openWeekModal(weekNum) {
  currentModalWeek = weekNum;
  const w = WEEKS_DATA.find(function(x){ return x.x === weekNum; }) || WEEKS_DATA[weekNum-1];
  const done = completedWeeks.includes(weekNum);
  const colors = {Blanca:'#b8ad9e',Roja:'#bf4637',Azul:'#2c5f9e',Arcoiris:'#7b4fa6'};
  const color = colors[w.p] || '#2b7d7a';

  document.getElementById('modal-title').textContent = 'Semana ' + weekNum + ': ' + w.t;
  document.getElementById('modal-puerta').textContent = 'âœ¦ Puerta ' + w.p + (done ? ' Â· âœ… Completada' : '');

  // Get exercise data from global if available
  const d = (typeof WD !== 'undefined') ? WD[weekNum] : null;

  const tabs = [
    // Tab 0: DescripciÃ³n
    '<div style="background:#f7f5f1;border-radius:12px;padding:20px;border-left:3px solid ' + color + '">' +
    '<div style="font-size:11px;font-weight:700;color:#7a7168;text-transform:uppercase;letter-spacing:.08em;margin-bottom:10px">Material de Estudio</div>' +
    '<p style="font-size:14px;line-height:1.75;color:#3d3730">' + (d ? d.m : 'Contenido de la semana ' + weekNum + '.') + '</p></div>',

    // Tab 1: Conceptos
    d && d.c && d.c.length > 0
      ? d.c.map(function(c){ return '<div class="concept-card" style="border-color:' + color + '"><div class="concept-name">' + c[0] + '</div><div class="concept-desc">' + c[1] + '</div></div>'; }).join('')
      : '<p style="color:#7a7168;font-size:14px">Conceptos clave de la semana ' + weekNum + '.</p>',

    // Tab 2: Ejercicio
    (function() {
      if (!d || !d.et) return '<p style="color:#7a7168;font-size:14px">Ejercicio prÃ¡ctico de la semana ' + weekNum + '.</p>';
      return '<div style="background:linear-gradient(135deg,' + color + '18,' + color + '08);border:1px solid ' + color + '30;border-radius:14px;padding:20px;margin-bottom:20px">' +
        '<div style="font-size:11px;font-weight:700;color:#7a7168;text-transform:uppercase;letter-spacing:.08em;margin-bottom:8px">âœ¦ Ejercicio PrÃ¡ctico</div>' +
        '<div style="font-family:\'Cormorant Garamond\',serif;font-size:18px;font-weight:400;margin-bottom:10px">' + d.et + '</div>' +
        (d.eo ? '<div style="font-size:13px;color:#3d3730;font-style:italic">Objetivo: ' + d.eo + '</div>' : '') +
        (d.er ? '<div style="font-size:11px;color:#a89e93;margin-top:8px">ðŸ“š ' + d.er + '</div>' : '') +
        '</div>' +
        (d.ep && d.ep.length > 0 ? '<div>' + d.ep.map(function(p,i){ return '<div class="exercise-step"><div class="step-num">' + (i+1) + '</div><div class="step-text">' + p + '</div></div>'; }).join('') + '</div>' : '');
    })(),

    // Tab 3: Materiales PDF
    (function() {
      var pdfs = MATERIALES[w.p] ? MATERIALES[w.p].pdfs : [];
      if (pdfs.length === 0) return '<p style="color:#7a7168;font-size:14px">No hay materiales para esta puerta.</p>';
      var mcolor = MATERIALES[w.p] ? MATERIALES[w.p].color : '#2b7d7a';
      return '<div style="margin-bottom:12px;font-size:12px;color:#7a7168">Materiales de la <strong>Puerta ' + w.p + '</strong></div>' +
        pdfs.map(function(pdf, i) {
          var mid = 'modal-pdf-' + weekNum + '-' + i;
          return '<div class="pdf-card">' +
            '<div class="pdf-card-header" onclick="togglePdfViewer(\'' + mid + '\')">' +
              '<div class="pdf-icon">ðŸ“„</div>' +
              '<div class="pdf-info"><div class="pdf-name" style="font-size:13px">' + pdf.name + '</div><div class="pdf-meta">PDF Â· Haz clic para ver</div></div>' +
              '<div class="pdf-actions">' +
                '<button class="btn-pdf-view" onclick="event.stopPropagation();togglePdfViewer(\'' + mid + '\')">ðŸ‘ Ver</button>' +
                '<a class="btn-pdf-dl" href="' + pdf.url + '" download target="_blank" onclick="event.stopPropagation()">â¬‡</a>' +
              '</div>' +
            '</div>' +
            '<div class="pdf-viewer-wrap" id="' + mid + '">' +
              '<div class="pdf-viewer-bar"><span>' + pdf.name + '</span><button class="btn-pdf-close" onclick="togglePdfViewer(\'' + mid + '\')">âœ•</button></div>' +
              '<iframe src="" data-src="' + pdf.url + '" loading="lazy"></iframe>' +
            '</div>' +
          '</div>';
        }).join('');
    })(),

    // Tab 4: Completar
    '<div>' +
    ['He leÃ­do el material de estudio','He realizado el ejercicio prÃ¡ctico','He escuchado el audio de la semana','He anotado mis reflexiones'].map(function(t,i){
      return '<div class="task-item" id="task-' + weekNum + '-' + i + '" onclick="toggleTask(' + weekNum + ',' + i + ')"><div class="task-cb"></div><div class="task-text">' + t + '</div></div>';
    }).join('') +
    '<button class="btn-complete" onclick="markComplete(' + weekNum + ')" ' + (done ? 'disabled style="background:#d1c8bc"' : '') + '>' +
    (done ? 'âœ… Semana Completada' : 'âœ¦ Marcar como Completada') + '</button></div>'
  ];

  document.getElementById('modal-content').innerHTML =
    tabs.map(function(content, i){ return '<div class="tab-content ' + (i===0?'active':'') + '" id="modal-tab-' + i + '">' + content + '</div>'; }).join('');

  // Set badge icon
  const icons = {Blanca:'ðŸŒ¿', Roja:'ðŸ”¥', Azul:'ðŸ”µ', Arcoiris:'ðŸŒˆ'};
  const badgeColors = {Blanca:'#f0ede8', Roja:'#fdecea', Azul:'#e8eef8', Arcoiris:'#f3edf8'};
  document.getElementById('modal-badge').textContent = icons[w.p] || 'ðŸ“š';
  document.getElementById('modal-badge').style.background = badgeColors[w.p] || '#e8f4f3';

  // Reset sidebar nav
  document.querySelectorAll('.modal-nav-btn').forEach(function(t,i){ t.classList.toggle('active', i===0); });
  document.getElementById('week-modal').classList.add('open');
}

function closeModal() {
  document.getElementById('week-modal').classList.remove('open');
}

function switchModalTab(idx, btn) {
  document.querySelectorAll('.tab-content').forEach(function(t){ t.classList.remove('active'); });
  document.getElementById('modal-tab-' + idx).classList.add('active');
  document.querySelectorAll('.modal-nav-btn').forEach(function(t){ t.classList.remove('active'); });
  btn.classList.add('active');
}

function toggleTask(weekNum, idx) {
  document.getElementById('task-' + weekNum + '-' + idx).classList.toggle('done');
}

async function markComplete(weekNum) {
  const w = WEEKS_DATA[weekNum-1];
  if (sb && user && user.id !== 'demo') {
    try {
      await sb.from('user_progress').upsert({
        user_id: user.id, week_number: weekNum,
        puerta: w.p, status: 'completed',
        completion_percentage: 100,
        completed_at: new Date().toISOString()
      }, { onConflict: 'user_id,week_number' });
      if (weekNum < 48) {
        await sb.from('user_progress').upsert({
          user_id: user.id, week_number: weekNum+1,
          puerta: WEEKS_DATA[weekNum].p, status: 'in_progress',
          completion_percentage: 0
        }, { onConflict: 'user_id,week_number' });
      }
    } catch(e) { console.log('Error saving:', e); }
  }
  if (!completedWeeks.includes(weekNum)) completedWeeks.push(weekNum);
  if (weekNum === currentWeek && currentWeek < 48) currentWeek++;
  closeModal();
  refreshDashboard();
  toast('Semana ' + weekNum + ' completada! ðŸŽ‰');
}

// â”€â”€ MATERIALES PDF â”€â”€
const MATERIALES = {
  'Blanca': {
    icon: 'ðŸŒ¿', color: '#b8ad9e',
    pdfs: [
      { name: 'El Deportista Consciente â€” MÃ¡s allÃ¡ del resultado', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20%20BLANCA/El-deportista-consciente-Mas-alla-del-resultado.pdf' },
      { name: 'TCT-I â€” Puerta Blanca', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20%20BLANCA/TCT-I-PUERTA-BLANCA.pdf' }
    ]
  },
  'Roja': {
    icon: 'ðŸ”¥', color: '#bf4637',
    pdfs: [
      { name: 'TCT-II â€” Puerta Roja', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20ROJA/TCT-II-PUERTA-ROJA.pdf' },
      { name: 'El Deportista Consciente â€” MÃ¡s allÃ¡ del resultado', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20ROJA/El-deportista-consciente-Mas-alla-del-resultado.pdf' },
      { name: 'El Ser Consciente â€” MÃ¡s allÃ¡ de la acciÃ³n', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20ROJA/El-Ser-Consciente-Mas-alla-de-la-accion-Vivir-con-presencia-en-la-vida-cotidiana.pdf' }
    ]
  },
  'Azul': {
    icon: 'ðŸ”µ', color: '#2c5f9e',
    pdfs: [
      { name: 'TCT-III â€” Puerta Azul', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20AZUL/TCT-III-PUERTA-AZUL.pdf' },
      { name: 'TCT-IV â€” Anexos', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20AZUL/TCT-IV-PUERTA-ANEXOS.pdf' },
      { name: 'El Deportista Consciente â€” MÃ¡s allÃ¡ del resultado', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20AZUL/El-deportista-consciente-Mas-alla-del-resultado.pdf' },
      { name: 'El Ser Consciente â€” MÃ¡s allÃ¡ de la acciÃ³n', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20AZUL/El-Ser-Consciente-Mas-alla-de-la-accion-Vivir-con-presencia-en-la-vida-cotidiana.pdf' }
    ]
  },
  'Arcoiris': {
    icon: 'ðŸŒˆ', color: '#7b4fa6',
    pdfs: [
      { name: 'TCT-I â€” Puerta Blanca', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20ARCOIRIS/TCT-I-PUERTA-BLANCA.pdf' },
      { name: 'TCT-II â€” Puerta Roja', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20ARCOIRIS/TCT-II-PUERTA-ROJA.pdf' },
      { name: 'TCT-III â€” Puerta Azul', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20ARCOIRIS/TCT-III-PUERTA-AZUL.pdf' },
      { name: 'TCT-IV â€” Anexos', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20ARCOIRIS/TCT-IV-PUERTA-ANEXOS.pdf' },
      { name: 'El Ser Consciente â€” MÃ¡s allÃ¡ de la acciÃ³n', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20ARCOIRIS/El-Ser-Consciente-Mas-alla-de-la-accion-Vivir-con-presencia-en-la-vida-cotidiana.pdf' },
      { name: 'El Deportista Consciente â€” MÃ¡s allÃ¡ del resultado', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20ARCOIRIS/El-deportista-consciente-Mas-alla-del-resultado.pdf' }
    ]
  },
  'Oro': {
    icon: 'âœ¨', color: '#b89558',
    pdfs: [
      { name: 'TCT-I â€” Puerta Blanca', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20ARCOIRIS/TCT-I-PUERTA-BLANCA.pdf' },
      { name: 'TCT-II â€” Puerta Roja', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20ARCOIRIS/TCT-II-PUERTA-ROJA.pdf' },
      { name: 'TCT-III â€” Puerta Azul', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20ARCOIRIS/TCT-III-PUERTA-AZUL.pdf' },
      { name: 'TCT-IV â€” Anexos', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20ARCOIRIS/TCT-IV-PUERTA-ANEXOS.pdf' },
      { name: 'El Ser Consciente â€” MÃ¡s allÃ¡ de la acciÃ³n', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20ARCOIRIS/El-Ser-Consciente-Mas-alla-de-la-accion-Vivir-con-presencia-en-la-vida-cotidiana.pdf' },
      { name: 'El Deportista Consciente â€” MÃ¡s allÃ¡ del resultado', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20ARCOIRIS/El-deportista-consciente-Mas-alla-del-resultado.pdf' },
      { name: 'PresentaciÃ³n PDL â€” Arte y Espiritualidad', url: 'https://jtwbbyjspanirbsuoipa.supabase.co/storage/v1/object/public/materiales/PUERTA%20ORO/PRESENTACION-PDL-ARTE-Y-ESPIRITUALIDAD.pdf' }
    ]
  }
};

var _pdfViewerOpen = {};

function renderMateriales() {
  var puertaActual = currentWeek <= 12 ? 'Blanca' : currentWeek <= 24 ? 'Roja' : currentWeek <= 36 ? 'Azul' : 'Arcoiris';
  var puertas = ['Blanca','Roja','Azul','Arcoiris','Oro'];
  var html = '';
  puertas.forEach(function(p) {
    var m = MATERIALES[p];
    var pdfsHtml = m.pdfs.map(function(pdf, i) {
      var id = 'pdf-' + p + '-' + i;
      var shortName = pdf.name.length > 50 ? pdf.name.substring(0,48)+'â€¦' : pdf.name;
      return '<div class="pdf-card">' +
        '<div class="pdf-card-header" onclick="togglePdfViewer(\'' + id + '\')">' +
          '<div class="pdf-icon">ðŸ“„</div>' +
          '<div class="pdf-info"><div class="pdf-name">' + shortName + '</div><div class="pdf-meta">PDF Â· Haz clic para ver</div></div>' +
          '<div class="pdf-actions">' +
            '<button class="btn-pdf-view" onclick="event.stopPropagation();togglePdfViewer(\'' + id + '\')">ðŸ‘ Ver</button>' +
            '<a class="btn-pdf-dl" href="' + pdf.url + '" download target="_blank" onclick="event.stopPropagation()">â¬‡ Descargar</a>' +
          '</div>' +
        '</div>' +
        '<div class="pdf-viewer-wrap" id="' + id + '">' +
          '<div class="pdf-viewer-bar"><span>' + pdf.name + '</span><button class="btn-pdf-close" onclick="togglePdfViewer(\'' + id + '\')">âœ•</button></div>' +
          '<iframe src="" data-src="' + pdf.url + '" loading="lazy"></iframe>' +
        '</div>' +
      '</div>';
    }).join('');
    html += '<div class="materiales-puerta">' +
      '<div class="materiales-puerta-title" style="color:' + m.color + '">' +
        '<span style="font-size:22px">' + m.icon + '</span> Puerta ' + p +
      '</div>' +
      pdfsHtml +
    '</div>';
  });
  document.getElementById('materiales-content').innerHTML = html;
}

function togglePdfViewer(id) {
  // Find the iframe data-src from the inline viewer (kept in DOM but hidden)
  var wrap = document.getElementById(id);
  var iframe = wrap ? wrap.querySelector('iframe') : null;
  var url = iframe ? iframe.getAttribute('data-src') : null;
  // Find name from the card
  var card = wrap ? wrap.closest('.pdf-card') : null;
  var name = card ? card.querySelector('.pdf-name').textContent : 'Documento PDF';
  if (url) openPdfFullscreen(url, name);
}

function openPdfFullscreen(url, name) {
  document.getElementById('pdf-fullscreen-name').textContent = name;
  document.getElementById('pdf-fullscreen-frame').src = url;
  document.getElementById('pdf-fullscreen-dl').href = url;
  document.getElementById('pdf-fullscreen-modal').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closePdfFullscreen() {
  document.getElementById('pdf-fullscreen-modal').classList.remove('open');
  document.getElementById('pdf-fullscreen-frame').src = '';
  document.body.style.overflow = '';
}

// Close on Escape key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') closePdfFullscreen();
});

// â”€â”€ MULTIMEDIA â”€â”€
function renderMedia() {
  const items = [
    {icon:'ðŸŽµ',title:'Cuencos Tibetanos â€” Fundamentos',cat:'Cuencos',dur:'32 min',bg:'#f5f2ec'},
    {icon:'ðŸŒ¸',title:'CanalizaciÃ³n Marga â€” Puerta Blanca',cat:'CanalizaciÃ³n',dur:'18 min',bg:'#fdf0ee'},
    {icon:'ðŸ§˜',title:'MeditaciÃ³n de Presencia Corporal',cat:'MeditaciÃ³n',dur:'15 min',bg:'#eef3fb'},
    {icon:'ðŸŒ¿',title:'Frecuencia 432Hz â€” ArmonÃ­a Natural',cat:'Frecuencia',dur:'40 min',bg:'#f5f2ec'},
    {icon:'ðŸ”¥',title:'Cuencos â€” Nivel TerapÃ©utico',cat:'Cuencos',dur:'45 min',bg:'#fdf0ee'},
    {icon:'ðŸ’«',title:'UCDM â€” IntroducciÃ³n al PerdÃ³n',cat:'TeorÃ­a',dur:'28 min',bg:'#fdf6ec'},
    {icon:'ðŸ”µ',title:'Dzogchen â€” IntroducciÃ³n a Rigpa',cat:'TeorÃ­a',dur:'35 min',bg:'#eef3fb'},
    {icon:'âœ¨',title:'Frecuencia 963Hz â€” La Luz',cat:'Frecuencia',dur:'48 min',bg:'#eef3fb'},
  ];
  const grid = document.getElementById('media-grid');
  if (!grid) return;
  grid.innerHTML = items.map(function(m){
    return '<div style="background:white;border-radius:14px;overflow:hidden;border:1px solid #e4ddd3;cursor:pointer;transition:transform .2s,box-shadow .2s" onmouseover="this.style.transform=\'translateY(-3px)\';this.style.boxShadow=\'0 8px 24px rgba(0,0,0,.08)\'" onmouseout="this.style.transform=\'\';this.style.boxShadow=\'\'" onclick="toast(\'Reproduciendo: ' + m.title + ' ðŸŽµ\')">' +
      '<div style="background:' + m.bg + ';height:100px;display:flex;align-items:center;justify-content:center;font-size:36px">' + m.icon + '</div>' +
      '<div style="padding:14px 16px"><div style="font-size:10px;font-weight:700;color:#7a7168;text-transform:uppercase;letter-spacing:.08em;margin-bottom:6px">' + m.cat + ' Â· ' + m.dur + '</div>' +
      '<div style="font-size:13px;font-weight:500;color:#1c1814;line-height:1.4">' + m.title + '</div></div></div>';
  }).join('');
}

// â”€â”€ PROGRESO â”€â”€
function renderProgreso() {
  const puertas = [
    {name:'Blanca',icon:'ðŸŒ¿',color:'#b8ad9e',weeks:[1,2,3,4,5,6,7,8,9,10,11,12]},
    {name:'Roja',icon:'ðŸ”¥',color:'#bf4637',weeks:[13,14,15,16,17,18,19,20,21,22,23,24]},
    {name:'Azul',icon:'ðŸ”µ',color:'#2c5f9e',weeks:[25,26,27,28,29,30,31,32,33,34,35,36]},
    {name:'Arcoiris',icon:'ðŸŒˆ',color:'#7b4fa6',weeks:[37,38,39,40,41,42,43,44,45,46,47,48]},
  ];
  document.getElementById('progreso-list').innerHTML = puertas.map(function(p){
    const done = p.weeks.filter(function(w){ return completedWeeks.includes(w); }).length;
    const pct = Math.round((done/12)*100);
    return '<div style="background:white;border-radius:14px;padding:20px;margin-bottom:16px;border:1px solid #e4ddd3">' +
      '<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">' +
      '<div style="display:flex;align-items:center;gap:10px"><span style="font-size:22px">' + p.icon + '</span>' +
      '<div><div style="font-weight:600;font-size:15px">Puerta ' + p.name + '</div>' +
      '<div style="font-size:12px;color:#7a7168">' + done + ' de 12 semanas completadas</div></div></div>' +
      '<div style="font-family:\'Cormorant Garamond\',serif;font-size:32px;font-weight:300">' + pct + '%</div></div>' +
      '<div style="background:#f0ece4;border-radius:100px;height:6px;overflow:hidden">' +
      '<div style="background:' + p.color + ';height:100%;width:' + pct + '%;border-radius:100px;transition:width .5s"></div></div>' +
      '</div>';
  }).join('');
}

// â”€â”€ STRIPE â”€â”€
async function handlePurchase(planId) {
  if (!user) { goTo('auth'); return; }
  toast('Preparando pago...');
  try {
    const { data: { session } } = await sb.auth.getSession();
    const res = await fetch('https://jtwbbyjspanirbsuoipa.supabase.co/functions/v1/create-checkout', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + session.access_token },
      body: JSON.stringify({ plan_id: planId, success_url: location.href + '?paid=ok', cancel_url: location.href })
    });
    const d = await res.json();
    if (d.checkout_url) window.location.href = d.checkout_url;
    else toast('Error: ' + (d.error || 'IntÃ©ntalo de nuevo'));
  } catch(e) {
    toast('Configura Stripe para activar pagos');
  }
}

// Check stripe return
(function(){
  const p = new URLSearchParams(location.search);
  if (p.get('paid') === 'ok') setTimeout(function(){ toast('Pago completado! Acceso activado ðŸŽ‰'); }, 500);
})();

// â”€â”€ UTILS â”€â”€
function toast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  setTimeout(function(){ el.classList.remove('show'); }, 3000);
}

var WD = {};
WD[1]={m:'Esta semana exploramos el estado de "sueÃ±o en movimiento" en el que vive la mayorÃ­a de la gente, un estado de acciÃ³n constante pero sin presencia real. Analizamos cÃ³mo esta forma de vida conduce a la fragmentaciÃ³n del yo, donde la identidad se construye alrededor de roles y funciones, y el "hacer" sustituye al "ser".',c:[['El SueÃ±o en Movimiento','Actuar de forma automÃ¡tica, con la mente saltando de una cosa a otra, perdiendo la experiencia directa.'],['La FragmentaciÃ³n del Yo','La divisiÃ³n interna en mÃºltiples "yoes" (el yo del trabajo, el yo social, etc.) y la creencia de que somos uno de esos roles.'],['El Cuerpo como Espejo','El cuerpo no miente. Tensiones, dolores y fatiga son a menudo reflejos de una desalineaciÃ³n interna y una falta de presencia.'],['El Ego como GuardiÃ¡n','El ego protege una identidad construida y frÃ¡gil. No hay que combatirlo, sino observarlo para que pierda su rigidez.']],et:'Primer Reconocimiento de la Presencia',eo:'Realizar una pausa consciente para reconocer la presencia que ya estÃ¡ aquÃ­, sin fabricarla.',er:'"El Deportista Consciente", Cap. 1.9.',ep:['En algÃºn momento del dÃ­a, detente por unos instantes. No intentes relajarte ni concentrarte.','Simplemente observa: la respiraciÃ³n tal como es, las sensaciones del cuerpo, los pensamientos que aparecen y se van.','Reconoce, sin buscarlo, que hay una  consciencia  que estÃ¡ percibiendo todo eso. No la analices.','Permanece unos segundos sin hacer nada con ello. Un instante de presencia real transforma mÃ¡s que horas de acciÃ³n inconsciente.']};
WD[2]={m:'Exploramos el "instante despuÃ©s" del logro, ese momento de vacÃ­o que revela que el resultado externo no puede sostener el sentido de la vida de forma duradera. Analizamos la espiral de la "bÃºsqueda que no descansa" (logro â†’ alivio â†’ vacÃ­o â†’ nueva bÃºsqueda) y el cansancio del sentido que esto genera.',c:[['El Instante DespuÃ©s','El vacÃ­o que sigue al Ã©xito y que enseÃ±a sobre la naturaleza impermanente de lo condicionado.'],['El Yo que Nunca se Sacia','La identidad construida sobre el "hacer" siempre necesita mÃ¡s para sentirse completa.'],['Del Logro a la Presencia','El giro radical donde el sentido deja de buscarse en el resultado y comienza a encontrarse en la calidad de presencia de la acciÃ³n'],['La Verdadera CompeticiÃ³n','No es contra otros, sino contra nuestros propios automatismos y el olvido de la presencia.']],et:'Habitar la AcciÃ³n sin Buscar Completarte',eo:'Realizar una acciÃ³n importante desde la presencia, sin pedirle que defina tu identidad.',er:'"El Deportista Consciente", Cap. 2.12.',ep:['Antes de una acciÃ³n importante del dÃ­a (una reuniÃ³n, una conversaciÃ³n, una decisiÃ³n), detente unos instantes.','Reconoce el deseo de hacerlo bien y, si aparece, el miedo a fallar.','PregÃºntate en silencio: "Â¿Puedo estar plenamente aquÃ­, aunque el resultado sea incierto?".','Siente el cuerpo. Siente la respiraciÃ³n.','Permite que la acciÃ³n ocurra sin pedirle que te defina. Un solo gesto vivido desde la presencia vale mÃ¡s que mil acciones hechas desde la carencia.']};
WD[3]={m:'Esta semana abordamos la ilusiÃ³n de la separaciÃ³n entre cuerpo, mente y consciencia. Comprendemos que no son partes que deban coordinarse, sino una sola realidad que se manifiesta de diferentes formas. Cuando esta unidad se fragmenta, el rendimiento se resiente y aparece el desgaste.',c:[['La IlusiÃ³n de la SeparaciÃ³n','Vivir fragmentados (pensar una cosa, sentir otra, hacer una tercera) es la fuente de gran parte del malestar cotidiano.'],['El Cuerpo como ExpresiÃ³n de la Totalidad','Cada gesto y postura manifiesta el estado interior completo. Escuchar el cuerpo es habitarlo.'],['La Mente como Herramienta, no como Tirana','El problema no es pensar, sino vivir dominados por el pensamiento, perdiendo la experiencia directa.'],['Consciencia','El Elemento Olvidado:  Es el espacio vivo en el que todo ocurre. Recordarla no aÃ±ade nada, sino que despierta la experiencia.']],et:'Habitar la Unidad en el Movimiento',eo:'Realizar una acciÃ³n sencilla permitiendo que la unidad cuerpo-mente-consciencia se manifieste naturalmente.',er:'"El Ser Consciente", Cap. 3.7.',ep:['Elige una acciÃ³n sencilla del dÃ­a: caminar, escribir, lavar los platos.','Antes de empezar, siente el cuerpo completo, reconoce la respiraciÃ³n y observa la mente sin intervenir.','Realiza la acciÃ³n sin aÃ±adir nada. No busques hacerlo mejor, permite hacerlo presente.','Observa si la calidad del gesto cambia, si el cuerpo se organiza solo, si el esfuerzo disminuye.']};
WD[4]={m:'El ego no es un enemigo, es una estructura necesaria. El conflicto surge de la identificaciÃ³n con Ã©l. Esta semana, aprendemos a observar el ego sin juicio, reconociendo sus patrones y miedos. La presiÃ³n del dÃ­a a dÃ­a es un campo privilegiado para esta observaciÃ³n, ya que hace visible lo que normalmente se oculta.',c:[['IdentificaciÃ³n','El Verdadero Problema:  Creer que somos nuestros pensamientos, emociones o historia personal. Esto vuelve la vida frÃ¡gil y defensi'],['El Ego y el Miedo','El ego vive del miedo (a fallar, a no ser reconocido, a perder el control), que a menudo se disfraza de autoexigencia o necesidad '],['El Ego bajo PresiÃ³n','La presiÃ³n no crea el ego, lo muestra. Por eso es un campo de observaciÃ³n tan valioso.'],['El Ego Observado desde la Presencia','Cuando el ego es observado, pierde rigidez. Entre el impulso y la reacciÃ³n aparece un espacio de libertad.']],et:'Observar el PatrÃ³n sin Nombrarlo',eo:'Observar una reacciÃ³n egoica despuÃ©s de que ocurra, sin juicio ni anÃ¡lisis, para debilitar el automatismo.',er:'"El Ser Consciente", Cap. 4.7.',ep:['DespuÃ©s de una situaciÃ³n que te haya activado (una discusiÃ³n, una crÃ­tica, un conflicto), recuerda el momento.','Observa la reacciÃ³n interna: la direcciÃ³n de la energÃ­a, la necesidad que apareciÃ³ (controlar, defenderte, retirarte).','No le pongas nombre. No intentes corregirlo. No lo justifiques.','Simplemente permite que la memoria de la reacciÃ³n estÃ© ahÃ­, sin convertirla en tu identidad. Lo que se observa sin juicio, pierde poder.']};
WD[5]={m:'Cambiamos la mirada sobre la emociÃ³n, el error y la presiÃ³n. En lugar de verlos como obstÃ¡culos a evitar o controlar, los reconocemos como manifestaciones naturales de la experiencia y como portales hacia una mayor presencia. El sufrimiento no nace de estas experiencias, sino de la forma en que nos relacionamos con ellas.',c:[['La EmociÃ³n como EnergÃ­a en Movimiento','El problema no es sentir, sino identificarse. Cuando una emociÃ³n es reconocida sin interferencia, se completa y se disuelve.'],['El Error como Colapso de la IlusiÃ³n de Control','El error interrumpe la narrativa del control y abre una puerta a la presencia desnuda, si no se vive desde la culpa o la defensa.'],['No-Rechazo y AutoliberaciÃ³n','Rechazar la experiencia la fija. Reconocerla sin lucha permite que se libere por sÃ­ misma.']],et:'Reconocer y Auto-liberar la EmociÃ³n',eo:'Permitir que una emociÃ³n intensa se mueva y se disuelva sin interferencia mental.',er:'"El Ser Consciente", Cap. 5.7.',ep:['La prÃ³xima vez que aparezca una emociÃ³n intensa, detente un instante.','No la nombres ni la expliques. Simplemente siente su energÃ­a en el cuerpo. Observa dÃ³nde se manifiesta.','Reconoce el espacio de consciencia en el que esa emociÃ³n estÃ¡ apareciendo.','No hagas nada con ella. Permite que se mueva, cambie o se disuelva por sÃ­ sola.']};
WD[6]={m:'La vida cotidiana, con su repeticiÃ³n, es el espejo mÃ¡s preciso de nuestra forma de estar en el mundo. El entrenamiento diario, ya sea fÃ­sico, profesional o personal, se convierte en una prÃ¡ctica consciente. La disciplina deja de ser rigidez y se transforma en un compromiso con la presencia.',c:[['La RepeticiÃ³n como Espejo','Lo que hacemos cada dÃ­a revela nuestros automatismos, resistencias y zonas de ausencia.'],['Entrenar sin Estar Presente','El "hacer mecÃ¡nico" produce resultados, pero tambiÃ©n desgaste y desconexiÃ³n.'],['La Disciplina Consciente','No es una imposiciÃ³n externa, sino una alineaciÃ³n interna. No te obligas, te recuerdas.'],['El Cansancio como SeÃ±al','A menudo no indica falta de descanso, sino desconexiÃ³n prolongada.']],et:'Entrenar como si Fuera la Primera Vez',eo:'Romper el automatismo en una actividad habitual a travÃ©s de la atenciÃ³n plena.',er:'"El Deportista Consciente", Cap. 7.7.',ep:['Elige una actividad habitual que suelas hacer en automÃ¡tico (conducir, ducharte, una tarea repetitiva del trabajo).','Durante un dÃ­a, decide hacerla con una atenciÃ³n deliberada.','RealÃ­zala un poco mÃ¡s despacio. Observa cada gesto, cada sensaciÃ³n.','Permanece curioso, como si fuera la primera vez que lo haces. No busques cambiarla, solo obsÃ©rvala. La frescura no estÃ¡ en lo nuevo, sino en la atenciÃ³n.']};
WD[7]={m:'Nadie vive ni despierta aislado. La consciencia es relacional. Nuestras relaciones (familia, equipo, trabajo) son el camino, no un obstÃ¡culo. Cada persona influye en el "campo invisible" del grupo con su estado interno. La presencia no es solo un acto interior, es un acto relacional.',c:[['El Mito del Individuo Aislado','La vida siempre ocurre en relaciÃ³n. Pensamientos y emociones se contagian y amplifican en el campo colectivo.'],['El Ego Colectivo','Grupos, familias e ideologÃ­as construyen identidades compartidas ("nosotros" vs. "ellos") que ofrecen seguridad pero tambiÃ©n rigid'],['La ComunicaciÃ³n como PrÃ¡ctica de Consciencia','Escuchar sin preparar respuesta, permitir silencios, hablar desde lo verdadero. La comunicaciÃ³n consciente busca contacto, no conv']],et:'Habitar el Campo Colectivo con Presencia',eo:'Observar tu influencia en el campo relacional y practicar la presencia no impositiva.',er:'"El Ser Consciente", Cap. 8.11.',ep:['En tu prÃ³xima interacciÃ³n grupal (una reuniÃ³n de trabajo, una cena familiar), toma un momento para observar el "clima" del encuentro.','Reconoce tu propio estado interno (Â¿tensiÃ³n, apertura, defensa?).','Nota cÃ³mo tu estado influye en el ambiente y cÃ³mo el ambiente influye en ti.','No intentes cambiar a nadie ni dirigir la situaciÃ³n. Simplemente, elige estar presente. Escucha mÃ¡s. Habla menos. La presencia es contagiosa cuando no intenta imponerse.']};
WD[8]={m:'El ser humano es un campo vibracional. El sonido actÃºa directamente sobre este campo, ordenando desde la vibraciÃ³n lo que la mente no puede corregir. Los cuencos tibetanos son herramientas de armonizaciÃ³n profunda que facilitan la descarga de tensiones y el reordenamiento natural del sistema.',c:[['El Sonido como VÃ­a Directa a la Presencia','El sonido rompe la continuidad del diÃ¡logo interno y devuelve la atenciÃ³n al presente sin necesidad de interpretaciÃ³n.'],['VibraciÃ³n y Coherencia','El sonido influye en la respiraciÃ³n, el tono corporal y la regulaciÃ³n emocional, restableciendo la coherencia del sistema nervioso'],['El Sonido como PrÃ¡ctica de No-Hacer','Escuchar profundamente es una forma de no-hacer. La mente deja de intervenir y la consciencia se amplÃ­a.']],et:'Equilibrar la EnergÃ­a con Cuencos',eo:'Utilizar el sonido de un cuenco para armonizar el campo energÃ©tico.',er:'"TCT Puerta Blanca-Roja", pÃ¡g. 51.',ep:['SiÃ©ntate o tÃºmbate en una posiciÃ³n cÃ³moda.','Toma un cuenco tibetano. Si no tienes, puedes usar una grabaciÃ³n de alta calidad.','Percute o fricciona el cuenco suavemente. Cierra los ojos.','En lugar de "escuchar" con los oÃ­dos, siente la vibraciÃ³n en tu cuerpo. Imagina que el sonido lava y limpia tu campo energÃ©tico.','Sigue el sonido hasta que se desvanezca por completo en el silencio. Permanece en ese silencio unos instantes.']};
WD[9]={m:'A veces, la herida no es personal, sino sistÃ©mica. Exploramos la "herida invisible" que se genera cuando un sistema (laboral, familiar, social) promete algo que no sostiene, creando una incoherencia que afecta a la identidad y la confianza del individuo.',c:[['La Promesa como Acto de Poder','Las promesas organizan la conducta, pero cuando no se sostienen en la realidad, generan pÃ©rdida de confianza.'],['La Herida Invisible','SensaciÃ³n persistente de no ser suficiente, miedo a fallar, desconfianza. La persona internaliza como culpa lo que es un fallo est'],['Transformar la Herida sin Negarla','Sanar no es borrar, es integrar. La herida reconocida puede volverse sensibilidad y comprensiÃ³n.']],et:'Distinguir el Hecho de la Herida',eo:'Separar un evento objetivo de la interpretaciÃ³n identitaria y la herida emocional que generÃ³.',er:'"El Deportista Consciente", Cap. 10.11.',ep:['Piensa en una situaciÃ³n en la que te sentiste decepcionado o traicionado por un sistema o una persona.','Escribe, de la forma mÃ¡s objetiva y concreta posible, el  hecho: quÃ© se dijo, quÃ© ocurriÃ³. (Sin adjetivos, sin juicios, sin "porquÃ©s").','A continuaciÃ³n, escribe quÃ© apareciÃ³ en ti a partir de ese hecho: las  emociones  (rabia, tristeza), los  pensamientos  ("no soy vÃ¡lido", "no se puede confiar en nadie"), las  reacciones corporales.','Observa la diferencia entre el hecho externo y tu reacciÃ³n interna. Reconoce que la herida no es el hecho en sÃ­, sino la historia que te cuentas sobre Ã©l. Esto crea un espacio para no identificarte con la herida.']};
WD[10]={m:'El lÃ­mite (agotamiento, enfermedad, bloqueo) no es un fracaso, es una seÃ±al y una puerta. Interrumpe la inercia y obliga a detenerse. La pausa impuesta, si se acepta conscientemente, se transforma en una prÃ¡ctica de escucha profunda que reordena todo el sistema.',c:[['El LÃ­mite como InterrupciÃ³n del Automatismo','Detiene lo que no podÃ­a detenerse voluntariamente.'],['Cuando el Cuerpo Toma la Palabra','La lesiÃ³n o enfermedad no es castigo, es comunicaciÃ³n. Expresa lo que la mente no ha querido escuchar.'],['La Pausa como PrÃ¡ctica Consciente','La pausa no es tiempo perdido, es espacio para sentir, escuchar y reorganizar.'],['Volver sin Regresar al Mismo Lugar','Tras un lÃ­mite, no se vuelve al punto anterior. Se vuelve distinto. El lÃ­mite transforma.']],et:'Escuchar el LÃ­mite sin Intentar Corregirlo',eo:'Practicar la aceptaciÃ³n y la escucha frente a una limitaciÃ³n fÃ­sica o mental.',er:'"El Ser Consciente", Cap. 11.8.',ep:['Busca un momento de quietud. Lleva la atenciÃ³n al cuerpo o a la zona donde sientas el lÃ­mite (un dolor, cansancio, bloqueo mental).','No intentes cambiar nada. No lo analices. No luches contra la sensaciÃ³n.','En lugar de eso, "escÃºchala". Pregunta internamente: "Â¿QuÃ© estÃ¡ pidiendo ser escuchado aquÃ­?".','Permanece con la sensaciÃ³n, ofreciÃ©ndole un espacio de presencia sin juicio. Escuchar es ya una forma de cuidado.']};
WD[11]={m:'El camino autÃ©ntico conduce mÃ¡s allÃ¡ del resultado. El resultado es una experiencia, no una identidad. El sentido no se construye, se reconoce en la coherencia, en la presencia y en la simplicidad de estar. El "fracaso" se integra como parte del camino y el "Ã©xito" se vive sin apego.',c:[['El Resultado como Experiencia, no Identidad','Cuando el resultado define quiÃ©nes somos, la vida se vuelve frÃ¡gil. Cuando se vive como experiencia, informa, enseÃ±a y pasa.'],['El Sentido se Reconoce, no se Construye','Aparece cuando dejamos de huir de lo que estÃ¡ ocurriendo y vivimos desde la presencia.'],['El Legado Invisible','A menudo, el legado mÃ¡s duradero no son los logros, sino la forma en que escuchamos, atravesamos la dificultad y ofrecimos presenc']],et:'Recordar sin Buscar',eo:'Experimentar la simplicidad de la presencia sin intenciÃ³n de lograr o mejorar nada.',er:'"El Ser Consciente", Cap. 12.7.',ep:['No hagas nada especial. SiÃ©ntate o permanece de pie unos instantes.','Siente el cuerpo. La respiraciÃ³n. El espacio que te rodea.','No busques un estado de presencia. No intentes comprender nada.','Simplemente permite que lo que ya estÃ¡ aquÃ­ se reconozca solo.','Reconoce que ya estÃ¡s aquÃ­. Eso es suficiente.']};
WD[12]={m:'Esta semana la dedicamos a integrar los aprendizajes de la Puerta Blanca. Repasamos los conceptos clave: la diferencia entre acciÃ³n mecÃ¡nica y acciÃ³n consciente, la observaciÃ³n del ego sin identificaciÃ³n, y el habitar el cuerpo como ancla de la presencia. El objetivo es consolidar la prÃ¡ctica de la "pausa consciente" como herramienta fundamental para la vida diaria. ReflexiÃ³n Final de la Puerta Bl',c:[],et:'de IntegraciÃ³n: El DÃ­a Consciente',eo:'Aplicar las herramientas de la Puerta Blanca de forma integrada a lo largo de un dÃ­a.',er:'',ep:['Al Despertar:  Antes de levantarte, dedica un minuto a "habitar tu cuerpo". Siente el contacto con la cama, la respiraciÃ³n, la energÃ­a presente.','Durante una Tarea Rutinaria:  Elige una tarea (ej. lavarte los dientes) y realÃ­zala con plena atenciÃ³n, como si fuera la primera vez (Ejercicio Semana 6).','En una InteracciÃ³n Social:  Practica la escucha sin preparar respuesta (Ejercicio Semana 7). Observa tu campo emocional y el del grupo.','Cuando Surja una EmociÃ³n Fuerte:  Haz una pausa y reconoce la emociÃ³n en el cuerpo sin juzgarla (Ejercicio Semana 5).','Antes de Dormir:  Dedica un minuto a "recordar sin buscar" (Ejercicio Semana 11). Simplemente, reconoce que estÃ¡s aquÃ­, concluyendo el dÃ­a. Anota en un diario cualquier descubrimiento o dificultad. La clave no es la perfecciÃ³n, sino la intenciÃ³n de recordar. Puerta Roja: PurificaciÃ³n (Semanas 13-24)']};
WD[13]={m:'La Puerta Roja se asocia con la "voz-energÃ­a", el centro energÃ©tico de la garganta (chakra Vishuddha), simbolizado por la sÃ­laba "A" y el color rojo. Comprendemos que todo es vibraciÃ³n, sonido y frecuencia. Los bloqueos energÃ©ticos, originados en el transgeneracional, el proyecto sentido o nuestra vida cronolÃ³gica, se manifiestan como desequilibrios en nuestro campo energÃ©tico antes de afectar al ',c:[['La Puerta de la Voz-EnergÃ­a','El centro de la garganta como portal para la expresiÃ³n y transformaciÃ³n de la energÃ­a.'],['VibraciÃ³n, Sonido y Frecuencia','Entender que somos seres vibracionales y que el sonido es una herramienta poderosa para la armonizaciÃ³n.'],['El Origen de los Bloqueos','IntroducciÃ³n a los conceptos de transgeneracional, proyecto sentido y bioshock como fuentes de desequilibrios energÃ©ticos.'],['Un Sonido Relajado, una Mente Libre','La conexiÃ³n directa entre nuestro estado vibracional interno y nuestra paz mental.']],et:'Sentir la VibraciÃ³n de la Voz',eo:'Conectar con el centro energÃ©tico de la garganta a travÃ©s de la propia voz.',er:'',ep:['SiÃ©ntate cÃ³modamente con la espalda recta. Cierra los ojos y realiza tres respiraciones profundas.','Coloca suavemente las yemas de los dedos en tu garganta.','Toma una inhalaciÃ³n profunda y, al exhalar, emite un sonido "Aaaaaaah" largo y sostenido, en un tono que te resulte cÃ³modo y natural.','ConcÃ©ntrate en la vibraciÃ³n que sientes bajo tus dedos. Siente cÃ³mo el sonido se origina y se expande desde ese centro.','Repite varias veces, explorando diferentes tonos y volÃºmenes. Observa cÃ³mo cambia la sensaciÃ³n.','Finaliza permaneciendo en silencio, sintiendo la resonancia que queda en tu cuerpo.']};
WD[14]={m:'Los mantras son "tecnologÃ­as de la mente" diseÃ±adas para liberar la mente del pensamiento discursivo a travÃ©s de la vibraciÃ³n. Estudiamos la diferencia entre mantra y afirmaciÃ³n, y exploramos mantras de diversas tradiciones (budista, chamÃ¡nica, cabalÃ­stica) como herramientas para elevar nuestra frecuencia vibratoria y enfocar la intenciÃ³n.',c:[['Mantra','Del sÃ¡nscrito "man" (mente) y "tra" (liberar). Sonidos que crean altas vibraciones para enfocar la mente y catalizar cambios.'],['Sonido Primordial (OM/A)','El sonido del cual emergen todas las demÃ¡s vibraciones. La sÃ­laba "A" es fundamental en la Puerta Roja.'],['Mantras y Deidades','Muchos mantras son invocaciones que nos conectan con arquetipos o cualidades energÃ©ticas especÃ­ficas (compasiÃ³n, sanaciÃ³n, prosper'],['TransmisiÃ³n EnergÃ©tica','En algunas tradiciones, la plena activaciÃ³n de un mantra requiere una transmisiÃ³n de un maestro que ya lo ha realizado.']],et:'MeditaciÃ³n con el Mantra "Om Mani Padme Hum"',eo:'Cultivar la compasiÃ³n y purificar la mente a travÃ©s del mantra de Avalokiteshvara.',er:'"TCT Puerta Blanca-Roja", pÃ¡g. 111.',ep:['SiÃ©ntate en una postura de meditaciÃ³n cÃ³moda.','Comienza con unas respiraciones conscientes para calmar la mente.','Empieza a recitar el mantra "Om Mani Padme Hum", ya sea en voz alta o mentalmente.','Mientras lo recitas, puedes visualizar una luz blanca y pura que emana de tu corazÃ³n y se expande, llenando todo tu ser y extendiÃ©ndose a todos los seres sintientes, deseÃ¡ndoles paz y liberaciÃ³n del sufrimiento.','No te preocupes por la pronunciaciÃ³n perfecta. La intenciÃ³n y la repeticiÃ³n son lo mÃ¡s importante.']};
WD[15]={m:'Desde la cosmologÃ­a budista, exploramos los 6 Reinos o "Lokas" como representaciones de estados mentales dominados por una emociÃ³n especÃ­fica (orgullo, celos, deseo, ignorancia, apego, ira). Comprendemos que, aunque vivimos en el reino humano, transitamos por estos estados constantemente. La purificaciÃ³n consiste en reconocer estas emociones en nosotros y, a travÃ©s de la prÃ¡ctica, disminuir su pod',c:[['Samsara','El ciclo de existencia condicionada, caracterizado por el sufrimiento y la impermanencia.'],['Los 6 Reinos','Dioses (Orgullo), Semi-dioses (Celos), Humanos (Deseo), Animales (Ignorancia), Pretas/EspÃ­ritus hambrientos (Apego), Infiernos (Ir'],['La Preciada Vida Humana','El reino humano es el Ãºnico desde el cual es posible alcanzar la iluminaciÃ³n, ya que equilibra el placer y el sufrimiento, permiti'],['PurificaciÃ³n de los Lokas','El objetivo no es eliminar los reinos, sino dejar de ser arrastrados por las emociones que los gobiernan.']],et:'MeditaciÃ³n de los 6 Reinos con Soporte',eo:'Observar y comenzar a purificar la influencia de una de las emociones de los 6 reinos.',er:'"TCT Puerta Blanca-Roja", pÃ¡g. 77-79.',ep:['Elige uno de los 6 reinos para trabajar durante esta sesiÃ³n (ej. Reino de los Pretas - Apego).','SiÃ©ntate frente a una vela. Percute un cuenco tibetano tres veces y realiza tres respiraciones profundas.','Paso B (5 min):  Con los ojos abiertos, enfoca tu atenciÃ³n en la llama de la vela. Deja que tu mente se calme.','Paso C (5 min):  Cierra los ojos. Dirige tu mirada interna hacia la localizaciÃ³n corporal del reino elegido (Pretas: zona del abdomen/plexo solar). Respira hacia esa zona y simplemente observa la emociÃ³n del apego en tu vida. Â¿A quÃ© te aferras? Â¿QuÃ© miedos surgen al pensar en soltar? Observa sin jui','Paso D (5 min):  Abre los ojos y vuelve a enfocar la atenciÃ³n en la vela, pero ahora manteniendo la consciencia de lo que has observado en el paso C. Observa quÃ© cambia en tu percepciÃ³n.']};
WD[16]={m:'Profundizamos en las herramientas prÃ¡cticas del Cuarto Camino. El ser humano es una "mÃ¡quina" que funciona con patrones automÃ¡ticos. El trabajo consiste en despertar de este automatismo a travÃ©s de la "auto-observaciÃ³n sin juicio" y el "recuerdo de sÃ­".',c:[['La MÃ¡quina Humana','Nuestros pensamientos, emociones y acciones son mayormente reacciones mecÃ¡nicas a estÃ­mulos internos y externos.'],['Auto-observaciÃ³n sin Juicio','La prÃ¡ctica de observar nuestros patrones (posturas, gestos, tonos de voz, pensamientos recurrentes) sin intentar cambiarlos, just'],['Recuerdo de SÃ­','El acto de ser consciente de uno mismo ("Yo soy") y de lo que se estÃ¡ haciendo al mismo tiempo. Es una atenciÃ³n dividida que rompe'],['Choques Conscientes','Interrupciones deliberadas del automatismo para crear una "chispa" de consciencia (ej. cambiar de mano para hacer una tarea, hacer']],et:'Pausas de Consciencia',eo:'Introducir "choques conscientes" en la rutina diaria para romper el automatismo.',er:'Anexo VI de "TCT Puerta Azul", Semana 1.',ep:['Programa una alarma en tu telÃ©fono para que suene 3 veces a lo largo del dÃ­a en momentos inesperados.','Cuando suene la alarma, detÃ©n lo que estÃ¡s haciendo por 30 segundos.','PregÃºntate: "Â¿DÃ³nde estoy? Â¿QuÃ© estoy haciendo? Â¿CuÃ¡l es mi estado interno (pensamiento, emociÃ³n, sensaciÃ³n corporal)?".','Observa sin juzgar. No necesitas cambiar nada.','DespuÃ©s de los 30 segundos, continÃºa con tu actividad. El objetivo es simplemente crear una breve interrupciÃ³n en el "sueÃ±o despierto".']};
WD[17]={m:'Gurdjieff describe al ser humano como un carruaje con tres centros principales: Intelectual (la mente pensante), Emocional (sentimientos y reacciones afectivas) y Motor-Instintivo (cuerpo y funciones automÃ¡ticas). Normalmente, estos centros trabajan de forma desequilibrada. El trabajo consiste en observarlos y armonizarlos.',c:[['Centro Intelectual','Su trabajo correcto es pensar, analizar y planificar. Su trabajo incorrecto es el parloteo mental incesante, la preocupaciÃ³n y la '],['Centro Emocional','Su trabajo correcto es sentir emociones superiores (compasiÃ³n, alegrÃ­a). Su trabajo incorrecto es la reactividad de las emociones '],['ArmonizaciÃ³n de los Centros','La prÃ¡ctica de observar quÃ© centro estÃ¡ activo en cada momento y evitar que un centro haga el trabajo de otro (ej. "pensar" una em']],et:'TransformaciÃ³n Emocional',eo:'Observar una emociÃ³n negativa sin identificarse y negarse a expresarla mecÃ¡nicamente.',er:'Anexo VI de "TCT Puerta Azul", Semana 6.',ep:['La prÃ³xima vez que sientas una emociÃ³n negativa (irritaciÃ³n, impaciencia, tristeza), haz una pausa.','Reconoce  la emociÃ³n internamente: "Estoy sintiendo irritaciÃ³n".','No te identifiques:  Recuerda que "tÃº" no eres la irritaciÃ³n; eres la consciencia que la observa.','No la expreses mecÃ¡nicamente:  Toma la decisiÃ³n consciente de no actuar desde esa emociÃ³n (no levantar la voz, no hacer un gesto brusco).','Observa la energÃ­a:  Siente la energÃ­a de la emociÃ³n en tu cuerpo sin hacer nada con ella. Observa cÃ³mo, al no ser alimentada por la reacciÃ³n, pierde fuerza y se transforma.']};
WD[18]={m:'Iniciamos la integraciÃ³n de Un Curso de Milagros. La felicidad, segÃºn UCDM, no se encuentra en el mundo, que es una proyecciÃ³n de nuestro pensamiento de separaciÃ³n. La verdadera felicidad es nuestro estado natural en Dios, y se recupera deshaciendo la culpa a travÃ©s del perdÃ³n. El perdÃ³n no es condonar un acto, sino reconocer que lo que creÃ­amos que nos hicieron nunca ocurriÃ³ realmente en el nivel',c:[['La Paradoja de la Felicidad segÃºn UCDM','Buscamos la felicidad donde no se puede encontrar (en el mundo de la percepciÃ³n). La verdadera felicidad es un recuerdo de nuestra'],['El PerdÃ³n como Clave de la Felicidad','El perdÃ³n es la herramienta para liberar la mente de la culpa y el resentimiento, que son los Ãºnicos obstÃ¡culos para la paz.'],['Nivel 1','El Testigo Santo:  Invitar al EspÃ­ritu Santo a observar nuestros pensamientos de juicio y ataque sin condenarlos.'],['Nivel 2','El PerdÃ³n como Camino Directo:  Aplicar la fÃ³rmula del perdÃ³n a cualquier situaciÃ³n que nos perturbe la paz.']],et:'El Diario del PerdÃ³n',eo:'Aplicar el proceso de perdÃ³n de UCDM a una situaciÃ³n especÃ­fica.',er:'Anexo V de "TCT Puerta Azul".',ep:['Elige una persona o situaciÃ³n que te cause resentimiento o malestar.','Escribe en un diario: "Me siento [emociÃ³n] por [situaciÃ³n/persona] porque creo que [juicio/ataque]".','Reconoce que estos pensamientos son del ego y te estÃ¡n robando la paz.','Di (mental o en voz alta): "EspÃ­ritu Santo, veo esto de otra manera. Elijo la paz en lugar de este conflicto. Te entrego estos pensamientos de juicio para que sean corregidos".','Visualiza a la persona (y a ti mismo) envuelta en una luz sanadora, reconociendo la inocencia que ambos compartÃ­s como Hijos de Dios.']};
WD[19]={m:'UCDM enseÃ±a que todo dolor emocional proviene de un pensamiento de ataque o separaciÃ³n. La gestiÃ³n emocional no consiste en analizar la emociÃ³n, sino en llevar el pensamiento que la causÃ³ a la correcciÃ³n del EspÃ­ritu Santo. El "Instante Santo" es la prÃ¡ctica de retirar nuestra atenciÃ³n del pasado y el futuro para abrir un momento presente al Amor de Dios.',c:[['El Proceso UCDM para Emociones','Cuando surge el dolor, reconocer que es una seÃ±al de que hemos elegido al ego como maestro. El Ãºnico remedio es cambiar de maestro'],['MeditaciÃ³n "El Instante Santo"','Una prÃ¡ctica para aquietar la mente y unirse al EspÃ­ritu Santo en el ahora, donde no hay problemas.'],['ElecciÃ³n sobre Circunstancia','La clave de la felicidad constante es recordar que siempre podemos elegir la paz, sin importar las circunstancias externas.'],['Amor sobre Miedo','Cada momento es una elecciÃ³n entre dos sistemas de pensamiento: el del ego (miedo) o el del EspÃ­ritu Santo (amor).']],et:'MeditaciÃ³n "El Instante Santo"',eo:'Experimentar un momento de paz y conexiÃ³n mÃ¡s allÃ¡ del tiempo.',er:'Anexo V de "TCT Puerta Azul".',ep:['Busca un lugar tranquilo donde no te interrumpan por 5-10 minutos.','Cierra los ojos y di: "Tengo la voluntad de dejar a un lado todos mis problemas, planes y juicios por un momento. Deseo experimentar este Instante Santo contigo, EspÃ­ritu Santo".','No intentes vaciar tu mente. Simplemente, retira tu interÃ©s de los pensamientos que surjan. DÃ©jalos pasar sin engancharte.','Enfoca tu atenciÃ³n en la sensaciÃ³n de paz o quietud que pueda surgir, por sutil que sea.','Descansa en este espacio, sabiendo que en este instante no te falta nada y estÃ¡s perfectamente a salvo en el Amor de Dios.']};
WD[20]={m:'Volvemos a los protocolos de sonido, esta vez con una comprensiÃ³n mÃ¡s profunda de la energÃ­a emocional. El protocolo "Purificar la Rueda del Samsara" utiliza los cuencos tibetanos para trabajar directamente sobre los centros energÃ©ticos asociados a los 6 Reinos, ayudando a liberar las emociones negativas estancadas.',c:[['Masaje Vibracional','El uso de cuencos directamente sobre el cuerpo o en su campo energÃ©tico para inducir una relajaciÃ³n profunda y un reequilibrio vib'],['Fase 1 (PercusiÃ³n)','Utiliza golpes continuos para "despertar" y "romper" los bloqueos energÃ©ticos en cada centro.'],['Fase 2 (FricciÃ³n)','Utiliza un sonido sostenido para "limpiar" y "armonizar" la energÃ­a liberada.'],['IntenciÃ³n Consciente','El terapeuta y el receptor mantienen una intenciÃ³n clara de purificaciÃ³n durante toda la sesiÃ³n.']],et:'Autotratamiento con un Cuenco',eo:'Utilizar un cuenco para limpiar el propio campo energÃ©tico.',er:'Adaptado del protocolo "Rueda del Samsara".',ep:['SiÃ©ntate cÃ³modamente. Coloca un cuenco tibetano en la palma de tu mano izquierda.','Comienza a friccionar el cuenco con la baqueta en tu mano derecha, generando un sonido continuo.','Lentamente, mueve el cuenco alrededor de tu cuerpo, a unos 10-15 cm de distancia. Comienza por la cabeza y desciende lentamente hacia los pies.','Presta especial atenciÃ³n a las zonas donde sientas tensiÃ³n o pesadez. Permanece en esas Ã¡reas un poco mÃ¡s, permitiendo que la vibraciÃ³n disuelva el bloqueo.','Visualiza que cualquier energÃ­a densa se desprende de tu cuerpo y es absorbida por la tierra.','Termina colocando el cuenco sobre tu corazÃ³n y percutiÃ©ndolo suavemente tres veces.']};
WD[21]={m:'Integramos la sabidurÃ­a de la CÃ¡bala con el sonido. El "Pilar del Medio" es el eje energÃ©tico central del Ãrbol de la Vida, que corresponde a nuestra columna vertebral y a los chakras principales. Este protocolo utiliza cuencos afinados con notas especÃ­ficas para activar y equilibrar cada uno de los centros (Sefirot) de este pilar, promoviendo la alineaciÃ³n entre el cielo y la tierra dentro de nos',c:[['El Pilar del Medio','El eje central de energÃ­a que conecta la consciencia cÃ³smica (Keter) con la manifestaciÃ³n terrenal (Malkuth).'],['Sefirot','Emanaciones o atributos divinos en el Ãrbol de la Vida, que tambiÃ©n son centros de consciencia en el ser humano.'],['Correspondencia Nota-Centro','Cada Sefira del Pilar del Medio resuena con una nota musical especÃ­fica, que se utiliza para activarla.'],['Nombres de Poder','La recitaciÃ³n de los nombres divinos asociados a cada Sefira potencia el efecto de la vibraciÃ³n sonora.']],et:'MeditaciÃ³n del Pilar del Medio',eo:'Activar y equilibrar el eje energÃ©tico central a travÃ©s de la visualizaciÃ³n y el sonido (mantra).',er:'"TCT Puerta Blanca-Roja", pÃ¡g. 135-137.',ep:['Ponte de pie, con los pies separados a la anchura de los hombros. Cierra los ojos.','Visualiza una esfera de luz blanca brillante por encima de tu cabeza (Keter). Vibra el nombre  "E-HE-IEH"  (pronunciado "EjeiÃ©"). Siente cÃ³mo la luz desciende a tu cabeza.','Visualiza la luz descendiendo hasta tu garganta (Daat). Vibra el nombre  "YEHOVA-ELOHIM".','Visualiza la luz descendiendo a tu corazÃ³n (Tiferet). Vibra el nombre  "YEHOVA-ELOAH-VA-DAATH". Siente cÃ³mo la luz se expande desde tu corazÃ³n.','Visualiza la luz descendiendo a tu zona genital/base de la columna (Yesod). Vibra el nombre  "SHADDAI-EL-CHAI".']};
WD[22]={m:'La Cruz CabalÃ­stica es un ritual que establece un espacio sagrado y equilibra el microcosmos (el ser humano) con el macrocosmos (el universo). A travÃ©s de la visualizaciÃ³n de la luz y la vibraciÃ³n de nombres de poder, se traza una cruz de luz en el campo energÃ©tico, anclando las energÃ­as divinas y creando un centro de poder y equilibrio.',c:[['ATAH (A Ti)','Se traza la luz desde arriba hasta el pecho, reconociendo la Fuente Divina.'],['MALKUTH (El Reino)','Se baja la luz hasta los pies, anclando la divinidad en la tierra.'],['VE-GEVURAH (Y el Poder)','Se traza la luz hasta el hombro derecho, invocando la fuerza y el rigor.'],['VE-GEDULAH (Y la Gloria)','Se traza la luz hasta el hombro izquierdo, invocando la misericordia y la expansiÃ³n.']],et:'Realizar la Cruz CabalÃ­stica',eo:'Centrar y proteger el campo energÃ©tico.',er:'"TCT Puerta Blanca-Roja", pÃ¡g. 138-140.',ep:['Ponte de pie mirando al Este. Realiza varias respiraciones profundas.','Visualiza una luz brillante sobre tu cabeza. Con tu dedo Ã­ndice derecho, toca tu frente y vibra  "ATAH".','Baja la mano hasta tu pecho, visualizando el rayo de luz descendiendo. Vibra  "MALKUTH".','Toca tu hombro derecho, visualizando un rayo de luz desde el centro del pecho. Vibra  "VE-GEVURAH".','Toca tu hombro izquierdo, visualizando el rayo de luz cruzando tu pecho. Vibra  "VE-GEDULAH".']};
WD[23]={m:'Sintetizamos los aprendizajes de las Puertas Blanca y Roja en la "FÃ³rmula Esencial de la Felicidad". La felicidad no es una meta, sino la resonancia de un ser en equilibrio. Esta semana nos enfocamos en los dos primeros componentes: AceptaciÃ³n (el fruto de la Puerta Blanca) y PropÃ³sito (el fruto de la Puerta Roja).',c:[['AceptaciÃ³n','Es la cimentaciÃ³n fÃ­sica y la presencia en el ahora. Es la paz que surge de aceptar lo que es, sin resistencia. Es el resultado de'],['PropÃ³sito','Es la purificaciÃ³n de la energÃ­a y la acciÃ³n consciente. Surge cuando nuestra energÃ­a emocional ya no estÃ¡ atrapada en el pasado (']],et:'Clarificando el PropÃ³sito',eo:'Conectar con un sentido de propÃ³sito que vaya mÃ¡s allÃ¡ de las metas del ego.',er:'',ep:['Dedica 15 minutos a una escritura reflexiva.','PregÃºntate: "Si el miedo y la necesidad de aprobaciÃ³n no fueran un factor, Â¿a quÃ© dedicarÃ­a mi energÃ­a?".','Escribe sobre las actividades que te hacen sentir vivo, conectado y expansivo.','Reflexiona: "Â¿CÃ³mo puedo traer mÃ¡s de esta energÃ­a a mi vida diaria, incluso en pequeÃ±os actos?".','El propÃ³sito no tiene que ser una gran misiÃ³n. Puede ser tan simple como "ser un espacio de paz para los demÃ¡s" o "crear belleza en mi entorno".']};
WD[24]={m:'Esta semana consolidamos las prÃ¡cticas de purificaciÃ³n emocional. Repasamos la transformaciÃ³n de las emociones a travÃ©s de la observaciÃ³n (Cuarto Camino), el perdÃ³n (UCDM) y la vibraciÃ³n (Sonido). El objetivo es desarrollar una maestrÃ­a emocional que no se basa en el control, sino en la capacidad de permitir que la energÃ­a fluya sin que nos secuestre. ReflexiÃ³n Final de la Puerta Roja: La purifica',c:[],et:'de IntegraciÃ³n: El Alquimista Emocional',eo:'Utilizar una herramienta diferente para cada tipo de perturbaciÃ³n emocional.',er:'',ep:['Para la IrritaciÃ³n o la Ira (Cuarto Camino):  La prÃ³xima vez que te sientas irritado, practica la "no-expresiÃ³n mecÃ¡nica". Reconoce la energÃ­a, pero elige no actuarla. ObsÃ©rvala hasta que se transforme.','Para el Resentimiento o la Culpa (UCDM):  Si un pensamiento sobre el pasado te perturba, realiza el "Diario del PerdÃ³n". Entrega el juicio al EspÃ­ritu Santo y elige la paz.','Para la Ansiedad o el EstrÃ©s General (Sonido):  Cuando te sientas abrumado, dedica 5 minutos a escuchar un cuenco tibetano o a cantar un mantra (como "OM"). Permite que la vibraciÃ³n re-sintonice tu sistema nervioso. La prÃ¡ctica consiste en reconocer quÃ© herramienta es mÃ¡s adecuada para cada momento,']};
WD[25]={m:'La Puerta Azul corresponde al centro del corazÃ³n, simbolizado por la sÃ­laba "HUM" y el color azul. AquÃ­, "mente" no se refiere a la mente ordinaria (pensamientos, intelecto), sino a la naturaleza real de la mente: un estado que nunca fue creado, que estÃ¡ mÃ¡s allÃ¡ de todas las creencias y filosofÃ­as. El objetivo es aprender a "estar relajado y reposar en nuestra condiciÃ³n natural".',c:[['La Puerta de la Mente (CorazÃ³n)','El centro del corazÃ³n como sede de la mente no-dual o Rigpa.'],['VisiÃ³n Dualista vs. VisiÃ³n Total 360Â°','Pasar de una percepciÃ³n unidireccional (sujeto-objeto) a una visiÃ³n panorÃ¡mica y no-dual donde todo estÃ¡ interconectado.'],['Ma-rigpa vs. Rigpa','Ma-rigpa es la ignorancia o el no-reconocimiento de nuestra verdadera condiciÃ³n. Rigpa es el conocimiento directo, la sabidurÃ­a pr'],['VisiÃ³n Circular','Todos los conceptos y prÃ¡cticas de las tres puertas estÃ¡n interconectados. La Puerta Azul integra y culmina las dos anteriores.']],et:'La Pregunta "Â¿QuiÃ©n Soy?"',eo:'Utilizar la autoindagaciÃ³n para ir mÃ¡s allÃ¡ de las identificaciones superficiales.',er:'"TCT Puerta Azul Anexos", pÃ¡g. 99.',ep:['SiÃ©ntate en silencio por unos minutos.','PregÃºntate internamente: "Â¿QuiÃ©n soy yo?".','Observa las respuestas que surgen automÃ¡ticamente: "Soy [tu nombre]", "Soy [tu profesiÃ³n]", "Soy un padre/madre", "Soy mis pensamientos", "Soy mis emociones".','A cada respuesta, reconoce: "Tengo este rol/pensamiento/cuerpo, pero no soy solo esto".','ContinÃºa preguntando: "Â¿QuiÃ©n soy yo mÃ¡s allÃ¡ de todo eso? Â¿QuiÃ©n es el que observa todo esto?".']};
WD[26]={m:'Para comprender la naturaleza de la mente, primero debemos entender cÃ³mo la hemos conceptualizado. Esta semana exploramos diferentes perspectivas sobre la mente: desde la psicologÃ­a convencional y transpersonal hasta las visiones radicales del hinduismo y los filÃ³sofos Jiddu y U.G. Krishnamurti. Esto nos ayuda a ver que nuestras ideas sobre la mente son construcciones, no la realidad Ãºltima.',c:[['PsicologÃ­a Convencional','La mente como producto del cerebro, un conjunto de procesos cognitivos (percepciÃ³n, memoria, pensamiento).'],['PsicologÃ­a Transpersonal','La mente como algo que trasciende el ego, con niveles pre-egoicos, egoicos y transpersonales.'],['Hinduismo','La mente con sus diferentes niveles (Manas, Buddhi, Ahamkara, Chitta) que deben ser purificados para realizar el Atman (el verdade'],['Jiddu Krishnamurti','La mente estÃ¡ condicionada por el pasado. El verdadero problema es la mente misma, no los problemas que crea. Buscar la verdad a t']],et:'Observando el Condicionamiento',eo:'Tomar consciencia de cÃ³mo la mente estÃ¡ condicionada por el pasado.',er:'',ep:['Elige una opiniÃ³n o creencia fuerte que tengas (polÃ­tica, social, personal).','SiÃ©ntate en silencio y rastrea el origen de esa creencia. Â¿De dÃ³nde vino? Â¿La aprendiste de tu familia, de la escuela, de la cultura?','Observa las emociones que estÃ¡n asociadas a esa creencia. Â¿QuÃ© sientes cuando alguien la desafÃ­a?','PregÃºntate: "Â¿QuiÃ©n serÃ­a yo sin esta creencia?".','El objetivo no es cambiar la creencia, sino ver que es algo adquirido, una construcciÃ³n del pasado, no una verdad absoluta sobre quiÃ©n eres.']};
WD[27]={m:'El Dzogchen ofrece una visiÃ³n radical: la mente en su estado natural (Rigpa) es ya pura, lÃºcida y libre. No es algo que se deba crear o alcanzar, sino reconocer. La "mente ordinaria" no es la mente conceptual y ocupada, sino este estado primordial que estÃ¡ siempre presente, como un cielo claro detrÃ¡s de las nubes de pensamientos y emociones.',c:[['Mente Ordinaria/Natural (Rigpa)','La conciencia primordial, pura, luminosa, espontÃ¡nea y no-conceptual. Es innata e inmutable.'],['ObstÃ¡culos a la Mente Natural','Los conceptos, las emociones negativas y los apegos oscurecen el reconocimiento de Rigpa, pero no pueden manchar su naturaleza.'],['La IluminaciÃ³n como Reconocimiento','La iluminaciÃ³n no es un estado futuro, sino la realizaciÃ³n de nuestra verdadera naturaleza, que es la mente natural, aquÃ­ y ahora.']],et:'Descansar en la Conciencia',eo:'Tener un atisbo de la mente natural mÃ¡s allÃ¡ de los pensamientos.',er:'Adaptado de las enseÃ±anzas de Dzogchen.',ep:['SiÃ©ntate cÃ³modamente y cierra los ojos.','Permite que tus pensamientos vengan y vayan sin prestarles atenciÃ³n. No los sigas, no los rechaces.','Lleva tu atenciÃ³n no a los pensamientos, sino al  espacio  en el que los pensamientos aparecen.','Date cuenta de que hay una conciencia silenciosa y espaciosa que es consciente de los pensamientos, pero que no es los pensamientos.','Descansa en esa conciencia abierta y receptiva. No intentes "hacer" nada. Simplemente, sÃ© esa conciencia que observa.']};
WD[28]={m:'La metÃ¡fora del espejo es central en el Dzogchen para explicar la naturaleza de la mente. La mente natural es como un espejo: claro, puro y capaz de reflejar cualquier cosa sin ser afectado por los reflejos. Los pensamientos, emociones y percepciones son los reflejos. El error (ma-rigpa) es olvidarse de que somos el espejo e identificarnos con los reflejos.',c:[['El Espejo','Representa la mente natural, pura e inmutable.'],['Los Reflejos','Simbolizan los pensamientos, emociones y percepciones, que son impermanentes y cambiantes.'],['La PrÃ¡ctica','Consiste en "limpiar el espejo" (eliminar los oscurecimientos de la ignorancia y el apego) para reconocer su claridad inherente.'],['Beneficios','Comprender esta analogÃ­a nos ayuda a observar nuestros pensamientos sin identificarnos con ellos, reduciendo el sufrimiento.']],et:'Ser el Espejo',eo:'Experimentar la des-identificaciÃ³n de los pensamientos usando la metÃ¡fora del espejo.',er:'',ep:['SiÃ©ntate en meditaciÃ³n.','Visualiza tu mente como un espejo perfectamente limpio y brillante.','Observa cÃ³mo los pensamientos, las imÃ¡genes y las sensaciones aparecen como reflejos en la superficie del espejo.','Nota que el espejo no juzga los reflejos. No se aferra a los "buenos" ni rechaza los "malos". Simplemente, refleja.','Cuando aparezca un pensamiento, nÃ³mbralo internamente como "reflejo" y dÃ©jalo pasar.','IdentifÃ­cate con el espejo, no con los reflejos. Siente la cualidad de calma, claridad e imperturbabilidad del espejo mismo.']};
WD[29]={m:'Llevamos los principios de UCDM a su nivel mÃ¡s profundo. El "Testigo Santo" es la perspectiva del EspÃ­ritu Santo en nuestra mente, que observa el mundo del ego sin juicio y con compasiÃ³n. El objetivo final es trascender la observaciÃ³n y recordar nuestra Unidad con Dios y con toda la CreaciÃ³n. La felicidad no es aceptar "lo que es" en el mundo de la ilusiÃ³n, sino recordar "lo que siempre ha sido" e',c:[['Nivel 3','Unidad (Recordar QuiÃ©n Soy):  Trascender la dualidad de observador y observado. La prÃ¡ctica es descansar en la afirmaciÃ³n "Soy tal'],['CorrecciÃ³n de Distorsiones','UCDM corrige las distorsiones cognitivas no reemplazando un pensamiento por otro, sino reconociendo que solo el Amor es real.'],['MeditaciÃ³n "Solo el Amor es Real"','Una prÃ¡ctica para retirar la creencia en la realidad del miedo, el ataque y el sufrimiento.'],['Unidad sobre SeparaciÃ³n','La clave de la maestrÃ­a es aplicar consistentemente el principio de que la separaciÃ³n es una ilusiÃ³n y que solo la unidad es verda']],et:'MeditaciÃ³n "Solo el Amor es Real"',eo:'Retirar la fe en el sistema de pensamiento del ego y descansar en la certeza del Amor.',er:'Anexo V de "TCT Puerta Azul".',ep:['SiÃ©ntate en silencio y trae a la mente una situaciÃ³n de miedo o conflicto.','Observa los pensamientos y emociones asociados a ella.','Ahora, afirma con convicciÃ³n: "Esto no es real. Es una sombra del pasado. Solo el Amor es real".','Visualiza una luz dorada que representa el Amor de Dios disolviendo la situaciÃ³n de miedo.','Repite la lecciÃ³n de UCDM: "Puedo elegir la paz en lugar de esto".','Descansa en la sensaciÃ³n de paz que surge al soltar la creencia en el miedo.']};
WD[30]={m:'Esta semana nos sumergimos en la esencia del libro "El Ser Consciente". La verdadera prÃ¡ctica espiritual no ocurre en el retiro, sino en medio de la vida real: en el trabajo, en las relaciones, en la dificultad. La presencia no es algo que se aÃ±ade, sino que se recuerda. El objetivo es habitar la vida sin huir de ella ni idealizarla, encontrando el despertar en lo ordinario.',c:[['Presencia en la AcciÃ³n','El sentido se encuentra en la calidad de presencia con la que se vive cada acciÃ³n, no en el resultado.'],['Flow y AcciÃ³n sin Esfuerzo','Cuando dejamos de interferir con el control mental, la acciÃ³n se ordena sola y surge desde una inteligencia mÃ¡s profunda.'],['El Esfuerzo como SeÃ±al de DesalineaciÃ³n','El esfuerzo psicolÃ³gico excesivo es una seÃ±al de lucha interna y olvido de la presencia.'],['La Vida como PrÃ¡ctica Consciente','Cada gesto, conversaciÃ³n y decisiÃ³n es una oportunidad para recordar.']],et:'Una Sola Cosa a la Vez',eo:'Combatir la multitarea y la fragmentaciÃ³n de la atenciÃ³n, cultivando la presencia en una sola acciÃ³n.',er:'Anexo II de "El Ser Consciente".',ep:['Elige una actividad para los prÃ³ximos 15 minutos (responder un correo, leer un informe, preparar una comida).','CompromÃ©tete a hacer  solo eso  durante ese tiempo.','Si tu mente divaga o sientes el impulso de hacer otra cosa (revisar el telÃ©fono, pensar en la siguiente tarea), nÃ³talo amablemente y trae tu atenciÃ³n de vuelta a la Ãºnica tarea presente.','No lo hagas con tensiÃ³n, sino con una elecciÃ³n calmada y deliberada.','Observa cÃ³mo la simplicidad de hacer una sola cosa ordena la mente y profundiza la calidad de la acciÃ³n.']};
WD[31]={m:'Aplicamos los protocolos de sonido mÃ¡s avanzados para la Puerta Azul. El "Masaje Vibracional de DesintoxicaciÃ³n" es un protocolo exhaustivo para limpiar el cuerpo fÃ­sico y energÃ©tico a travÃ©s de la percusiÃ³n y fricciÃ³n sistemÃ¡tica. El "Masaje para Despertar la Memoria Ancestral" utiliza notas y mantras especÃ­ficos para conectar con la sabidurÃ­a profunda que reside en nuestro ADN espiritual.',c:[['DesintoxicaciÃ³n Vibracional','El sonido como medio para liberar toxinas fÃ­sicas y energÃ©ticas acumuladas en los tejidos y el campo Ã¡urico.'],['Memoria Ancestral','La idea de que llevamos en nosotros una sabidurÃ­a innata y una conexiÃ³n con nuestro linaje espiritual, que puede ser despertada a '],['SincronizaciÃ³n de Sonido y Mantra','La combinaciÃ³n de la vibraciÃ³n del cuenco con la recitaciÃ³n interna de mantras ("Me Veo", "Me Reconozco", "Me Perdono", "Me Amo") ']],et:'Despertar la Memoria Ancestral (Adaptado)',eo:'Realizar una meditaciÃ³n de autosanaciÃ³n y conexiÃ³n con la sabidurÃ­a interna.',er:'"TCT Puerta Azul Anexos", pÃ¡g. 80-83.',ep:['SiÃ©ntate o tÃºmbate. Coloca tus manos sobre tu corazÃ³n.','Respira profundamente y, con cada exhalaciÃ³n, repite internamente el mantra:  "Me Veo". Siente que te ves a ti mismo con compasiÃ³n.','ContinÃºa respirando y cambia el mantra a:  "Me Reconozco". Reconoce tu luz, tu fuerza y tu divinidad.','Cambia el mantra a:  "Me Perdono". PerdÃ³nate por cualquier juicio o error, liberando toda culpa.','Finalmente, cambia el mantra a:  "Me Amo". Siente un amor incondicional que nace desde tu corazÃ³n y se expande por todo tu ser.']};
WD[32]={m:'Los objetos sagrados (cuencos, mandalas, cristales, estatuillas) actÃºan como puentes para conectar con estados superiores de conciencia. El Tagdrol ("liberaciÃ³n a travÃ©s del contacto") es un mÃ©todo del budismo tibetano que utiliza estos objetos como catalizadores para despertar recuerdos del alma y liberar bloqueos kÃ¡rmicos. El poder no estÃ¡ en el objeto, sino en nuestra capacidad de resonar con l',c:[['Tagdrol','LiberaciÃ³n a travÃ©s del contacto, la visiÃ³n o el sonido de objetos sagrados.'],['El Proceso de 5 Fases','Reconocimiento, ConsagraciÃ³n, ComunicaciÃ³n Sagrada, LiberaciÃ³n e IntegraciÃ³n.'],['Mecanismos de SanaciÃ³n','Los objetos actÃºan a nivel psicolÃ³gico (proyecciones del inconsciente), energÃ©tico (reequilibrio de chakras) y espiritual (reconex'],['CreaciÃ³n de un Altar Personal','Un altar es un espacio fÃ­sico dedicado a anclar nuestra intenciÃ³n espiritual y a trabajar con nuestros objetos sagrados.']],et:'El DiÃ¡logo con el Objeto Sagrado',eo:'Establecer una comunicaciÃ³n intuitiva con un objeto personal para recibir guÃ­a.',er:'Anexo III de "TCT Puerta Azul", pÃ¡g. 132.',ep:['Elige un objeto que tenga un significado especial para ti (un cristal, una joya, una foto, una figura).','Limpia energÃ©ticamente el objeto (puedes pasarlo por el humo de incienso o salvia, o usar el sonido de un cuenco).','SiÃ©ntate en silencio, sostÃ©n el objeto en tus manos y cierra los ojos.','Sincroniza tu respiraciÃ³n con el objeto, imaginando que inhalas su esencia y exhalas tu energÃ­a hacia Ã©l.','Pregunta mentalmente: "Â¿QuÃ© mensaje tienes para mÃ­ en este momento de mi vida?".']};
WD[33]={m:'El verdadero poder no es el control externo, sino la maestrÃ­a interior que surge de la conexiÃ³n con nuestra fuente. Esta fuerza se manifiesta como calma en el caos, decisiones claras y creatividad espontÃ¡nea. Las prÃ¡cticas de esta semana se centran en disolver los obstÃ¡culos (identificaciÃ³n con el ego, creencias limitantes) y anclarnos en el poder del ahora.',c:[['Poder AutÃ©ntico','No es dominio, sino maestrÃ­a interior. Surge del autoconocimiento y la conciencia expandida.'],['Las Tres Fuentes del Poder','Presencia Consciente, IntuiciÃ³n Profunda y Coherencia Interna (alineaciÃ³n de pensamiento, emociÃ³n y acciÃ³n).'],['Anclaje en el Poder Presencial','Desarrollar una estabilidad interna que no depende de las circunstancias externas.']],et:'ExpansiÃ³n de Conciencia "El CÃ­rculo del Yo Soy"',eo:'Experimentar la sensaciÃ³n de unidad con toda la existencia, disolviendo los lÃ­mites del ego.',er:'Anexo II de "TCT Puerta Azul", pÃ¡g. 124.',ep:['SiÃ©ntate en meditaciÃ³n y visualiza un punto de luz brillante en el centro de tu corazÃ³n.','Con cada respiraciÃ³n, permite que esa luz se expanda, llenando primero todo tu cuerpo.','ContinÃºa expandiendo la luz mÃ¡s allÃ¡ de tu cuerpo, hasta que llene la habitaciÃ³n, luego el edificio, la ciudad...','Sigue expandiendo tu conciencia hasta que abarque todo el planeta, el sistema solar y finalmente, el cosmos entero.','Permanece en esta sensaciÃ³n de ser el espacio vasto y silencioso que contiene todo el universo.']};
WD[34]={m:'La felicidad no es algo que se obtiene, sino algo que se reconoce cuando la mente deja de obstaculizarla. Esta semana integramos prÃ¡cticas especÃ­ficas para reestructurar la mente y cultivar las virtudes que generan felicidad de forma natural: gratitud, perdÃ³n, aceptaciÃ³n y presencia.',c:[['La Paradoja de la Felicidad','La felicidad es el estado natural de una mente en calma, no el resultado de condiciones externas.'],['El Proceso RAIN (Tara Brach)','Una tÃ©cnica para gestionar emociones: Reconocer, Aceptar, Investigar, No-identificaciÃ³n.'],['Tonglen (Dar y Recibir)','PrÃ¡ctica tibetana para transformar el sufrimiento en compasiÃ³n, inspirando el dolor y exhalando paz.'],['FÃ³rmula Esencial','Felicidad = AceptaciÃ³n + PropÃ³sito + ConexiÃ³n.']],et:'El Proceso RAIN para una EmociÃ³n DifÃ­cil',eo:'Aplicar un mÃ©todo mindfulness para relacionarse con una emociÃ³n difÃ­cil de forma compasiva.',er:'Anexo IV de "TCT Puerta Azul", pÃ¡g. 146.',ep:['Cuando surja una emociÃ³n difÃ­cil (miedo, enfado, tristeza), haz una pausa.','R - Reconocer:  Nombra la emociÃ³n para tus adentros: "Ah, esto es ansiedad" o "Estoy sintiendo tristeza".','A - Aceptar:  Permite que la emociÃ³n estÃ© ahÃ­, sin luchar contra ella ni juzgarte por sentirla. Puedes decirte: "EstÃ¡ bien sentir esto".','I - Investigar:  Con una curiosidad amable, explora cÃ³mo se siente la emociÃ³n en tu cuerpo. Â¿DÃ³nde estÃ¡? Â¿Es caliente, frÃ­a, tensa, vibrante? Â¿QuÃ© creencia estÃ¡ detrÃ¡s de esta emociÃ³n? Â¿QuÃ© necesita esta parte herida de ti?','N - No-identificaciÃ³n:  Date cuenta de que tÃº no eres la emociÃ³n. Eres la conciencia espaciosa en la que la emociÃ³n estÃ¡ ocurriendo. Descansa en esta conciencia mÃ¡s amplia, viendo la emociÃ³n como una nube pasajera.']};
WD[35]={m:'El camino del guerrero espiritual implica transitar por la "noche oscura del alma", un viaje a las profundidades del ser para enfrentar a nuestros demonios internos (el ego, la sombra). Es en esta aparente oscuridad donde se produce la purificaciÃ³n mÃ¡s profunda y donde la luz de la consciencia puede brillar sin impedimentos. Este proceso requiere la fusiÃ³n perfecta de las tres puertas: un cuerpo p',c:[['La Noche Oscura del Alma','Un perÃ­odo de desolaciÃ³n espiritual y desidentificaciÃ³n de las viejas estructuras del ego, que precede a una profunda transformaci'],['Vencerse a Uno Mismo','La verdadera batalla no es externa, sino contra nuestros propios automatismos y la identificaciÃ³n con el ego.'],['La FusiÃ³n de las Tres Puertas','La maestrÃ­a se alcanza cuando el movimiento del cuerpo, la vibraciÃ³n de la energÃ­a y la creaciÃ³n de la mente surgen de una Ãºnica f']],et:'ContemplaciÃ³n del Proceso Espiritual',eo:'Reflexionar sobre el propio viaje espiritual utilizando el esquema simbÃ³lico presentado.',er:'"TCT Puerta Azul Anexos", pÃ¡g. 53-68.',ep:['Observa la secuencia de imÃ¡genes que describen el proceso espiritual, desde el espacio vacÃ­o hasta la realizaciÃ³n del cuerpo de arco iris.','Reflexiona sobre en quÃ© punto del camino te sientes. Â¿EstÃ¡s en la fase de la mente dualista, empezando a purificar la visiÃ³n, o has tenido atisbos del estado de Rigpa?','Contempla la imagen del "viaje del guerrero" y la interacciÃ³n de las tres puertas (Cuerpo-Movimiento, Voz-VibraciÃ³n, Mente-CreaciÃ³n).','No se trata de juzgar tu progreso, sino de tomar consciencia de tu proceso con honestidad y compasiÃ³n. Reconoce que cada paso, incluso los difÃ­ciles, forma parte del camino de regreso a casa.']};
WD[36]={m:'La integraciÃ³n de la Puerta Azul es la encarnaciÃ³n de la visiÃ³n no-dual en la vida diaria. Es dejar de "hacer" las prÃ¡cticas para "ser" la prÃ¡ctica. Es vivir como el espejo: reflejando la vida tal como es, con sus alegrÃ­as y dolores, sin ser manchado ni definido por ella. La maestrÃ­a no es la ausencia de reflejos (pensamientos, emociones), sino el reconocimiento ininterrumpido de nuestra naturalez',c:[],et:'de IntegraciÃ³n: Vivir el DÃ­a como el Espejo',eo:'Mantener el reconocimiento de la mente-espejo durante las actividades cotidianas.',er:'',ep:['Comienza el dÃ­a con la intenciÃ³n: "Hoy, recuerdo que soy el espejo, no los reflejos".','Durante el dÃ­a, cuando surja una situaciÃ³n (agradable o desagradable), un pensamiento o una emociÃ³n, nÃ³talo y di internamente: "Un reflejo".','Observa la tendencia de la mente a identificarse, a reaccionar, a aferrarse o a rechazar el reflejo.','Amablemente, una y otra vez, trae tu identidad de vuelta al espejo: a la conciencia silenciosa, clara y espaciosa que simplemente observa.','Presta especial atenciÃ³n a los momentos de interacciÃ³n. Â¿Puedes ver a la otra persona como un reflejo en tu espejo, sin juicio? Â¿Puedes ver tus propias reacciones como reflejos tambiÃ©n?','Al final del dÃ­a, reflexiona: Â¿En quÃ© momentos fue mÃ¡s fÃ¡cil recordar que eres el espejo? Â¿En quÃ© momentos te identificaste mÃ¡s con los reflejos? No hay juicio, solo observaciÃ³n para la prÃ³xima prÃ¡ctica. Puerta IntegraciÃ³n (Semanas 37-48) Tema Central:  SÃ­ntesis y EncarnaciÃ³n. Fuentes Principales:  ']};
WD[37]={m:'Repasamos el viaje completo, viendo cÃ³mo cada puerta construye sobre la anterior. La Puerta Blanca nos dio el  suelo  (el cuerpo presente). La Puerta Roja nos dio el  corazÃ³n  (la energÃ­a purificada). La Puerta Azul nos dio el  cielo  (la mente espaciosa). Ahora, en la Puerta de IntegraciÃ³n, aprendemos a vivir simultÃ¡neamente en el suelo, el corazÃ³n y el cielo. Son tres dimensiones de una Ãºnica Re',c:[],et:'MeditaciÃ³n de las Tres Puertas',eo:'Unificar la conciencia de los tres centros en una sola meditaciÃ³n.',er:'',ep:['SiÃ©ntate en una postura cÃ³moda.','Puerta Blanca (5 min):  Lleva tu atenciÃ³n a tu cuerpo. Siente el contacto con el suelo, el peso, la postura. Habita tu cuerpo fÃ­sico plenamente. Siente la presencia sÃ³lida y cimentada.','Puerta Roja (5 min):  Lleva tu atenciÃ³n a tu centro energÃ©tico, al Ã¡rea del corazÃ³n y la garganta. Siente la energÃ­a vital que pulsa en ti. Con cada respiraciÃ³n, siente cÃ³mo esta energÃ­a se purifica y se vuelve mÃ¡s sutil y amorosa.','Puerta Azul (5 min):  Expande tu atenciÃ³n para incluir el espacio de la mente. Observa los pensamientos como nubes en un cielo vasto y claro. Descansa en la conciencia espaciosa y no-dual.','IntegraciÃ³n (5 min):  MantÃ©n simultÃ¡neamente la conciencia del cuerpo (suelo), la energÃ­a (corazÃ³n) y la mente (cielo). Siente cÃ³mo eres las tres cosas a la vez: anclado, vibrante y espacioso.']};
WD[38]={m:'Profundizamos en la "FÃ³rmula Esencial de la Felicidad" como el mapa para la integraciÃ³n. La felicidad no es una emociÃ³n pasajera, sino la resonancia de un ser en equilibrio. Este equilibrio se sostiene sobre tres pilares que hemos cultivado a lo largo del viaje: AceptaciÃ³n (Puerta Blanca):  La paz que viene de estar presente en el ahora y aceptar la realidad tal como es, comenzando por nuestro pro',c:[],et:'ReflexiÃ³n sobre los Tres Pilares',eo:'Evaluar cÃ³mo se manifiestan los tres pilares de la felicidad en tu vida actual.',er:'',ep:['AceptaciÃ³n:  Â¿En quÃ© Ã¡reas de mi vida estoy practicando la aceptaciÃ³n? Â¿En quÃ© Ã¡reas todavÃ­a hay resistencia y lucha? Â¿CÃ³mo es mi relaciÃ³n con mi cuerpo en este momento?','PropÃ³sito:  Â¿QuÃ© actividades o acciones me dan un sentido de propÃ³sito? Â¿Mis acciones diarias estÃ¡n alineadas con mis valores mÃ¡s profundos? Â¿CÃ³mo puedo expresar mi propÃ³sito de formas pequeÃ±as hoy?','ConexiÃ³n:  Â¿CuÃ¡ndo me siento mÃ¡s conectado conmigo mismo, con los demÃ¡s y con la vida? Â¿QuÃ© hÃ¡bitos o patrones de pensamiento me hacen sentir separado? Â¿CÃ³mo puedo cultivar una mayor sensaciÃ³n de conexiÃ³n?']};
WD[39]={m:'La maestrÃ­a no es un logro individualista. Recordamos que cada uno de nosotros, con nuestro estado de conciencia, contribuye al "campo invisible" de la humanidad. Una sociedad consciente no es una utopÃ­a, sino el resultado de individuos que asumen la responsabilidad de su propia presencia. El gesto mÃ¡s polÃ­tico y transformador es, a menudo, el mÃ¡s silencioso: escuchar de verdad, no reaccionar auto',c:[],et:'Ofrecer Presencia',eo:'Practicar la contribuciÃ³n consciente al campo colectivo.',er:'',ep:['Elige una interacciÃ³n del dÃ­a (con un familiar, un colega, un dependiente en una tienda).','Antes de la interacciÃ³n, toma un momento para centrarte. Conecta con tu cuerpo y tu respiraciÃ³n. Establece la intenciÃ³n de "ofrecer presencia".','Durante la interacciÃ³n, tu Ãºnico objetivo es estar plenamente presente. Escucha sin interrumpir. Mira a la persona a los ojos. Siente el campo emocional entre vosotros.','No intentes arreglar, aconsejar o cambiar nada. Tu Ãºnica ofrenda es tu atenciÃ³n plena y tu presencia no-reactiva.','Observa el efecto que este simple acto tiene en la interacciÃ³n y en tu propio estado interno.']};
WD[40]={m:'Retomamos la herramienta del diario desde la perspectiva del Cuarto Camino, pero ahora con la visiÃ³n integrada de las tres puertas. El diario se convierte en un laboratorio para la auto-observaciÃ³n de los tres centros en acciÃ³n y para registrar los momentos de "recuerdo de sÃ­" y de "identificaciÃ³n". Estructura del Diario Integrado: ObservaciÃ³n de los Centros:  Al final del dÃ­a, anota una situaciÃ³n',c:[],et:'Mantener el Diario del Cuarto Camino',eo:'Utilizar la escritura como una herramienta sistemÃ¡tica para aumentar la autoconciencia.',er:'',ep:[]};
WD[41]={m:'La prÃ¡ctica del perdÃ³n de UCDM es el corazÃ³n de la purificaciÃ³n de la Puerta Roja y la maestrÃ­a de la Puerta Azul. Esta semana, nos comprometemos a hacer del perdÃ³n una prÃ¡ctica diaria y sistemÃ¡tica, utilizando el diario como una herramienta para no dejar que ningÃºn resentimiento o juicio se arraigue en la mente. Estructura del Diario del PerdÃ³n: MaÃ±ana:  Establece el propÃ³sito del dÃ­a: "Por encim',c:[],et:'Mantener el Diario del PerdÃ³n',eo:'Hacer del perdÃ³n una respuesta automÃ¡tica a cualquier forma de conflicto.',er:'',ep:[]};
WD[42]={m:'Desde la perspectiva del Dzogchen, la felicidad es nuestro estado natural. El diario se convierte en una herramienta no para "lograr" la felicidad, sino para registrar los momentos en que recordamos nuestra naturaleza de espejo y para observar los patrones que oscurecen esa felicidad. Estructura del Diario de la Mente Feliz: Momentos de "Espejo":  Anota cualquier momento en que te sentiste como el',c:[],et:'Mantener el Diario de la Mente Feliz',eo:'Estabilizar el reconocimiento de la mente natural.',er:'',ep:[]};
WD[43]={m:'La culminaciÃ³n de la prÃ¡ctica es la "acciÃ³n sin esfuerzo" o Wu Wei. No significa pasividad, sino actuar en perfecta armonÃ­a con el fluir de la vida. Esto solo es posible cuando el ego, con su necesidad de controlar, planificar y forzar, se ha relajado. La no-interferencia es confiar en la inteligencia mÃ¡s profunda del Ser, que sabe quÃ© hacer y cuÃ¡ndo hacerlo sin necesidad de la deliberaciÃ³n consta',c:[],et:'La Danza del No-Esfuerzo',eo:'Practicar la acciÃ³n que surge de la quietud en lugar de la urgencia del ego.',er:'Anexo II de "TCT Puerta Azul", pÃ¡g. 124.',ep:['Establece la intenciÃ³n para el dÃ­a: "Hoy permitirÃ© que la vida fluya a travÃ©s de mÃ­".','Ante cada decisiÃ³n o acciÃ³n, especialmente si sientes urgencia o ansiedad, haz una pausa.','Respira y conecta con la quietud de tu centro.','PregÃºntate: "Â¿Esta acciÃ³n surge del miedo y la necesidad de controlar, o del flujo natural y la respuesta intuitiva?".','ActÃºa solo cuando la respuesta venga de la quietud. Si no hay claridad, espera. La inacciÃ³n consciente es a menudo la acciÃ³n mÃ¡s poderosa.']};
WD[44]={m:'Cuando la bÃºsqueda del ego para "conseguir algo" se disuelve, emerge una nueva motivaciÃ³n: el servicio. El servicio no es necesariamente una acciÃ³n grandiosa, sino la expresiÃ³n natural de un corazÃ³n abierto. Es el reconocimiento de que nuestra paz y nuestra felicidad son inseparables de la paz y la felicidad de todos. Nuestro legado mÃ¡s importante no es lo que logramos, sino la calidad de presenci',c:[],et:'Un Acto de Servicio AnÃ³nimo',eo:'Experimentar la alegrÃ­a de dar sin ninguna expectativa de reconocimiento.',er:'',ep:['Busca una oportunidad para realizar un pequeÃ±o acto de servicio o bondad de forma anÃ³nima.','Puede ser algo simple: dejar una nota amable, hacer una pequeÃ±a donaciÃ³n, limpiar un espacio compartido sin que nadie te vea, enviar un pensamiento de amor a alguien con quien tienes dificultades.','El Ãºnico requisito es que nadie sepa que lo hiciste tÃº.','Observa la sensaciÃ³n que surge. La alegrÃ­a del servicio puro no viene de la gratitud externa, sino de la alineaciÃ³n interna con el flujo del amor.']};
WD[45]={m:'La comunicaciÃ³n se convierte en una de las prÃ¡cticas de maestrÃ­a mÃ¡s importantes. La comunicaciÃ³n del ego busca tener razÃ³n, defenderse o manipular. La comunicaciÃ³n desde la Fuente busca la conexiÃ³n y la verdad. Implica escuchar desde el silencio, hablar desde el corazÃ³n y reconocer al Ser en la otra persona, mÃ¡s allÃ¡ de su personalidad. Concepto Clave: Escuchar para Conectar, no para Responder La',c:[],et:'La ConversaciÃ³n Consciente',eo:'Transformar una conversaciÃ³n ordinaria en una prÃ¡ctica de presencia.',er:'Anexo II de "TCT Puerta Azul", pÃ¡g. 125.',ep:['Elige una conversaciÃ³n que tendrÃ¡s hoy.','Antes de empezar, establece la intenciÃ³n de escuchar para conectar, no para ganar.','Durante la conversaciÃ³n, mantÃ©n una parte de tu atenciÃ³n en tu propio estado interno. Â¿EstÃ¡s presente? Â¿EstÃ¡s reaccionando?','Cuando la otra persona hable, escucha con todo tu ser. Intenta sentir lo que hay detrÃ¡s de sus palabras.','Cuando sea tu turno de hablar, haz una pausa. Permite que tus palabras surjan de la quietud y la honestidad, no de la reacciÃ³n.']};
WD[46]={m:'La maestrÃ­a no es un estado estÃ¡tico, sino una cualidad de serenidad radiante que impregna todas nuestras actividades. Es la capacidad de permanecer centrado y en paz en medio del caos del mundo. No es una paz pasiva, sino una calma activa y dinÃ¡mica que surge de la confianza inquebrantable en la Realidad. Es el fruto de la integraciÃ³n de las tres puertas: un cuerpo relajado, un corazÃ³n abierto y ',c:[],et:'Anclar la Serenidad',eo:'Cultivar la serenidad como estado de fondo a lo largo del dÃ­a.',er:'',ep:['Comienza el dÃ­a con 5 minutos de silencio, conectando con la sensaciÃ³n de paz interior.','A lo largo del dÃ­a, utiliza un "ancla" para volver a esa sensaciÃ³n. Puede ser una palabra ("Paz"), una imagen (un lago en calma) o una sensaciÃ³n fÃ­sica (el contacto de tus pies con el suelo).','Cada vez que te sientas arrastrado por el estrÃ©s o el drama, utiliza tu ancla para hacer una pausa y reconectar con la serenidad que estÃ¡ siempre disponible debajo del ruido de la superficie.','La prÃ¡ctica es volver, una y otra vez, a este centro de calma, hasta que se convierta en tu forma natural de estar en el mundo.']};
WD[47]={m:'El camino espiritual no es una lÃ­nea recta, sino una espiral. Volveremos a enfrentar los mismos temas (el ego, el miedo, el perdÃ³n), pero cada vez desde un nivel de conciencia mÃ¡s elevado. La integraciÃ³n no es un final, sino el comienzo de un trabajo continuo, donde cada vuelta de la espiral profundiza nuestra comprensiÃ³n y encarnaciÃ³n. Concepto Clave: No hay RegresiÃ³n, solo ProfundizaciÃ³n Cuando ',c:[],et:'RevisiÃ³n en Espiral',eo:'Reconocer el progreso en espiral en tu propio camino.',er:'',ep:['Reflexiona sobre un desafÃ­o o patrÃ³n con el que has trabajado durante este curso.','Recuerda cÃ³mo te relacionabas con Ã©l al principio (Puerta Blanca). Â¿CÃ³mo lo abordaste durante la Puerta Roja? Â¿Y desde la perspectiva de la Puerta Azul?','Observa cÃ³mo tu comprensiÃ³n y tu capacidad para manejarlo han cambiado, aunque el tema central sea el mismo.','Reconoce y honra tu progreso. Si el patrÃ³n sigue apareciendo, dale la bienvenida como una oportunidad para una sanaciÃ³n aÃºn mÃ¡s profunda, en la siguiente vuelta de la espiral.']};
WD[48]={m:'El viaje de 48 semanas llega a su fin, pero el verdadero Camino apenas comienza. Hemos recibido un mapa y un conjunto de herramientas, pero ahora nos corresponde caminar. El cierre no es una graduaciÃ³n, sino un compromiso renovado con la prÃ¡ctica de la presencia en cada momento de la vida. ReflexiÃ³n Final del MÃ©todo TCT: El objetivo del MÃ©todo TCT nunca fue convertirte en alguien diferente. Fue ay',c:[],et:'Final: La Promesa a Ti Mismo',eo:'Sellar el compromiso con tu propio despertar.',er:'',ep:['Busca un momento y un lugar tranquilos.','Escribe una carta a tu Ser futuro (el que leerÃ¡ esto en un aÃ±o).','En la carta, describe los aprendizajes mÃ¡s importantes de este viaje. Â¿QuÃ© has descubierto sobre ti mismo? Â¿QuÃ© prÃ¡cticas te han servido mÃ¡s?','Hazte una promesa. No una promesa de "ser perfecto" o "no volver a caer", sino una promesa de "recordar". PromÃ©tete que seguirÃ¡s practicando la pausa, que serÃ¡s amable contigo mismo, que seguirÃ¡s eligiendo la paz.','Guarda la carta en un lugar seguro y pon un recordatorio en tu calendario para leerla dentro de un aÃ±o. SerÃ¡ un poderoso recordatorio de tu compromiso y un testimonio de tu continuo viaje en la espiral. "Sigue tu camino, con tu propio ritmo, vive en paz, con amor... vive. Â¡SÃ© la frecuencia del unive']};



// â”€â”€ ADMIN PANEL â”€â”€
var _adminData = [];

async function loadAdminData() {
  if (!sb) { toast('Sin conexiÃ³n a Supabase'); return; }
  const tbody = document.getElementById('admin-tbody');
  tbody.innerHTML = '<tr><td colspan="7" class="admin-empty">â³ Cargando datos...</td></tr>';

  try {
    // Load all users from auth (via user_progress table + auth.users view if available)
    const { data: profiles, error: pe } = await sb.from('user_progress')
      .select('user_id, week_number, status, puerta, completed_at')
      .order('user_id');

    // Try to get user emails from a profiles/users table if it exists
    let usersMap = {};
    try {
      const { data: users } = await sb.from('profiles').select('id, email, full_name, created_at, plan');
      if (users) users.forEach(function(u){ usersMap[u.id] = u; });
    } catch(e) {
      // profiles table may not exist yet â€” that's ok
    }

    if (!profiles || profiles.length === 0) {
      tbody.innerHTML = '<tr><td colspan="7" class="admin-empty">No hay datos de progreso aÃºn. Los alumnos aparecerÃ¡n aquÃ­ cuando inicien su formaciÃ³n.</td></tr>';
      document.getElementById('admin-total').textContent = '0';
      document.getElementById('admin-activos').textContent = '0';
      document.getElementById('admin-semana-media').textContent = 'â€”';
      document.getElementById('admin-completadas').textContent = '0';
      return;
    }

    // Agregate by user
    var byUser = {};
    profiles.forEach(function(p) {
      if (!byUser[p.user_id]) byUser[p.user_id] = { user_id: p.user_id, completed: [], current: 1, puerta: 'Blanca' };
      if (p.status === 'completed') byUser[p.user_id].completed.push(p.week_number);
      if (p.status === 'in_progress') byUser[p.user_id].current = p.week_number;
      if (p.puerta) byUser[p.user_id].puerta = p.puerta;
    });

    _adminData = Object.values(byUser);
    renderAdminTable(_adminData, usersMap);

    // Stats
    var total = _adminData.length;
    var activos = _adminData.filter(function(u){ return u.completed.length > 0; }).length;
    var totalCompleted = _adminData.reduce(function(acc, u){ return acc + u.completed.length; }, 0);
    var semanaMedia = total > 0 ? Math.round(_adminData.reduce(function(acc,u){ return acc + u.current; },0) / total) : 0;
    document.getElementById('admin-total').textContent = total;
    document.getElementById('admin-activos').textContent = activos;
    document.getElementById('admin-semana-media').textContent = semanaMedia;
    document.getElementById('admin-completadas').textContent = totalCompleted;

  } catch(e) {
    tbody.innerHTML = '<tr><td colspan="7" class="admin-empty">Error cargando datos: ' + e.message + '</td></tr>';
    console.error('Admin error:', e);
  }
}

function renderAdminTable(data, usersMap) {
  var tbody = document.getElementById('admin-tbody');
  if (!data || data.length === 0) {
    tbody.innerHTML = '<tr><td colspan="7" class="admin-empty">No se encontraron alumnos.</td></tr>';
    return;
  }
  var badgeClass = { Blanca:'badge-blanca', Roja:'badge-roja', Azul:'badge-azul', Arcoiris:'badge-arcoiris', Oro:'badge-oro' };
  var puertas = { Blanca:'ðŸŒ¿ Blanca', Roja:'ðŸ”¥ Roja', Azul:'ðŸ”µ Azul', Arcoiris:'ðŸŒˆ Arcoiris', Oro:'âœ¨ Oro' };
  tbody.innerHTML = data.map(function(u) {
    var profile = usersMap[u.user_id] || {};
    var name = profile.full_name || 'â€”';
    var email = profile.email || u.user_id.substring(0,8) + '...';
    var plan = profile.plan || u.puerta || 'Blanca';
    var pct = Math.round((u.completed.length / 48) * 100);
    var fecha = profile.created_at ? new Date(profile.created_at).toLocaleDateString('es-ES') : 'â€”';
    return '<tr>' +
      '<td><strong style="font-size:13px">' + name + '</strong></td>' +
      '<td style="color:#7a7168">' + email + '</td>' +
      '<td><span class="admin-badge ' + (badgeClass[plan]||'badge-blanca') + '">' + (puertas[plan]||plan) + '</span></td>' +
      '<td style="font-weight:600">Sem. ' + u.current + '</td>' +
      '<td><div style="display:flex;align-items:center;gap:8px"><div class="admin-progress-bar"><div class="admin-progress-fill" style="width:' + pct + '%"></div></div><span style="font-size:11px;color:#7a7168">' + pct + '%</span></div></td>' +
      '<td>' + u.completed.length + ' / 48</td>' +
      '<td style="color:#a89e93;font-size:12px">' + fecha + '</td>' +
    '</tr>';
  }).join('');
}

function filterAdminTable(query) {
  var q = query.toLowerCase();
  var filtered = _adminData.filter(function(u){
    return (u.user_id||'').toLowerCase().includes(q) ||
           (u.puerta||'').toLowerCase().includes(q);
  });
  renderAdminTable(filtered, {});
}

// Override goTo to load admin data when navigating to admin
var _originalGoTo = goTo;
function goTo(page) {
  document.querySelectorAll('.page').forEach(function(p){ p.classList.remove('active'); });
  document.getElementById('page-' + page).classList.add('active');
  window.scrollTo(0,0);
  if (page === 'student') refreshDashboard();
  if (page === 'admin') loadAdminData();
}

// Close modal on outside click
document.getElementById('week-modal').addEventListener('click', function(e){
  if (e.target === this) closeModal();
});
</script>
    
  


<!-- TOAST -->
<div class="toast" id="toast"></div>





<!-- PAGE: ADMIN -->
<div class="page" id="page-admin">
  <div class="admin-wrap">
    <div class="admin-header">
      <h1>Panel <span>Admin</span> â€” Frecuencia Integral Academy</h1>
      <div style="display:flex;gap:10px">
        <button class="admin-refresh" onclick="loadAdminData()">â†» Actualizar</button>
        <button class="btn-ghost" style="color:white;border-color:rgba(255,255,255,.2)" onclick="goTo('student')">â† Volver al Dashboard</button>
      </div>
    </div>
    <div class="admin-body">
      <!-- Stats -->
      <div class="admin-stats">
        <div class="admin-stat">
          <div class="admin-stat-val" id="admin-total">â€”</div>
          <div class="admin-stat-label">Alumnos Totales</div>
        </div>
        <div class="admin-stat">
          <div class="admin-stat-val" id="admin-activos">â€”</div>
          <div class="admin-stat-label">Con Progreso</div>
        </div>
        <div class="admin-stat">
          <div class="admin-stat-val" id="admin-semana-media">â€”</div>
          <div class="admin-stat-label">Semana Media</div>
        </div>
        <div class="admin-stat">
          <div class="admin-stat-val" id="admin-completadas">â€”</div>
          <div class="admin-stat-label">Semanas Completadas</div>
        </div>
      </div>
      <!-- Table -->
      <div class="admin-table-wrap">
        <div class="admin-table-header">
          <div class="admin-table-title">Alumnos Registrados</div>
          <input class="admin-search" id="admin-search" type="text" placeholder="ðŸ” Buscar alumno..." oninput="filterAdminTable(this.value)">
        </div>
        <div style="overflow-x:auto">
          <table class="admin-table" id="admin-table">
            <thead>
              <tr>
                <th>Alumno</th>
                <th>Email</th>
                <th>Plan / Puerta</th>
                <th>Semana Actual</th>
                <th>Progreso</th>
                <th>Completadas</th>
                <th>Registro</th>
              </tr>
            </thead>
            <tbody id="admin-tbody">
              <tr><td colspan="7" class="admin-empty">Cargando alumnos...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div><!-- /page-admin -->

<!-- PDF FULLSCREEN MODAL -->
<div class="pdf-modal-overlay" id="pdf-fullscreen-modal">
  <div class="pdf-modal-topbar">
    <div class="pdf-modal-topbar-name" id="pdf-fullscreen-name"></div>
    <div class="pdf-modal-topbar-actions">
      <a class="btn-pdf-fullscreen-dl" id="pdf-fullscreen-dl" href="#" download="" target="_blank">â¬‡ Descargar</a>
      <button class="btn-pdf-fullscreen-close" onclick="closePdfFullscreen()">âœ• Cerrar</button>
    </div>
  </div>
  <iframe class="pdf-modal-frame" id="pdf-fullscreen-frame" src=""></iframe>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- GESTOR DE HEADER, CATEGORÃAS Y PÃGINAS OCULTAS           -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- PANEL PRINCIPAL DEL GESTOR -->
<div id="hcpPanel" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;z-index:10010;background:rgba(0,0,0,.7);backdrop-filter:blur(4px)">
  <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:min(94vw,860px);max-height:90vh;background:#161210;border-radius:16px;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 24px 80px rgba(0,0,0,.8);font-family:'DM Sans',sans-serif">

    <!-- Header del panel -->
    <div style="background:#1c1814;padding:16px 24px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(255,255,255,.1);flex-shrink:0">
      <div style="display:flex;align-items:center;gap:12px">
        <span style="font-size:18px">ðŸ—‚ï¸</span>
        <div>
          <div style="font-size:14px;font-weight:700;color:white">Gestor de NavegaciÃ³n y PÃ¡ginas</div>
          <div style="font-size:10px;color:rgba(255,255,255,.4);margin-top:1px">Header Â· CategorÃ­as Â· PÃ¡ginas ocultas</div>
        </div>
      </div>
      <button onclick="hcpClose()" style="background:rgba(255,255,255,.08);border:none;color:rgba(255,255,255,.5);width:32px;height:32px;border-radius:8px;font-size:16px;cursor:pointer">âœ•</button>
    </div>

    <!-- Tabs -->
    <div style="display:flex;border-bottom:1px solid rgba(255,255,255,.08);flex-shrink:0;background:#1a1510">
      <button onclick="hcpTab('header')" class="hcp-tab active" id="hcpTabHeader">ðŸ”— Header</button>
      <button onclick="hcpTab('cats')" class="hcp-tab" id="hcpTabCats">ðŸ“‚ CategorÃ­as</button>
      <button onclick="hcpTab('pages')" class="hcp-tab" id="hcpTabPages">ðŸ“„ PÃ¡ginas</button>
    </div>

    <!-- Content area -->
    <div id="hcpContent" style="flex:1;overflow-y:auto;padding:20px 24px">

      <!-- â•â•â• TAB: HEADER â•â•â• -->
      <div id="hcpSecHeader">
        <div style="color:rgba(255,255,255,.5);font-size:10px;text-transform:uppercase;letter-spacing:.1em;margin-bottom:16px">Configura el logo, enlaces y botones del header</div>

        <!-- Logo -->
        <div class="hcp-card">
          <div class="hcp-card-title">ðŸ·ï¸ Logo / Nombre del sitio</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
            <div>
              <div class="hcp-label">Nombre principal</div>
              <input id="hcpLogoName" class="hcp-inp" value="Frecuencia Integral" placeholder="Nombre del sitio">
            </div>
            <div>
              <div class="hcp-label">SubtÃ­tulo (debajo)</div>
              <input id="hcpLogoSub" class="hcp-inp" value="Academy" placeholder="SubtÃ­tulo">
            </div>
          </div>
          <div style="margin-top:10px">
            <div class="hcp-label">URL al hacer clic en el logo</div>
            <input id="hcpLogoUrl" class="hcp-inp" value="#" placeholder="# o https://...">
          </div>
          <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
            <div style="flex:1;min-width:120px">
              <div class="hcp-label">Color nombre</div>
              <div style="display:flex;gap:5px;align-items:center">
                <input type="color" id="hcpLogoColor" value="#1c1814" style="width:30px;height:30px;border:none;border-radius:5px;cursor:pointer">
                <input id="hcpLogoColorTxt" class="hcp-inp" value="#1c1814" style="flex:1" oninput="document.getElementById('hcpLogoColor').value=this.value">
              </div>
            </div>
            <div style="flex:1;min-width:120px">
              <div class="hcp-label">Color subtÃ­tulo</div>
              <div style="display:flex;gap:5px;align-items:center">
                <input type="color" id="hcpLogoSubColor" value="#7a7168" style="width:30px;height:30px;border:none;border-radius:5px;cursor:pointer">
                <input id="hcpLogoSubColorTxt" class="hcp-inp" value="#7a7168" style="flex:1" oninput="document.getElementById('hcpLogoSubColor').value=this.value">
              </div>
            </div>
            <div style="flex:1;min-width:120px">
              <div class="hcp-label">TamaÃ±o fuente</div>
              <select id="hcpLogoSize" class="hcp-inp">
                <option value="16px">16px</option><option value="18px">18px</option>
                <option value="20px" selected="">20px</option><option value="22px">22px</option>
                <option value="24px">24px</option><option value="28px">28px</option>
              </select>
            </div>
            <div style="flex:1;min-width:120px">
              <div class="hcp-label">Fuente</div>
              <select id="hcpLogoFont" class="hcp-inp">
                <option value="'Cormorant Garamond',serif" selected="">Cormorant</option>
                <option value="'DM Sans',sans-serif">DM Sans</option>
                <option value="Georgia,serif">Georgia</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Fondo del nav -->
        <div class="hcp-card">
          <div class="hcp-card-title">ðŸŽ¨ Fondo y borde del header</div>
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px">
            <div>
              <div class="hcp-label">Color fondo</div>
              <div style="display:flex;gap:5px;align-items:center">
                <input type="color" id="hcpNavBg" value="#f7f5f1" style="width:30px;height:30px;border:none;border-radius:5px;cursor:pointer">
                <input id="hcpNavBgTxt" class="hcp-inp" value="rgba(247,245,241,.95)" style="flex:1">
              </div>
            </div>
            <div>
              <div class="hcp-label">Color borde inferior</div>
              <div style="display:flex;gap:5px;align-items:center">
                <input type="color" id="hcpNavBorder" value="#e4ddd3" style="width:30px;height:30px;border:none;border-radius:5px;cursor:pointer">
                <input id="hcpNavBorderTxt" class="hcp-inp" value="#e4ddd3" style="flex:1">
              </div>
            </div>
            <div>
              <div class="hcp-label">Alto del header</div>
              <select id="hcpNavHeight" class="hcp-inp">
                <option value="56px">56px</option><option value="66px" selected="">66px</option>
                <option value="72px">72px</option><option value="80px">80px</option>
              </select>
            </div>
          </div>
          <!-- Paleta rÃ¡pida fondo -->
          <div style="margin-top:8px;display:flex;gap:5px;flex-wrap:wrap">
            <div onclick="document.getElementById('hcpNavBgTxt').value=this.dataset.v;document.getElementById('hcpNavBg').value='#f7f5f1'" data-v="rgba(247,245,241,.95)" style="width:28px;height:22px;background:#f7f5f1;border-radius:4px;cursor:pointer;border:1px solid rgba(255,255,255,.2)" title="Crema"></div>
            <div onclick="document.getElementById('hcpNavBgTxt').value=this.dataset.v" data-v="rgba(28,24,20,.96)" style="width:28px;height:22px;background:#1c1814;border-radius:4px;cursor:pointer;border:1px solid rgba(255,255,255,.2)" title="Negro"></div>
            <div onclick="document.getElementById('hcpNavBgTxt').value=this.dataset.v" data-v="rgba(43,125,122,.96)" style="width:28px;height:22px;background:#2b7d7a;border-radius:4px;cursor:pointer;border:1px solid rgba(255,255,255,.2)" title="Verde"></div>
            <div onclick="document.getElementById('hcpNavBgTxt').value=this.dataset.v" data-v="rgba(255,255,255,.97)" style="width:28px;height:22px;background:white;border-radius:4px;cursor:pointer;border:1px solid rgba(255,255,255,.2)" title="Blanco"></div>
            <div onclick="document.getElementById('hcpNavBgTxt').value=this.dataset.v" data-v="transparent" style="width:28px;height:22px;background:linear-gradient(135deg,#ccc 25%,transparent 25%,transparent 75%,#ccc 75%),linear-gradient(135deg,#ccc 25%,white 25%,white 75%,#ccc 75%);background-size:6px 6px;border-radius:4px;cursor:pointer;border:1px solid rgba(255,255,255,.2)" title="Transparente"></div>
          </div>
        </div>

        <!-- Nav links -->
        <div class="hcp-card">
          <div class="hcp-card-title">ðŸ”— Enlaces de navegaciÃ³n
            <button onclick="hcpAddLink()" class="hcp-btn-sm" style="margin-left:auto">+ AÃ±adir enlace</button>
          </div>
          <div id="hcpLinksList" style="display:flex;flex-direction:column;gap:6px"></div>
          <div style="margin-top:10px;padding:8px 10px;background:rgba(255,255,255,.04);border-radius:6px;font-size:10px;color:rgba(255,255,255,.35)">
            ðŸ’¡ Usa <code style="background:rgba(255,255,255,.08);padding:1px 4px;border-radius:3px">#id-seccion</code> para scroll o <code style="background:rgba(255,255,255,.08);padding:1px 4px;border-radius:3px">page:nombre</code> para ir a una pÃ¡gina custom
          </div>
        </div>

        <!-- Botones header -->
        <div class="hcp-card">
          <div class="hcp-card-title">ðŸ”˜ Botones del header</div>
          <div id="hcpBtnsList" style="display:flex;flex-direction:column;gap:8px"></div>
        </div>

        <button onclick="hcpApplyHeader()" class="hcp-apply-btn">âœ… Aplicar cambios al header</button>
      </div>

      <!-- â•â•â• TAB: CATEGORÃAS â•â•â• -->
      <div id="hcpSecCats" style="display:none">
        <div style="color:rgba(255,255,255,.5);font-size:10px;text-transform:uppercase;letter-spacing:.1em;margin-bottom:16px">Ãrbol de categorÃ­as y subcategorÃ­as hasta 3 niveles</div>

        <div class="hcp-card">
          <div class="hcp-card-title">ðŸ“‚ Ãrbol de categorÃ­as
            <button onclick="hcpAddCat(null,0)" class="hcp-btn-sm" style="margin-left:auto">+ CategorÃ­a raÃ­z</button>
          </div>
          <div id="hcpCatTree" style="display:flex;flex-direction:column;gap:3px"></div>
        </div>

        <!-- Editor de categorÃ­a -->
        <div id="hcpCatEditor" style="display:none" class="hcp-card">
          <div class="hcp-card-title" id="hcpCatEdTitle">âœï¸ Editar categorÃ­a</div>
          <input type="hidden" id="hcpCatEdId">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px">
            <div>
              <div class="hcp-label">Nombre</div>
              <input id="hcpCatEdName" class="hcp-inp" placeholder="Nombre de la categorÃ­a">
            </div>
            <div>
              <div class="hcp-label">Emoji / Icono</div>
              <input id="hcpCatEdIcon" class="hcp-inp" placeholder="ðŸ“‚ (opcional)">
            </div>
            <div>
              <div class="hcp-label">URL / Destino</div>
              <input id="hcpCatEdUrl" class="hcp-inp" placeholder="# o page:nombre o https://...">
            </div>
            <div>
              <div class="hcp-label">DescripciÃ³n corta</div>
              <input id="hcpCatEdDesc" class="hcp-inp" placeholder="DescripciÃ³n (opcional)">
            </div>
          </div>
          <div style="display:flex;gap:8px;align-items:center;margin-bottom:10px;flex-wrap:wrap">
            <label style="display:flex;align-items:center;gap:5px;font-size:11px;color:rgba(255,255,255,.6);cursor:pointer">
              <input type="checkbox" id="hcpCatEdVisible" checked=""> Visible en navegaciÃ³n
            </label>
            <label style="display:flex;align-items:center;gap:5px;font-size:11px;color:rgba(255,255,255,.6);cursor:pointer">
              <input type="checkbox" id="hcpCatEdOpenNew"> Abrir en nueva pestaÃ±a
            </label>
          </div>
          <div style="display:flex;gap:6px">
            <button onclick="hcpSaveCat()" class="hcp-apply-btn" style="flex:1">ðŸ’¾ Guardar categorÃ­a</button>
            <button onclick="document.getElementById('hcpCatEditor').style.display='none'" class="hcp-btn-sm">Cancelar</button>
          </div>
        </div>

        <div style="margin-top:16px;padding:12px 14px;background:rgba(184,149,88,.08);border:1px solid rgba(184,149,88,.2);border-radius:10px;font-size:11px;color:rgba(255,255,255,.5);line-height:1.6">
          <strong style="color:#b89558">ðŸ“‹ CÃ³mo usar:</strong><br>
          â€¢ <strong>Nivel 1</strong> â€” categorÃ­as principales â†’ aparecen en el menÃº principal<br>
          â€¢ <strong>Nivel 2</strong> â€” subcategorÃ­as â†’ desplegable al pasar el ratÃ³n<br>
          â€¢ <strong>Nivel 3</strong> â€” sub-subcategorÃ­as â†’ menÃº lateral o columna adicional<br>
          â€¢ Drag &amp; drop o usa las flechas para reordenar
        </div>
      </div>

      <!-- â•â•â• TAB: PÃGINAS â•â•â• -->
      <div id="hcpSecPages" style="display:none">
        <div style="color:rgba(255,255,255,.5);font-size:10px;text-transform:uppercase;letter-spacing:.1em;margin-bottom:16px">PÃ¡ginas/landings independientes â€” no aparecen en la navegaciÃ³n automÃ¡ticamente</div>

        <div class="hcp-card">
          <div class="hcp-card-title">ðŸ“„ PÃ¡ginas creadas
            <button onclick="hcpCreatePage()" class="hcp-btn-sm" style="margin-left:auto;background:rgba(43,125,122,.25);color:#3d9e9b;border-color:rgba(43,125,122,.4)">+ Nueva pÃ¡gina</button>
          </div>
          <div id="hcpPagesList" style="display:flex;flex-direction:column;gap:6px"></div>
          <div style="margin-top:10px;padding:10px;background:rgba(255,255,255,.03);border-radius:8px;font-size:10px;color:rgba(255,255,255,.3);line-height:1.7">
            ðŸ’¡ Las pÃ¡ginas creadas aquÃ­ son accesibles mediante <code style="background:rgba(255,255,255,.06);padding:1px 4px;border-radius:3px">goTo('page-slug')</code> o desde un enlace con <code style="background:rgba(255,255,255,.06);padding:1px 4px;border-radius:3px">page:slug</code>. No aparecen en el header salvo que las aÃ±adas manualmente como enlace.
          </div>
        </div>

        <!-- Editor de pÃ¡gina -->
        <div id="hcpPageEditor" style="display:none" class="hcp-card">
          <div class="hcp-card-title" id="hcpPageEdTitle">âœï¸ Nueva pÃ¡gina</div>
          <input type="hidden" id="hcpPageEdId">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px">
            <div>
              <div class="hcp-label">TÃ­tulo de la pÃ¡gina</div>
              <input id="hcpPageEdName" class="hcp-inp" placeholder="Ej: PolÃ­tica de privacidad">
            </div>
            <div>
              <div class="hcp-label">Slug / ID Ãºnico <span style="color:#bf4637">*</span></div>
              <input id="hcpPageEdSlug" class="hcp-inp" placeholder="privacy-policy (sin espacios)">
            </div>
          </div>
          <div style="margin-bottom:10px">
            <div class="hcp-label">DescripciÃ³n / Notas internas</div>
            <textarea id="hcpPageEdDesc" class="hcp-inp" rows="2" style="resize:vertical" placeholder="Para uso interno, no se muestra"></textarea>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px">
            <label style="display:flex;align-items:center;gap:5px;font-size:11px;color:rgba(255,255,255,.6);cursor:pointer">
              <input type="checkbox" id="hcpPageEdVisible"> Visible (activar pÃ¡gina)
            </label>
            <label style="display:flex;align-items:center;gap:5px;font-size:11px;color:rgba(255,255,255,.6);cursor:pointer">
              <input type="checkbox" id="hcpPageEdInNav"> AÃ±adir al menÃº de navegaciÃ³n
            </label>
          </div>
          <!-- Plantillas -->
          <div style="margin-bottom:12px">
            <div class="hcp-label">Plantilla inicial</div>
            <div style="display:flex;gap:6px;flex-wrap:wrap;margin-top:6px">
              <button onclick="hcpPageTpl('blank')" class="hcp-tpl-btn">â¬œ En blanco</button>
              <button onclick="hcpPageTpl('landing')" class="hcp-tpl-btn">ðŸš€ Landing</button>
              <button onclick="hcpPageTpl('legal')" class="hcp-tpl-btn">ðŸ“‹ Legal/Texto</button>
              <button onclick="hcpPageTpl('about')" class="hcp-tpl-btn">ðŸ‘¤ Sobre MÃ­</button>
              <button onclick="hcpPageTpl('contact')" class="hcp-tpl-btn">ðŸ“© Contacto</button>
              <button onclick="hcpPageTpl('thanks')" class="hcp-tpl-btn">ðŸ™ Gracias</button>
              <button onclick="hcpPageTpl('sales')" class="hcp-tpl-btn">ðŸ’° Ventas</button>
            </div>
          </div>
          <div style="display:flex;gap:6px">
            <button onclick="hcpSavePage()" class="hcp-apply-btn" style="flex:1">ðŸ’¾ Crear pÃ¡gina</button>
            <button onclick="document.getElementById('hcpPageEditor').style.display='none'" class="hcp-btn-sm">Cancelar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer del panel -->
    <div style="padding:12px 24px;border-top:1px solid rgba(255,255,255,.08);background:#1a1510;display:flex;align-items:center;justify-content:space-between;flex-shrink:0">
      <span id="hcpMsg" style="font-size:11px;color:#3d9e9b"></span>
      <button onclick="hcpClose()" style="background:rgba(255,255,255,.07);color:rgba(255,255,255,.45);border:none;padding:7px 16px;border-radius:7px;font-size:12px;cursor:pointer">Cerrar</button>
    </div>
  </div>
</div>

<!-- MENÃš DE NAVEGACIÃ“N CON DROPDOWNS (reemplaza nav-links) -->
<style>
/* â”€â”€ HCP Panel â”€â”€ */
.hcp-tab{background:none;border:none;color:rgba(255,255,255,.45);padding:12px 18px;font-size:12px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;border-bottom:2px solid transparent;transition:all .15s}
.hcp-tab:hover{color:rgba(255,255,255,.75)}
.hcp-tab.active{color:#3d9e9b;border-bottom-color:#3d9e9b}
.hcp-card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:14px 16px;margin-bottom:12px}
.hcp-card-title{font-size:11px;font-weight:700;color:rgba(255,255,255,.6);text-transform:uppercase;letter-spacing:.07em;margin-bottom:12px;display:flex;align-items:center;gap:8px}
.hcp-label{font-size:9px;text-transform:uppercase;letter-spacing:.07em;color:rgba(255,255,255,.35);margin-bottom:4px}
.hcp-inp{background:#1c1814;color:white;border:1px solid rgba(255,255,255,.12);padding:7px 10px;border-radius:7px;font-size:12px;font-family:'DM Sans',sans-serif;outline:none;width:100%;box-sizing:border-box}
.hcp-inp:focus{border-color:#3d9e9b}
.hcp-btn-sm{background:#252118;color:rgba(255,255,255,.6);border:1px solid rgba(255,255,255,.12);padding:5px 12px;border-radius:6px;font-size:11px;cursor:pointer;font-family:'DM Sans',sans-serif;white-space:nowrap}
.hcp-btn-sm:hover{background:#353028;color:white}
.hcp-apply-btn{background:#2b7d7a;color:white;border:none;padding:9px 20px;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;white-space:nowrap}
.hcp-apply-btn:hover{background:#3d9e9b}
.hcp-tpl-btn{background:#1c1814;color:rgba(255,255,255,.65);border:1px solid rgba(255,255,255,.12);padding:6px 12px;border-radius:6px;font-size:11px;cursor:pointer;font-family:'DM Sans',sans-serif}
.hcp-tpl-btn:hover{background:#2b7d7a;color:white;border-color:#2b7d7a}
/* Cat tree */
.hcp-cat-item{display:flex;align-items:center;gap:6px;padding:7px 10px;background:rgba(255,255,255,.04);border-radius:7px;border:1px solid rgba(255,255,255,.07);cursor:pointer;transition:background .12s}
.hcp-cat-item:hover{background:rgba(255,255,255,.08)}
.hcp-cat-l1{margin-left:0}
.hcp-cat-l2{margin-left:20px;border-left:2px solid rgba(43,125,122,.3)}
.hcp-cat-l3{margin-left:40px;border-left:2px solid rgba(184,149,88,.3)}
/* Link row editor */
.hcp-link-row{display:flex;align-items:center;gap:6px;padding:7px 10px;background:rgba(255,255,255,.04);border-radius:7px;border:1px solid rgba(255,255,255,.07)}
/* Nav dropdown */
.nav-links{position:relative}
.nav-links>a,.nav-links>.nav-dd-trigger{font-size:13px;color:#3d3730;text-decoration:none;cursor:pointer;display:flex;align-items:center;gap:4px;padding:4px 0;position:relative}
.nav-links>a:hover,.nav-links>.nav-dd-trigger:hover{color:#2b7d7a}
.nav-dd{position:absolute;top:calc(100% + 10px);left:50%;transform:translateX(-50%);background:white;border:1px solid #e4ddd3;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.12);min-width:200px;padding:6px;z-index:200;display:none;flex-direction:column;gap:2px}
.nav-dd-trigger:hover .nav-dd,.nav-dd:hover{display:flex}
.nav-dd-item{padding:8px 12px;border-radius:8px;font-size:13px;color:#3d3730;cursor:pointer;display:flex;align-items:center;gap:8px;text-decoration:none;position:relative}
.nav-dd-item:hover{background:#f0ece4;color:#2b7d7a}
.nav-dd-item.has-sub::after{content:'â€º';margin-left:auto;font-size:16px;color:#b8ad9e}
.nav-dd3{position:absolute;top:0;left:100%;margin-left:4px;background:white;border:1px solid #e4ddd3;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,.1);min-width:190px;padding:6px;z-index:201;display:none;flex-direction:column;gap:2px}
.nav-dd-item:hover .nav-dd3{display:flex}
</style>

<!-- EDITOR BUTTON -->
<!-- ZONA SECRETA: triple-clic esquina inferior izquierda activa el editor -->
<div id="edSecretZone" onclick="edSecretClick()" style="position:fixed;bottom:0;left:0;width:50px;height:50px;z-index:99998;cursor:default;-webkit-tap-highlight-color:transparent"></div>

<!-- MODAL CONTRASEÃ‘A EDITOR -->
<div id="edPwdModal" style="display: none; position: fixed; inset: 0px; z-index: 999999; background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(6px); align-items: center; justify-content: center;">
  <div style="background: rgb(28, 24, 20); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 16px; padding: 32px 36px; width: min(340px, 90vw); box-shadow: rgba(0, 0, 0, 0.7) 0px 20px 60px; font-family: &quot;DM Sans&quot;, sans-serif;" data-protonpass-form="">
    <div style="text-align:center;margin-bottom:22px">
      <div style="font-size:32px;margin-bottom:10px">ðŸ”</div>
      <div style="font-size:16px;font-weight:700;color:white">Acceso al Editor</div>
      <div style="font-size:12px;color:rgba(255,255,255,.35);margin-top:5px">Introduce la contraseÃ±a para editar</div>
    </div>
    <input id="edPwdInput" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="off" style="width: 100%; box-sizing: border-box; background: rgb(37, 33, 24); color: white; border: 1px solid rgba(255, 255, 255, 0.2); padding: 13px 14px; border-radius: 9px; font-size: 16px; font-family: &quot;DM Sans&quot;, sans-serif; outline: none; margin-bottom: 8px; text-align: center; letter-spacing: 0.15em;" onkeydown="if(event.key==='Enter')edPwdCheck()">
    <div id="edPwdErr" style="display: block; color: rgb(240, 128, 128); font-size: 11px; text-align: center; margin-bottom: 10px;">âŒ ContraseÃ±a incorrecta</div>
    <div style="display:flex;gap:8px;margin-top:4px">
      <button onclick="edPwdCheck()" style="flex:1;background:#2b7d7a;color:white;border:none;padding:12px;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif">Entrar</button>
      <button onclick="edPwdCancel()" style="background:rgba(255,255,255,.06);color:rgba(255,255,255,.4);border:1px solid rgba(255,255,255,.1);padding:12px 16px;border-radius:8px;font-size:13px;cursor:pointer">Cancelar</button>
    </div>
    <div style="margin-top:18px;padding-top:14px;border-top:1px solid rgba(255,255,255,.07);font-size:10px;color:rgba(255,255,255,.18);text-align:center;line-height:1.6">
      Los visitantes no ven esta pantalla ni saben que existe.
    </div>
  </div>
</div>

<!-- BOTÃ“N EDITOR (oculto â€” aparece solo tras contraseÃ±a correcta) -->
<button onclick="editorOpen()" id="edOpenBtn" style="position: fixed; bottom: 80px; left: 24px; z-index: 99999; background: rgb(28, 24, 20); color: white; border: 2px solid rgba(255, 255, 255, 0.2); padding: 10px 18px; border-radius: 100px; font-size: 12px; font-weight: 700; cursor: pointer; font-family: &quot;DM Sans&quot;, sans-serif; box-shadow: rgba(0, 0, 0, 0.5) 0px 4px 20px; display: none;" class="">âœï¸ Editor</button>

<!-- BOTÃ“N GESTOR (visible solo con editor abierto) -->
<button onclick="hcpOpen()" id="hcpOpenBtn" style="display:none;position:fixed;bottom:80px;left:130px;z-index:99999;background:#2b7d7a;color:white;border:2px solid rgba(255,255,255,.15);padding:10px 18px;border-radius:100px;font-size:12px;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;box-shadow:0 4px 20px rgba(0,0,0,.4)">ðŸ—‚ï¸ NavegaciÃ³n</button>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- BARRA FLOTANTE DE FORMATO (aparece al selec. texto) -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="edFmtBar" style="display: none; position: fixed; z-index: 10003; background: rgb(22, 18, 16); border: 1px solid rgba(255, 255, 255, 0.18); border-radius: 10px; padding: 5px 7px; gap: 2px; align-items: center; box-shadow: rgba(0, 0, 0, 0.7) 0px 6px 28px; flex-wrap: wrap; max-width: 600px; left: 118.438px; top: 2726.7px;" data-protonpass-form="">
  <!-- Formato bÃ¡sico -->
  <button onclick="edFmt('bold')" class="efb" title="Negrita Ctrl+B"><b>B</b></button>
  <button onclick="edFmt('italic')" class="efb" title="Cursiva Ctrl+I"><i style="font-style:italic">I</i></button>
  <button onclick="edFmt('underline')" class="efb" title="Subrayado" style="text-decoration:underline">U</button>
  <button onclick="edFmt('strikeThrough')" class="efb" title="Tachado" style="text-decoration:line-through">S</button>
  <div class="efbsep"></div>
  <!-- AlineaciÃ³n -->
  <button onclick="edFmt('justifyLeft')" class="efb" title="Izquierda">â‰¡â¬›</button>
  <button onclick="edFmt('justifyCenter')" class="efb" title="Centrar">â¬›â‰¡</button>
  <button onclick="edFmt('justifyRight')" class="efb" title="Derecha">â‰¡â¬›</button>
  <div class="efbsep"></div>
  <!-- Encabezados -->
  <button onclick="edFmtBlock('h1')" class="efb efb-lbl" title="TÃ­tulo H1">H1</button>
  <button onclick="edFmtBlock('h2')" class="efb efb-lbl" title="TÃ­tulo H2">H2</button>
  <button onclick="edFmtBlock('h3')" class="efb efb-lbl" title="TÃ­tulo H3">H3</button>
  <button onclick="edFmtBlock('p')" class="efb efb-lbl" title="PÃ¡rrafo">P</button>
  <div class="efbsep"></div>
  <!-- Listas -->
  <button onclick="edFmt('insertUnorderedList')" class="efb" title="Lista viÃ±etas">â€¢â‰¡</button>
  <button onclick="edFmt('insertOrderedList')" class="efb" title="Lista numerada">1.â‰¡</button>
  <div class="efbsep"></div>
  <!-- Color texto inline -->
  <div style="display:flex;align-items:center;gap:3px">
    <span style="font-size:9px;color:rgba(255,255,255,.4)">A</span>
    <input type="color" id="efbTxtColor" value="#1c1814" style="width:22px;height:22px;border:none;border-radius:3px;cursor:pointer;padding:0" onchange="edApplyFontColor(this.value)" title="Color texto">
  </div>
  <!-- Resaltar -->
  <div style="display:flex;align-items:center;gap:3px">
    <span style="font-size:9px;color:rgba(255,255,255,.4)">â–“</span>
    <input type="color" id="efbHlColor" value="#fff9c4" style="width:22px;height:22px;border:none;border-radius:3px;cursor:pointer;padding:0" onchange="edFmtHighlight(this.value)" title="Resaltar texto">
  </div>
  <div class="efbsep"></div>
  <!-- TamaÃ±o inline -->
  <select onchange="if(this.value){edApplyFontSize(this.value);this.value=''}" style="background:#2a2420;color:white;border:1px solid rgba(255,255,255,.15);padding:2px 3px;border-radius:5px;font-size:10px;cursor:pointer;max-width:52px" title="TamaÃ±o texto">
    <option value="">px</option>
    <option value="10px">10</option><option value="11px">11</option><option value="12px">12</option>
    <option value="13px">13</option><option value="14px">14</option><option value="15px">15</option>
    <option value="16px">16</option><option value="18px">18</option><option value="20px">20</option>
    <option value="22px">22</option><option value="24px">24</option><option value="28px">28</option>
    <option value="32px">32</option><option value="36px">36</option><option value="40px">40</option>
    <option value="48px">48</option><option value="56px">56</option><option value="64px">64</option>
    <option value="72px">72</option><option value="80px">80</option><option value="96px">96</option>
  </select>
  <input type="number" min="8" max="200" placeholder="px" title="Tam. libre" style="width:38px;background:#2a2420;color:white;border:1px solid rgba(255,255,255,.15);padding:2px 4px;border-radius:5px;font-size:10px;outline:none" onkeydown="if(event.key==='Enter'&amp;&amp;this.value){edApplyFontSize(this.value+'px');this.value=''}">
  <div class="efbsep"></div>
  <!-- TipografÃ­a inline -->
  <select onchange="if(this.value){edApplyFontInline(this.value);this.value=''}" style="background:#2a2420;color:white;border:1px solid rgba(255,255,255,.15);padding:2px 3px;border-radius:5px;font-size:10px;cursor:pointer;max-width:80px">
    <option value="">Font</option>
    <option value="'DM Sans',sans-serif">DM Sans</option>
    <option value="'Cormorant Garamond',serif">Cormorant</option>
    <option value="Georgia,serif">Georgia</option>
    <option value="Arial,sans-serif">Arial</option>
    <option value="'Helvetica Neue',sans-serif">Helvetica</option>
    <option value="'Times New Roman',serif">Times NR</option>
    <option value="'Courier New',monospace">Courier</option>
  </select>
  <div class="efbsep"></div>
  <!-- Superscript / Subscript -->
  <button onclick="edFmt('superscript')" class="efb" title="SuperÃ­ndice" style="font-size:9px">XÂ²</button>
  <button onclick="edFmt('subscript')" class="efb" title="SubÃ­ndice" style="font-size:9px">Xâ‚‚</button>
  <!-- Link -->
  <button onclick="edAddLink()" class="efb" title="Enlace">ðŸ”—</button>
  <!-- Cerrar -->
  <button onclick="edFmtBarHide()" style="background:none;border:none;color:rgba(255,255,255,.3);font-size:13px;cursor:pointer;padding:1px 5px;margin-left:2px;line-height:1">âœ•</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- PANEL LATERAL DE PROPIEDADES                       -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="edPropsPanel" style="display: none; position: fixed; right: 0px; top: 0px; bottom: 0px; z-index: 9996; width: 268px; background: rgb(22, 18, 16); border-left: 1px solid rgba(255, 255, 255, 0.1); overflow-y: auto; font-family: &quot;DM Sans&quot;, sans-serif; padding-bottom: 120px;" data-protonpass-form="">

  <!-- Header -->
  <div style="position:sticky;top:0;z-index:2;background:#161210;padding:10px 14px 8px;border-bottom:1px solid rgba(255,255,255,.1);display:flex;align-items:center;justify-content:space-between">
    <span style="font-size:11px;font-weight:700;color:#3d9e9b;letter-spacing:.08em">âš™ PROPIEDADES</span>
    <div style="display:flex;align-items:center;gap:6px">
      <code id="edPropsTag" style="font-size:9px;color:rgba(255,255,255,.3);background:rgba(255,255,255,.06);padding:2px 5px;border-radius:3px">&lt;div&gt;</code>
      <button onclick="edCloseProps()" style="background:none;border:none;color:rgba(255,255,255,.3);font-size:14px;cursor:pointer;padding:0 2px">âœ•</button>
    </div>
  </div>

  <!-- SECCIÃ“N: TAMAÃ‘O -->
  <div class="epp-sec">
    <div class="epp-lbl">ðŸ“ TamaÃ±o del contenedor</div>
    <div class="epp-grid2">
      <div><div class="epp-sub">Ancho (W)</div>
        <input id="prpW" type="text" placeholder="auto" class="epp-inp" oninput="edPropLive('width',this.value)" title="px / % / auto / vw"></div>
      <div><div class="epp-sub">Alto (H)</div>
        <input id="prpH" type="text" placeholder="auto" class="epp-inp" oninput="edPropLive('height',this.value)" title="px / vh / auto"></div>
      <div><div class="epp-sub">MÃ¡x. ancho</div>
        <input id="prpMW" type="text" placeholder="none" class="epp-inp" oninput="edPropLive('maxWidth',this.value)"></div>
      <div><div class="epp-sub">MÃ­n. alto</div>
        <input id="prpMH" type="text" placeholder="auto" class="epp-inp" oninput="edPropLive('minHeight',this.value)"></div>
    </div>
    <!-- Presets ancho rÃ¡pido -->
    <div style="display:flex;gap:3px;flex-wrap:wrap;margin-top:5px">
      <button onclick="edPropQ('width','100%')" class="epp-chip">100%</button>
      <button onclick="edPropQ('maxWidth','1200px')" class="epp-chip">1200px</button>
      <button onclick="edPropQ('maxWidth','900px')" class="epp-chip">900px</button>
      <button onclick="edPropQ('maxWidth','700px')" class="epp-chip">700px</button>
      <button onclick="edPropQ('maxWidth','500px')" class="epp-chip">500px</button>
      <button onclick="edPropQ('margin','0 auto')" class="epp-chip" style="color:#3d9e9b">â†” Centrar</button>
    </div>
  </div>

  <!-- SECCIÃ“N: PADDING -->
  <div class="epp-sec">
    <div class="epp-lbl">â†” Espaciado interno (padding)</div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:4px;margin-bottom:6px">
      <div><div class="epp-sub">â†‘ Top</div><input id="prpPT" type="text" placeholder="0" class="epp-inp" oninput="edPropLive('paddingTop',this.value)"></div>
      <div><div class="epp-sub">â†“ Bot</div><input id="prpPB" type="text" placeholder="0" class="epp-inp" oninput="edPropLive('paddingBottom',this.value)"></div>
      <div><div class="epp-sub">â† Izq</div><input id="prpPL" type="text" placeholder="0" class="epp-inp" oninput="edPropLive('paddingLeft',this.value)"></div>
      <div><div class="epp-sub">â†’ Der</div><input id="prpPR" type="text" placeholder="0" class="epp-inp" oninput="edPropLive('paddingRight',this.value)"></div>
    </div>
    <div style="display:flex;gap:3px;flex-wrap:wrap">
      <button onclick="edPropQ('padding','8px')" class="epp-chip">8px</button>
      <button onclick="edPropQ('padding','16px')" class="epp-chip">16px</button>
      <button onclick="edPropQ('padding','24px')" class="epp-chip">24px</button>
      <button onclick="edPropQ('padding','32px')" class="epp-chip">32px</button>
      <button onclick="edPropQ('padding','40px')" class="epp-chip">40px</button>
      <button onclick="edPropQ('padding','48px 64px')" class="epp-chip">48Ã—64</button>
      <button onclick="edPropQ('padding','80px 40px')" class="epp-chip">80Ã—40</button>
    </div>
  </div>

  <!-- SECCIÃ“N: FONDO -->
  <div class="epp-sec">
    <div class="epp-lbl">ðŸŽ¨ Color de fondo</div>
    <!-- Picker + hex -->
    <div style="display:flex;gap:6px;align-items:center;margin-bottom:8px">
      <input type="color" id="prpBgPk" value="#f7f5f1" style="width:36px;height:36px;border:none;border-radius:6px;cursor:pointer;padding:0;flex-shrink:0" onchange="edPropBg(this.value)">
      <input id="prpBgHex" type="text" placeholder="#rrggbb / transparent" class="epp-inp" style="flex:1" onchange="edPropBg(this.value)" oninput="edPropBgInput(this.value)">
      <button onclick="edPropBg('transparent')" class="epp-xbtn" title="Sin fondo">âˆ…</button>
    </div>
    <!-- Paleta rÃ¡pida -->
    <div style="display:flex;gap:4px;flex-wrap:wrap;margin-bottom:6px">
      <div onclick="edPropBg('#ffffff')" class="epp-sw" style="background:#fff;border-color:#ccc" title="Blanco"></div>
      <div onclick="edPropBg('#f7f5f1')" class="epp-sw" style="background:#f7f5f1" title="Crema claro"></div>
      <div onclick="edPropBg('#f0ece4')" class="epp-sw" style="background:#f0ece4" title="Crema"></div>
      <div onclick="edPropBg('#e8e3d8')" class="epp-sw" style="background:#e8e3d8" title="Arena"></div>
      <div onclick="edPropBg('#d4cfc6')" class="epp-sw" style="background:#d4cfc6" title="Gris arena"></div>
      <div onclick="edPropBg('#1c1814')" class="epp-sw" style="background:#1c1814" title="Negro TCT"></div>
      <div onclick="edPropBg('#2a241e')" class="epp-sw" style="background:#2a241e" title="Oscuro"></div>
      <div onclick="edPropBg('#3d3028')" class="epp-sw" style="background:#3d3028" title="MarrÃ³n oscuro"></div>
      <div onclick="edPropBg('#2b7d7a')" class="epp-sw" style="background:#2b7d7a" title="Verde TCT"></div>
      <div onclick="edPropBg('#3d9e9b')" class="epp-sw" style="background:#3d9e9b" title="Verde claro"></div>
      <div onclick="edPropBg('#e8f4f3')" class="epp-sw" style="background:#e8f4f3" title="Verde muy claro"></div>
      <div onclick="edPropBg('#1c5a58')" class="epp-sw" style="background:#1c5a58" title="Verde oscuro"></div>
      <div onclick="edPropBg('#b89558')" class="epp-sw" style="background:#b89558" title="Oro TCT"></div>
      <div onclick="edPropBg('#d4b878')" class="epp-sw" style="background:#d4b878" title="Oro claro"></div>
      <div onclick="edPropBg('#fdf6e3')" class="epp-sw" style="background:#fdf6e3" title="Oro muy claro"></div>
      <div onclick="edPropBg('#bf4637')" class="epp-sw" style="background:#bf4637" title="Rojo Puerta"></div>
      <div onclick="edPropBg('#fdecea')" class="epp-sw" style="background:#fdecea" title="Rojo muy claro"></div>
      <div onclick="edPropBg('#2c5f9e')" class="epp-sw" style="background:#2c5f9e" title="Azul Puerta"></div>
      <div onclick="edPropBg('#e8eef7')" class="epp-sw" style="background:#e8eef7" title="Azul muy claro"></div>
      <div onclick="edPropBg('#7b4fa6')" class="epp-sw" style="background:#7b4fa6" title="Violeta"></div>
    </div>
    <!-- Gradientes predefinidos -->
    <div class="epp-sub" style="margin-bottom:4px">Gradientes rÃ¡pidos</div>
    <div style="display:flex;gap:4px;flex-wrap:wrap;margin-bottom:6px">
      <div onclick="edPropBg('linear-gradient(135deg,#f7f5f1,#e8e3d8)')" class="epp-grad" style="background:linear-gradient(135deg,#f7f5f1,#e8e3d8)" title="Crema"></div>
      <div onclick="edPropBg('linear-gradient(135deg,#2b7d7a,#1c5a58)')" class="epp-grad" style="background:linear-gradient(135deg,#2b7d7a,#1c5a58)" title="Verde"></div>
      <div onclick="edPropBg('linear-gradient(135deg,#1c1814,#3d3028)')" class="epp-grad" style="background:linear-gradient(135deg,#1c1814,#3d3028)" title="Oscuro"></div>
      <div onclick="edPropBg('linear-gradient(135deg,#b89558,#8a6a35)')" class="epp-grad" style="background:linear-gradient(135deg,#b89558,#8a6a35)" title="Oro"></div>
      <div onclick="edPropBg('linear-gradient(135deg,#2c5f9e,#1a3d6e)')" class="epp-grad" style="background:linear-gradient(135deg,#2c5f9e,#1a3d6e)" title="Azul"></div>
      <div onclick="edPropBg('linear-gradient(135deg,#bf4637,#8b2d22)')" class="epp-grad" style="background:linear-gradient(135deg,#bf4637,#8b2d22)" title="Rojo"></div>
      <div onclick="edPropBg('linear-gradient(135deg,#7b4fa6,#4a2d6e)')" class="epp-grad" style="background:linear-gradient(135deg,#7b4fa6,#4a2d6e)" title="Violeta"></div>
      <div onclick="edPropBg('linear-gradient(160deg,#2b7d7a 0%,#1c1814 100%)')" class="epp-grad" style="background:linear-gradient(160deg,#2b7d7a,#1c1814)" title="Verde â†’ Negro"></div>
    </div>
    <!-- Gradiente personalizado -->
    <div class="epp-sub" style="margin-bottom:4px">Crear gradiente</div>
    <div style="display:flex;gap:5px;align-items:center">
      <input type="color" id="prpG1" value="#2b7d7a" style="width:28px;height:28px;border:none;border-radius:5px;cursor:pointer;padding:0" onchange="edBuildGrad()">
      <input type="color" id="prpG2" value="#f0ece4" style="width:28px;height:28px;border:none;border-radius:5px;cursor:pointer;padding:0" onchange="edBuildGrad()">
      <select id="prpGDir" onchange="edBuildGrad()" style="flex:1;background:#2a2420;color:white;border:1px solid rgba(255,255,255,.15);padding:3px;border-radius:5px;font-size:10px">
        <option value="135deg">â†˜ Diagonal</option><option value="to right">â†’ Horizontal</option>
        <option value="to bottom">â†“ Vertical</option><option value="45deg">â†— Diagonal 2</option>
        <option value="180deg">â†‘ Vertical inv.</option>
      </select>
      <div id="prpGPreview" style="width:36px;height:28px;border-radius:5px;border:1px solid rgba(255,255,255,.1);background:linear-gradient(135deg,#2b7d7a,#f0ece4);cursor:pointer" onclick="edBuildGrad(true)" title="Aplicar"></div>
    </div>
  </div>

  <!-- SECCIÃ“N: COLOR TEXTO -->
  <div class="epp-sec">
    <div class="epp-lbl">âœï¸ Color de texto del bloque</div>
    <div style="display:flex;gap:6px;align-items:center;margin-bottom:8px">
      <input type="color" id="prpTxtPk" value="#1c1814" style="width:36px;height:36px;border:none;border-radius:6px;cursor:pointer;padding:0;flex-shrink:0" onchange="edPropTxtColor(this.value)">
      <input id="prpTxtHex" type="text" placeholder="#1c1814" class="epp-inp" style="flex:1" onchange="edPropTxtColor(this.value)">
    </div>
    <div style="display:flex;gap:4px;flex-wrap:wrap">
      <div onclick="edPropTxtColor('#1c1814')" class="epp-sw" style="background:#1c1814" title="Negro TCT"></div>
      <div onclick="edPropTxtColor('#ffffff')" class="epp-sw" style="background:#fff;border-color:#ccc" title="Blanco"></div>
      <div onclick="edPropTxtColor('#7a7168')" class="epp-sw" style="background:#7a7168" title="Gris TCT"></div>
      <div onclick="edPropTxtColor('#5a5248')" class="epp-sw" style="background:#5a5248" title="Gris oscuro"></div>
      <div onclick="edPropTxtColor('#2b7d7a')" class="epp-sw" style="background:#2b7d7a" title="Verde TCT"></div>
      <div onclick="edPropTxtColor('#3d9e9b')" class="epp-sw" style="background:#3d9e9b" title="Verde claro"></div>
      <div onclick="edPropTxtColor('#b89558')" class="epp-sw" style="background:#b89558" title="Oro TCT"></div>
      <div onclick="edPropTxtColor('#bf4637')" class="epp-sw" style="background:#bf4637" title="Rojo Puerta"></div>
      <div onclick="edPropTxtColor('#2c5f9e')" class="epp-sw" style="background:#2c5f9e" title="Azul Puerta"></div>
      <div onclick="edPropTxtColor('#7b4fa6')" class="epp-sw" style="background:#7b4fa6" title="Violeta"></div>
    </div>
  </div>

  <!-- SECCIÃ“N: TIPOGRAFÃA DEL BLOQUE -->
  <div class="epp-sec">
    <div class="epp-lbl">ðŸ”¤ TipografÃ­a del bloque</div>
    <select onchange="if(this.value){edPropQ('fontFamily',this.value);this.value=''}" class="epp-inp" style="width:100%;margin-bottom:6px">
      <option value="">â€” Fuente del contenedor â€”</option>
      <option value="'DM Sans',sans-serif">DM Sans (principal)</option>
      <option value="'Cormorant Garamond',serif">Cormorant Garamond (tÃ­tulos)</option>
      <option value="Georgia,serif">Georgia</option>
      <option value="Arial,sans-serif">Arial</option>
      <option value="'Helvetica Neue',sans-serif">Helvetica Neue</option>
      <option value="'Times New Roman',serif">Times New Roman</option>
      <option value="'Courier New',monospace">Courier New</option>
    </select>
    <div class="epp-grid2">
      <div><div class="epp-sub">TamaÃ±o</div>
        <input id="prpFS" type="text" placeholder="16px" class="epp-inp" oninput="edPropLive('fontSize',this.value)"></div>
      <div><div class="epp-sub">Grosor</div>
        <select onchange="edPropQ('fontWeight',this.value)" class="epp-inp">
          <option value="">â€”</option>
          <option value="300">300 Fino</option><option value="400">400 Normal</option>
          <option value="500">500 Medio</option><option value="600">600 Semi</option>
          <option value="700">700 Bold</option><option value="800">800 Extra</option>
        </select></div>
      <div><div class="epp-sub">Interlineado</div>
        <input id="prpLH" type="text" placeholder="1.6" class="epp-inp" oninput="edPropLive('lineHeight',this.value)"></div>
      <div><div class="epp-sub">AlineaciÃ³n</div>
        <select onchange="edPropQ('textAlign',this.value)" class="epp-inp">
          <option value="">â€”</option><option value="left">Izquierda</option>
          <option value="center">Centro</option><option value="right">Derecha</option>
          <option value="justify">Justificado</option>
        </select></div>
      <div><div class="epp-sub">Letra espac.</div>
        <input type="text" placeholder="0em" class="epp-inp" oninput="edPropLive('letterSpacing',this.value)"></div>
      <div><div class="epp-sub">Transformar</div>
        <select onchange="edPropQ('textTransform',this.value)" class="epp-inp">
          <option value="">â€”</option><option value="uppercase">MAYÃšS</option>
          <option value="lowercase">minÃºs</option><option value="capitalize">Primer</option>
          <option value="none">Normal</option>
        </select></div>
    </div>
  </div>

  <!-- SECCIÃ“N: BORDE -->
  <div class="epp-sec">
    <div class="epp-lbl">ðŸ”² Borde</div>
    <div style="display:flex;gap:5px;align-items:center;margin-bottom:7px">
      <input type="color" id="prpBdPk" value="#e4ddd3" style="width:30px;height:30px;border:none;border-radius:5px;cursor:pointer;padding:0;flex-shrink:0" onchange="edPropBorder(this.value)">
      <input id="prpBdHex" type="text" placeholder="#e4ddd3" class="epp-inp" style="flex:1" onchange="edPropBorder(this.value)">
      <button onclick="edPropQ('border','none')" class="epp-xbtn" title="Sin borde">âˆ…</button>
    </div>
    <!-- Paleta borde -->
    <div style="display:flex;gap:3px;flex-wrap:wrap;margin-bottom:7px">
      <div onclick="edPropBorder('#e4ddd3')" class="epp-sw" style="background:#e4ddd3" title="Crema borde"></div>
      <div onclick="edPropBorder('#d4cfc6')" class="epp-sw" style="background:#d4cfc6" title="Arena"></div>
      <div onclick="edPropBorder('#2b7d7a')" class="epp-sw" style="background:#2b7d7a" title="Verde TCT"></div>
      <div onclick="edPropBorder('#3d9e9b')" class="epp-sw" style="background:#3d9e9b" title="Verde claro"></div>
      <div onclick="edPropBorder('#b89558')" class="epp-sw" style="background:#b89558" title="Oro TCT"></div>
      <div onclick="edPropBorder('#bf4637')" class="epp-sw" style="background:#bf4637" title="Rojo"></div>
      <div onclick="edPropBorder('#2c5f9e')" class="epp-sw" style="background:#2c5f9e" title="Azul"></div>
      <div onclick="edPropBorder('#1c1814')" class="epp-sw" style="background:#1c1814" title="Negro"></div>
    </div>
    <div class="epp-grid2">
      <div><div class="epp-sub">Grosor</div>
        <select id="prpBdW" onchange="edPropBorderW(this.value)" class="epp-inp">
          <option value="1px">1px</option><option value="2px">2px</option>
          <option value="3px">3px</option><option value="4px">4px</option>
          <option value="6px">6px</option>
        </select></div>
      <div><div class="epp-sub">Estilo</div>
        <select id="prpBdSt" onchange="edPropBorderSt(this.value)" class="epp-inp">
          <option value="solid">SÃ³lido</option><option value="dashed">Guiones</option>
          <option value="dotted">Puntos</option><option value="double">Doble</option>
        </select></div>
      <div><div class="epp-sub">Radio (redondeado)</div>
        <input id="prpBR" type="text" placeholder="0px" class="epp-inp" oninput="edPropLive('borderRadius',this.value)"></div>
      <div style="display:flex;flex-direction:column;gap:3px;margin-top:14px">
        <button onclick="edPropQ('borderRadius','8px')" class="epp-chip">8px</button>
        <button onclick="edPropQ('borderRadius','16px')" class="epp-chip">16px</button>
        <button onclick="edPropQ('borderRadius','24px')" class="epp-chip">24px</button>
        <button onclick="edPropQ('borderRadius','50%')" class="epp-chip">50% â—</button>
      </div>
    </div>
  </div>

  <!-- SECCIÃ“N: SOMBRA -->
  <div class="epp-sec">
    <div class="epp-lbl">ðŸŒ‘ Sombra</div>
    <div style="display:flex;flex-direction:column;gap:3px">
      <button onclick="edPropQ('boxShadow','none')" class="epp-rowbtn">Sin sombra</button>
      <button onclick="edPropQ('boxShadow','0 1px 4px rgba(0,0,0,.06)')" class="epp-rowbtn">Muy sutil</button>
      <button onclick="edPropQ('boxShadow','0 2px 10px rgba(0,0,0,.08)')" class="epp-rowbtn">Sutil</button>
      <button onclick="edPropQ('boxShadow','0 4px 20px rgba(0,0,0,.12)')" class="epp-rowbtn">Media</button>
      <button onclick="edPropQ('boxShadow','0 8px 32px rgba(0,0,0,.18)')" class="epp-rowbtn">Fuerte</button>
      <button onclick="edPropQ('boxShadow','0 16px 48px rgba(0,0,0,.28)')" class="epp-rowbtn">Muy fuerte</button>
      <button onclick="edPropQ('boxShadow','0 8px 32px rgba(43,125,122,.22)')" class="epp-rowbtn" style="color:#3d9e9b">âœ¦ Sombra verde TCT</button>
      <button onclick="edPropQ('boxShadow','0 8px 32px rgba(184,149,88,.28)')" class="epp-rowbtn" style="color:#b89558">âœ¦ Sombra oro TCT</button>
      <button onclick="edPropQ('boxShadow','0 8px 32px rgba(191,70,55,.2)')" class="epp-rowbtn" style="color:#bf4637">âœ¦ Sombra roja</button>
      <button onclick="edPropQ('boxShadow','inset 0 0 40px rgba(0,0,0,.08)')" class="epp-rowbtn">Interna sutil</button>
    </div>
  </div>

  <!-- SECCIÃ“N: MARGEN / POSICIÃ“N -->
  <div class="epp-sec">
    <div class="epp-lbl">â†” Margen externo</div>
    <div class="epp-grid2">
      <div><div class="epp-sub">Top</div><input type="text" placeholder="0" class="epp-inp" oninput="edPropLive('marginTop',this.value)"></div>
      <div><div class="epp-sub">Bottom</div><input type="text" placeholder="0" class="epp-inp" oninput="edPropLive('marginBottom',this.value)"></div>
    </div>
    <div style="margin-top:5px;display:flex;gap:3px;flex-wrap:wrap">
      <button onclick="edPropQ('margin','0 auto')" class="epp-chip" style="color:#3d9e9b">â†” Centrar</button>
      <button onclick="edPropQ('marginBottom','24px')" class="epp-chip">â†“ 24px</button>
      <button onclick="edPropQ('marginBottom','40px')" class="epp-chip">â†“ 40px</button>
      <button onclick="edPropQ('marginBottom','60px')" class="epp-chip">â†“ 60px</button>
      <button onclick="edPropQ('marginTop','40px')" class="epp-chip">â†‘ 40px</button>
    </div>
  </div>

  <!-- SECCIÃ“N: DISPLAY / FLEX -->
  <div class="epp-sec">
    <div class="epp-lbl">âŠž Display / Layout</div>
    <div style="display:flex;gap:3px;flex-wrap:wrap">
      <button onclick="edPropQ('display','block')" class="epp-chip">Block</button>
      <button onclick="edPropQ('display','flex')" class="epp-chip">Flex</button>
      <button onclick="edPropQ('display','grid')" class="epp-chip">Grid</button>
      <button onclick="edPropQ('display','inline-block')" class="epp-chip">Inline-block</button>
      <button onclick="edPropQ('display','none')" class="epp-chip" style="color:#f08080">Ocultar</button>
    </div>
    <div style="margin-top:5px;display:flex;gap:3px;flex-wrap:wrap">
      <button onclick="edPropQ('alignItems','center')" class="epp-chip">Align: centro</button>
      <button onclick="edPropQ('justifyContent','center')" class="epp-chip">Justify: centro</button>
      <button onclick="edPropQ('flexDirection','column')" class="epp-chip">Col â†“</button>
      <button onclick="edPropQ('flexWrap','wrap')" class="epp-chip">Wrap</button>
      <button onclick="edPropQ('gap','16px')" class="epp-chip">Gap 16px</button>
      <button onclick="edPropQ('gap','24px')" class="epp-chip">Gap 24px</button>
    </div>
  </div>

  <!-- SECCIÃ“N: OPACIDAD / OVERFLOW -->
  <div class="epp-sec">
    <div class="epp-lbl">ðŸ”† Opacidad / Overflow</div>
    <div class="epp-grid2">
      <div><div class="epp-sub">Opacidad (0â€“1)</div>
        <input type="range" min="0" max="1" step="0.05" value="1" style="width:100%" oninput="edPropLive('opacity',this.value);this.nextElementSibling.textContent=this.value">
        <span style="font-size:10px;color:rgba(255,255,255,.4)">1</span></div>
      <div><div class="epp-sub">Overflow</div>
        <select onchange="edPropQ('overflow',this.value)" class="epp-inp">
          <option value="">â€”</option><option value="visible">Visible</option>
          <option value="hidden">Hidden</option><option value="auto">Auto</option>
          <option value="scroll">Scroll</option>
        </select></div>
    </div>
  </div>

  <!-- SECCIÃ“N: CSS DIRECTO -->
  <div class="epp-sec">
    <div class="epp-lbl">ðŸ’» CSS directo (style="")</div>
    <textarea id="prpCss" rows="5" class="epp-css" placeholder="padding:32px; background:white; border:1px solid #ccc; ..."></textarea>
    <div style="display:flex;gap:5px;margin-top:5px">
      <button onclick="edPropCssApply()" class="epp-rowbtn" style="flex:1;color:#3d9e9b;border-color:rgba(61,158,155,.3)">â–¶ Aplicar CSS</button>
      <button onclick="edPropCssRead()" class="epp-rowbtn" title="Leer estilos actuales del elemento">â†» Leer</button>
    </div>
  </div>

  <!-- ACCIONES RÃPIDAS -->
  <div class="epp-sec">
    <div class="epp-lbl">âš¡ Acciones</div>
    <div style="display:flex;flex-direction:column;gap:4px">
      <button onclick="edDuplicate()" class="epp-rowbtn">ðŸ“‹ Duplicar elemento</button>
      <button onclick="edMoveUp()" class="epp-rowbtn">â¬†ï¸ Mover arriba</button>
      <button onclick="edMoveDown()" class="epp-rowbtn">â¬‡ï¸ Mover abajo</button>
      <button onclick="edAddLink()" class="epp-rowbtn">ðŸ”— AÃ±adir enlace</button>
      <button onclick="edChangeImage()" class="epp-rowbtn">ðŸ–¼ï¸ Cambiar imagen</button>
      <button onclick="edDeleteSelected()" class="epp-rowbtn" style="color:#f08080;border-color:rgba(191,70,55,.25)">ðŸ—‘ï¸ Eliminar elemento</button>
    </div>
  </div>
</div>

<!-- CONTEXT MENU -->
<div id="edCtxMenu" style="display: none; position: fixed; z-index: 10001; background: rgb(22, 18, 16); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 10px; padding: 6px; min-width: 188px; box-shadow: rgba(0, 0, 0, 0.6) 0px 8px 32px; font-family: &quot;DM Sans&quot;, sans-serif; left: 1024px; top: 373px;">
  <div id="edCtxTitle" style="font-size:9px;color:rgba(255,255,255,.4);padding:4px 10px 7px;border-bottom:1px solid rgba(255,255,255,.1);margin-bottom:4px;text-transform:uppercase;letter-spacing:.07em">p</div>
  <button onclick="edCtxAction('props')" class="edctx-btn">âš™ï¸ Propiedades del bloque</button>
  <button onclick="edCtxAction('editar')" class="edctx-btn">âœï¸ Editar textos internos</button>
  <button onclick="edCtxAction('link')" class="edctx-btn">ðŸ”— AÃ±adir enlace</button>
  <button onclick="edCtxAction('imagen')" class="edctx-btn">ðŸ–¼ï¸ Cambiar imagen</button>
  <button onclick="edCtxAction('duplicar')" class="edctx-btn">ðŸ“‹ Duplicar</button>
  <button onclick="edCtxAction('subir')" class="edctx-btn">â¬†ï¸ Mover arriba</button>
  <button onclick="edCtxAction('bajar')" class="edctx-btn">â¬‡ï¸ Mover abajo</button>
  <div style="height:1px;background:rgba(255,255,255,.1);margin:4px 0"></div>
  <button onclick="edCtxAction('eliminar')" class="edctx-btn" style="color:#f08080">ðŸ—‘ï¸ Eliminar</button>
  <button onclick="edCtxClose()" class="edctx-btn" style="color:rgba(255,255,255,.35)">âœ• Cerrar menÃº</button>
</div>

<!-- EDITOR PANEL -->
<div id="edPanel" style="display: none; position: fixed; bottom: 0px; left: 0px; right: 0px; z-index: 9998; background: rgb(22, 18, 16); padding: 7px 12px; align-items: center; gap: 6px; flex-wrap: wrap; box-shadow: rgba(0, 0, 0, 0.6) 0px -4px 24px; font-family: &quot;DM Sans&quot;, sans-serif;" data-protonpass-form="">
  <span style="font-size:12px;font-weight:700;color:#3d9e9b;white-space:nowrap">âœ¦ Editor</span>
  <div class="eds"></div>
  <!-- Historial -->
  <button onclick="edUndo()" id="edUndoBtn" title="Deshacer Ctrl+Z" style="background: rgb(37, 33, 24); color: rgba(255, 255, 255, 0.45); border: 1px solid rgba(255, 255, 255, 0.1); padding: 5px 9px; border-radius: 6px; font-size: 13px; cursor: pointer; opacity: 0.3;">â†©</button>
  <button onclick="edRedo()" id="edRedoBtn" title="Rehacer Ctrl+Y" style="background: rgb(37, 33, 24); color: rgba(255, 255, 255, 0.45); border: 1px solid rgba(255, 255, 255, 0.1); padding: 5px 9px; border-radius: 6px; font-size: 13px; cursor: pointer; opacity: 0.3;">â†ª</button>
  <div class="eds"></div>
  <!-- Modos -->
  <button onclick="edToggleMode()" id="edModeBtn" class="edpb teal" style="background: rgb(43, 125, 122);">ðŸ–± Seleccionar</button>
  <button onclick="edToggleText()" id="edTxtBtn" class="edpb teal" style="background: rgb(43, 125, 122);">âœï¸ Editar textos</button>
  <div class="eds"></div>
  <!-- Formato rÃ¡pido texto -->
  <div style="display:flex;gap:2px">
    <button onclick="edFmt('bold')" class="efb2" title="Negrita Ctrl+B"><b>B</b></button>
    <button onclick="edFmt('italic')" class="efb2" title="Cursiva Ctrl+I"><i style="font-style:italic">I</i></button>
    <button onclick="edFmt('underline')" class="efb2" title="Subrayado" style="text-decoration:underline">U</button>
    <button onclick="edFmt('strikeThrough')" class="efb2" title="Tachado" style="text-decoration:line-through">S</button>
  </div>
  <div style="display:flex;gap:2px">
    <button onclick="edFmt('justifyLeft')" class="efb2" title="Izquierda">â¬›â—»</button>
    <button onclick="edFmt('justifyCenter')" class="efb2" title="Centro">â—»â¬›â—»</button>
    <button onclick="edFmt('justifyRight')" class="efb2" title="Derecha">â—»â¬›</button>
  </div>
  <div style="display:flex;gap:2px">
    <button onclick="edFmtBlock('h1')" class="efb2 efb2s">H1</button>
    <button onclick="edFmtBlock('h2')" class="efb2 efb2s">H2</button>
    <button onclick="edFmtBlock('h3')" class="efb2 efb2s">H3</button>
    <button onclick="edFmt('insertUnorderedList')" class="efb2">â€¢â‰¡</button>
    <button onclick="edFmt('insertOrderedList')" class="efb2">1.â‰¡</button>
  </div>
  <div class="eds"></div>
  <!-- Color texto + fuente + tamaÃ±o -->
  <input type="color" id="edFontColor" value="#1c1814" title="Color texto" style="width:24px;height:24px;border:none;border-radius:4px;cursor:pointer;padding:0;flex-shrink:0" onchange="edApplyFontColor(this.value)">
  <select id="edFont" onchange="edApplyFont(this.value)" style="background:#252118;color:white;border:1px solid rgba(255,255,255,.15);padding:3px 4px;border-radius:5px;font-size:10px;cursor:pointer;max-width:100px">
    <option value="">Fuente</option>
    <option value="'DM Sans',sans-serif">DM Sans</option>
    <option value="'Cormorant Garamond',serif">Cormorant</option>
    <option value="Georgia,serif">Georgia</option>
    <option value="Arial,sans-serif">Arial</option>
    <option value="'Helvetica Neue',sans-serif">Helvetica</option>
    <option value="'Times New Roman',serif">Times NR</option>
    <option value="'Courier New',monospace">Courier</option>
  </select>
  <div style="display:flex;gap:2px;align-items:center">
    <select id="edFontSize" onchange="if(this.value){edApplyFontSize(this.value);this.value=''}" style="background:#252118;color:white;border:1px solid rgba(255,255,255,.15);padding:3px 3px;border-radius:5px;font-size:10px;cursor:pointer;max-width:58px">
      <option value="">px</option>
      <option value="11px">11</option><option value="12px">12</option><option value="13px">13</option>
      <option value="14px">14</option><option value="15px">15</option><option value="16px">16</option>
      <option value="18px">18</option><option value="20px">20</option><option value="22px">22</option>
      <option value="24px">24</option><option value="28px">28</option><option value="32px">32</option>
      <option value="36px">36</option><option value="40px">40</option><option value="48px">48</option>
      <option value="56px">56</option><option value="64px">64</option><option value="80px">80</option>
    </select>
    <input id="edFontSzFree" type="number" min="8" max="200" placeholder="px" title="TamaÃ±o libre â€” Enter para aplicar" style="width:40px;background:#252118;color:white;border:1px solid rgba(255,255,255,.15);padding:3px 4px;border-radius:5px;font-size:10px;outline:none" onkeydown="if(event.key==='Enter'&amp;&amp;this.value){edApplyFontSize(this.value+'px');this.value=''}">
  </div>
  <div class="eds"></div>
  <!-- BG / Borde -->
  <div style="display:flex;align-items:center;gap:2px">
    <span style="font-size:9px;color:rgba(255,255,255,.3)">BG</span>
    <input type="color" id="edBg" value="#f7f5f1" title="Fondo del bloque" style="width:24px;height:24px;border:none;border-radius:4px;cursor:pointer;padding:0" onchange="edApplyBg(this.value)">
    <button onclick="edApplyBg('transparent')" style="background:#252118;color:rgba(255,255,255,.35);border:1px solid rgba(255,255,255,.1);padding:1px 5px;border-radius:4px;font-size:11px;cursor:pointer">âˆ…</button>
  </div>
  <div style="display:flex;align-items:center;gap:2px">
    <span style="font-size:9px;color:rgba(255,255,255,.3)">BD</span>
    <input type="color" id="edBorderColor" value="#e4ddd3" title="Borde" style="width:24px;height:24px;border:none;border-radius:4px;cursor:pointer;padding:0" onchange="edApplyBorder(this.value)">
    <button onclick="edApplyBorder('none')" style="background:#252118;color:rgba(255,255,255,.35);border:1px solid rgba(255,255,255,.1);padding:1px 5px;border-radius:4px;font-size:11px;cursor:pointer">âˆ…</button>
  </div>
  <input type="color" id="edBtnColor" value="#2b7d7a" title="Color de botÃ³n" style="width:24px;height:24px;border:none;border-radius:4px;cursor:pointer;padding:0;flex-shrink:0" onchange="edApplyBtn(this.value)">
  <div class="eds"></div>
  <!-- W / H inline -->
  <div style="display:flex;gap:2px;align-items:center">
    <span style="font-size:9px;color:rgba(255,255,255,.3)">W</span>
    <input id="edWInp" type="text" placeholder="auto" title="Ancho: px / % / auto â€” Enter" style="width:52px;background:#252118;color:white;border:1px solid rgba(255,255,255,.15);padding:3px 4px;border-radius:5px;font-size:10px;outline:none" onkeydown="if(event.key==='Enter')edPropLive('width',this.value)">
    <span style="font-size:9px;color:rgba(255,255,255,.3)">H</span>
    <input id="edHInp" type="text" placeholder="auto" title="Alto: px / vh / auto â€” Enter" style="width:52px;background:#252118;color:white;border:1px solid rgba(255,255,255,.15);padding:3px 4px;border-radius:5px;font-size:10px;outline:none" onkeydown="if(event.key==='Enter')edPropLive('height',this.value)">
  </div>
  <select id="edPadding" onchange="edApplyPadding(this.value)" style="background:#252118;color:white;border:1px solid rgba(255,255,255,.15);padding:3px 4px;border-radius:5px;font-size:10px;cursor:pointer;max-width:80px">
    <option value="">Padding</option>
    <option value="0">0</option><option value="8px">8px</option><option value="12px">12px</option>
    <option value="16px">16px</option><option value="24px">24px</option><option value="32px">32px</option>
    <option value="40px">40px</option><option value="48px">48px</option><option value="64px">64px</option><option value="80px">80px</option>
  </select>
  <div class="eds"></div>
  <!-- Props button -->
  <button onclick="edToggleProps()" id="edPropsBtn" style="background: rgb(37, 33, 24); color: rgb(61, 158, 155); border: 1px solid rgba(61, 158, 155, 0.35); padding: 5px 11px; border-radius: 6px; font-size: 11px; font-weight: 700; cursor: pointer; white-space: nowrap;">âš™ Props â†’</button>
  <div class="eds"></div>
  <!-- AÃ±adir bloques -->
  <span style="font-size:9px;color:rgba(255,255,255,.3);white-space:nowrap">AÃ‘ADIR:</span>
  <button onclick="edInsert('texto')" class="edba">ðŸ“ Texto</button>
  <button onclick="edInsert('tarjeta')" class="edba">ðŸƒ Tarjeta</button>
  <button onclick="edInsert('banner-ancho')" class="edba">ðŸ”² Banner</button>
  <button onclick="edInsert('banner-pequeÃ±o')" class="edba">â–­ BannerS</button>
  <button onclick="edInsert('imagen-banner')" class="edba">ðŸ–¼ Img.banner</button>
  <button onclick="edInsert('imagen-pequeÃ±a')" class="edba">ðŸ–¼ Img+txt</button>
  <button onclick="edInsert('boton')" class="edba">ðŸ”˜ BotÃ³n</button>
  <button onclick="edInsert('separador')" class="edba">â€” Sep.</button>
  <div class="eds"></div>
  <!-- Acciones -->
  <button onclick="edAddLink()" class="edba">ðŸ”— Link</button>
  <button onclick="edChangeImage()" class="edba">ðŸ–¼ Img.</button>
  <button onclick="edDuplicate()" class="edba">ðŸ“‹ Dupl.</button>
  <button onclick="edMoveUp()" class="edba">â¬†</button>
  <button onclick="edMoveDown()" class="edba">â¬‡</button>
  <button onclick="edDeleteSelected()" style="background:#2a1412;color:#f08080;border:1px solid rgba(191,70,55,.2);padding:4px 9px;border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;white-space:nowrap">ðŸ—‘ Eliminar</button>
  <div class="eds"></div>
  <!-- Guardar -->
  <button onclick="edSave()" style="background:#b89558;color:white;border:none;padding:7px 15px;border-radius:6px;font-size:12px;font-weight:700;cursor:pointer;white-space:nowrap">ðŸ’¾ Guardar</button>
  <button onclick="edClose()" style="background:rgba(255,255,255,.06);color:rgba(255,255,255,.45);border:none;padding:6px 10px;border-radius:6px;font-size:12px;cursor:pointer">âœ•</button>
  <span id="edMsg" style="font-size:10px;color:#3d9e9b;margin-left:auto;white-space:nowrap;overflow:hidden;max-width:260px;text-overflow:ellipsis">âœ… #edOpenBtn: "âœï¸ Editor" â€” modifica en la barra o en âš™ Props</span>
</div>

<style>
/* â”€â”€ Editor v3 core â”€â”€ */
.eds{width:1px;height:20px;background:rgba(255,255,255,.1);flex-shrink:0}
.edpb{border:none;padding:6px 12px;border-radius:6px;font-size:11px;font-weight:700;cursor:pointer;white-space:nowrap}
.edpb.teal{background:#2b7d7a;color:white}
.edba{background:#252118;color:rgba(255,255,255,.65);border:1px solid rgba(255,255,255,.1);padding:4px 8px;border-radius:5px;font-size:10px;font-weight:600;cursor:pointer;white-space:nowrap}
.edba:hover{background:#353028;color:white}
.efb2{background:#252118;color:rgba(255,255,255,.7);border:1px solid rgba(255,255,255,.1);padding:3px 7px;border-radius:5px;font-size:11px;cursor:pointer;min-width:24px;text-align:center}
.efb2:hover,.efb2:active{background:#2b7d7a;color:white;border-color:#2b7d7a}
.efb2s{font-size:9px;font-weight:700}
.edctx-btn{display:block;width:100%;background:none;border:none;color:rgba(255,255,255,.8);padding:7px 12px;text-align:left;font-size:12px;cursor:pointer;border-radius:6px}
.edctx-btn:hover{background:rgba(255,255,255,.07)}
.ed-selected-ring{outline:2px solid #3d9e9b !important;outline-offset:2px}
/* Floating format bar */
.efb{background:#252118;color:rgba(255,255,255,.8);border:1px solid rgba(255,255,255,.12);padding:3px 7px;border-radius:5px;font-size:11px;cursor:pointer;white-space:nowrap;min-width:24px;text-align:center}
.efb:hover{background:#3d9e9b;border-color:#3d9e9b;color:white}
.efbsep{width:1px;height:16px;background:rgba(255,255,255,.12);flex-shrink:0;margin:0 1px}
.efb-lbl{font-size:9px;font-weight:700}
/* Props panel */
.epp-sec{padding:11px 14px;border-bottom:1px solid rgba(255,255,255,.06)}
.epp-lbl{font-size:9px;font-weight:700;color:rgba(255,255,255,.45);text-transform:uppercase;letter-spacing:.08em;margin-bottom:7px}
.epp-sub{font-size:9px;color:rgba(255,255,255,.3);margin-bottom:3px;text-transform:uppercase;letter-spacing:.05em}
.epp-inp{background:#252118;color:white;border:1px solid rgba(255,255,255,.14);padding:5px 7px;border-radius:5px;font-size:11px;font-family:'DM Sans',sans-serif;outline:none;box-sizing:border-box}
.epp-inp:focus{border-color:#3d9e9b}
.epp-grid2{display:grid;grid-template-columns:1fr 1fr;gap:5px}
.epp-xbtn{background:#252118;color:rgba(255,255,255,.45);border:1px solid rgba(255,255,255,.1);padding:3px 7px;border-radius:5px;font-size:12px;cursor:pointer;flex-shrink:0}
.epp-xbtn:hover{background:#353028;color:white}
.epp-sw{width:22px;height:22px;border-radius:4px;cursor:pointer;border:1px solid rgba(255,255,255,.1);transition:transform .12s;flex-shrink:0}
.epp-sw:hover{transform:scale(1.2);z-index:1}
.epp-grad{width:34px;height:22px;border-radius:4px;cursor:pointer;border:1px solid rgba(255,255,255,.1);transition:transform .12s}
.epp-grad:hover{transform:scale(1.1)}
.epp-chip{background:#252118;color:rgba(255,255,255,.6);border:1px solid rgba(255,255,255,.1);padding:3px 8px;border-radius:4px;font-size:10px;cursor:pointer;font-family:'DM Sans',sans-serif;white-space:nowrap}
.epp-chip:hover{background:#2b7d7a;color:white;border-color:#2b7d7a}
.epp-rowbtn{background:#252118;color:rgba(255,255,255,.65);border:1px solid rgba(255,255,255,.1);padding:6px 10px;border-radius:6px;font-size:11px;cursor:pointer;font-family:'DM Sans',sans-serif;text-align:left;transition:background .12s;width:100%}
.epp-rowbtn:hover{background:#353028;color:white}
.epp-css{width:100%;background:#0a0806;color:#3d9e9b;border:1px solid rgba(255,255,255,.1);border-radius:5px;padding:7px;font-family:monospace;font-size:10px;resize:vertical;outline:none;box-sizing:border-box}
/* Page adjust when panel open */
body.ed-props-open #page-public{margin-right:268px;transition:margin .2s}
</style>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FRECUENCIA INTEGRAL â€” Editor WYSIWYG v3 completo
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var _edOn=false,_edSelMode=false,_edSel=null,_edSelBtn=null,_edPropsOpen=false;
var _edHistory=[],_edFuture=[],_edMaxSnap=30;
var _edBW='1px',_edBS='solid';

// â”€â”€ Snapshot / Historial â”€â”€
function edSnapshot(){
  var h=document.getElementById('page-public').innerHTML;
  if(_edHistory.length&&_edHistory[_edHistory.length-1]===h)return;
  _edHistory.push(h); if(_edHistory.length>_edMaxSnap)_edHistory.shift();
  _edFuture=[]; edSyncHistBtns();
}
function edUndo(){
  if(_edHistory.length<2){edMsg('âš ï¸ Nada que deshacer');return;}
  _edFuture.push(_edHistory.pop());
  document.getElementById('page-public').innerHTML=_edHistory[_edHistory.length-1];
  edMsg('â†© Deshecho'); edSyncHistBtns();
}
function edRedo(){
  if(!_edFuture.length){edMsg('âš ï¸ Nada que rehacer');return;}
  var h=_edFuture.pop(); _edHistory.push(h);
  document.getElementById('page-public').innerHTML=h;
  edMsg('â†ª Rehecho'); edSyncHistBtns();
}
function edSyncHistBtns(){
  var u=document.getElementById('edUndoBtn'),r=document.getElementById('edRedoBtn');
  if(u)u.style.opacity=_edHistory.length>1?'1':'0.3';
  if(r)r.style.opacity=_edFuture.length?'1':'0.3';
}

// â”€â”€ Keyboard shortcuts â”€â”€
document.addEventListener('keydown',function(e){
  var panel=document.getElementById('edPanel');
  if(!panel||panel.style.display!=='flex')return;
  var cm=e.ctrlKey||e.metaKey;
  if(cm&&e.key==='z'&&!e.shiftKey){e.preventDefault();edUndo();}
  if(cm&&(e.key==='y'||(e.key==='z'&&e.shiftKey))){e.preventDefault();edRedo();}
  if(cm&&e.key==='b'&&_edOn){e.preventDefault();edFmt('bold');}
  if(cm&&e.key==='i'&&_edOn){e.preventDefault();edFmt('italic');}
  if(e.key==='Escape'){edCtxClose();edClearSel();edFmtBarHide();}
  if((e.key==='Delete'||e.key==='Backspace')&&_edSel&&!_edOn){e.preventDefault();edDeleteSelected();}
});

function edMsg(t){var m=document.getElementById('edMsg');if(m)m.textContent=t;}

// â”€â”€ Abrir / Cerrar â”€â”€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROTECCIÃ“N POR CONTRASEÃ‘A DEL EDITOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš ï¸ CAMBIA ESTA CONTRASEÃ‘A POR LA TUYA:
var _edPassword = 'frecuencia2025';
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var _edUnlocked = false;
var _edSecretClicks = 0;
var _edSecretTimer = null;

function edSecretClick() {
  _edSecretClicks++;
  clearTimeout(_edSecretTimer);
  _edSecretTimer = setTimeout(function(){ _edSecretClicks = 0; }, 800);
  if(_edSecretClicks >= 3) {
    _edSecretClicks = 0;
    if(_edUnlocked) {
      // Ya desbloqueado: mostrar/ocultar botones directamente
      edToggleEditorBtns();
    } else {
      edPwdShow();
    }
  }
}

function edPwdShow() {
  var modal = document.getElementById('edPwdModal');
  modal.style.display = 'flex';
  document.getElementById('edPwdInput').value = '';
  document.getElementById('edPwdErr').style.display = 'none';
  setTimeout(function(){ document.getElementById('edPwdInput').focus(); }, 100);
}

function edPwdCheck() {
  var val = document.getElementById('edPwdInput').value;
  if(val === _edPassword) {
    _edUnlocked = true;
    document.getElementById('edPwdModal').style.display = 'none';
    edShowEditorBtns();
    edMsg && edMsg('ðŸ”“ Editor desbloqueado â€” bienvenido');
  } else {
    document.getElementById('edPwdErr').style.display = 'block';
    document.getElementById('edPwdInput').value = '';
    document.getElementById('edPwdInput').focus();
    // Shake animation
    var input = document.getElementById('edPwdInput');
    input.style.borderColor = '#bf4637';
    setTimeout(function(){ input.style.borderColor = 'rgba(255,255,255,.2)'; }, 1200);
  }
}

function edPwdCancel() {
  document.getElementById('edPwdModal').style.display = 'none';
  document.getElementById('edPwdInput').value = '';
}

function edShowEditorBtns() {
  var eb = document.getElementById('edOpenBtn');
  var nb = document.getElementById('navMgrBtn');
  if(eb) eb.style.display = '';
  if(nb) nb.style.display = '';
}

function edHideEditorBtns() {
  var eb = document.getElementById('edOpenBtn');
  var nb = document.getElementById('navMgrBtn');
  if(eb) eb.style.display = 'none';
  if(nb) nb.style.display = 'none';
  // Close panels if open
  var panel = document.getElementById('edPanel');
  if(panel && panel.style.display === 'flex') edClose();
  var nm = document.getElementById('navMgrPanel');
  if(nm) nm.style.display = 'none';
}

function edToggleEditorBtns() {
  var eb = document.getElementById('edOpenBtn');
  if(eb && eb.style.display !== 'none') {
    edHideEditorBtns();
  } else {
    edShowEditorBtns();
  }
}

// Cerrar modal con Escape
document.addEventListener('keydown', function(e) {
  if(e.key === 'Escape' && document.getElementById('edPwdModal').style.display === 'flex') {
    edPwdCancel();
  }
});

function editorOpen(){
  var p=document.getElementById('edPanel');
  var open=p.style.display==='flex';
  p.style.display=open?'none':'flex';
  if(!open&&!_edHistory.length)edSnapshot();
  if(open){edCloseProps();edFmtBarHide();}
}
function edClose(){
  document.getElementById('edPanel').style.display='none';
  if(_edOn)edToggleText();
  edClearSel(); edCtxClose(); edCloseProps(); edFmtBarHide();
}

// â”€â”€ Props panel â”€â”€
function edToggleProps(){
  _edPropsOpen=!_edPropsOpen;
  var pp=document.getElementById('edPropsPanel');
  var btn=document.getElementById('edPropsBtn');
  pp.style.display=_edPropsOpen?'block':'none';
  btn.style.background=_edPropsOpen?'#3d9e9b':'#252118';
  btn.style.color=_edPropsOpen?'white':'#3d9e9b';
  btn.textContent=_edPropsOpen?'âš™ Props âœ•':'âš™ Props â†’';
  document.body.classList.toggle('ed-props-open',_edPropsOpen);
  if(_edPropsOpen&&_edSel)edFillProps(_edSel);
}
function edCloseProps(){
  _edPropsOpen=false;
  var pp=document.getElementById('edPropsPanel');
  if(pp)pp.style.display='none';
  var btn=document.getElementById('edPropsBtn');
  if(btn){btn.style.background='#252118';btn.style.color='#3d9e9b';btn.textContent='âš™ Props â†’';}
  document.body.classList.remove('ed-props-open');
}

// â”€â”€ Sincronizar panel de propiedades con elemento â”€â”€
function edFillProps(el){
  if(!el)return;
  var s=el.style, cs=window.getComputedStyle(el);
  var tag=document.getElementById('edPropsTag');
  if(tag)tag.textContent='<'+el.tagName.toLowerCase()+(el.id?'#'+el.id:'')+'>';
  function si(id,v){var x=document.getElementById(id);if(x)x.value=v||'';}
  si('prpW',s.width);si('prpH',s.height);si('prpMW',s.maxWidth);si('prpMH',s.minHeight);
  si('prpPT',s.paddingTop);si('prpPB',s.paddingBottom);si('prpPL',s.paddingLeft);si('prpPR',s.paddingRight);
  si('prpFS',s.fontSize);si('prpLH',s.lineHeight);si('prpBR',s.borderRadius);
  // BG
  var bg=s.background||s.backgroundColor||cs.backgroundColor;
  var bgH=rgb2hex(bg);
  si('prpBgHex',bg.indexOf('gradient')>-1?bg:(bgH||bg));
  if(bgH)try{document.getElementById('prpBgPk').value=bgH;}catch(e){}
  // Text color
  var fc=s.color||cs.color; var fcH=rgb2hex(fc);
  si('prpTxtHex',fcH||fc);
  if(fcH)try{document.getElementById('prpTxtPk').value=fcH;}catch(e){}
  // Border
  var bc=s.borderColor||cs.borderColor; var bcH=rgb2hex(bc);
  si('prpBdHex',bcH||'');
  if(bcH)try{document.getElementById('prpBdPk').value=bcH;}catch(e){}
  // CSS
  si('prpCss',el.getAttribute('style')||'');
}

function rgb2hex(c){
  if(!c||c==='transparent')return'';
  if(c.startsWith('#'))return c;
  if(c.indexOf('gradient')>-1)return'';
  var m=c.match(/[\d.]+/g);
  if(!m||m.length<3)return'';
  if(c.indexOf('rgba')>-1&&parseFloat(m[3])===0)return'';
  return'#'+[m[0],m[1],m[2]].map(function(x){return('0'+parseInt(x).toString(16)).slice(-2);}).join('');
}

// â”€â”€ Aplicar propiedad CSS en vivo â”€â”€
function edPropLive(prop,val){
  if(!_edSel)return;
  _edSel.style[prop]=val;
  // sync W/H toolbar inputs
  var wi=document.getElementById('edWInp'),hi=document.getElementById('edHInp');
  if(prop==='width'&&wi)wi.value=val;
  if(prop==='height'&&hi)hi.value=val;
  edSnapshot();
}
function edPropQ(prop,val){edPropLive(prop,val);edMsg('âœ… '+prop+': '+val);}

// â”€â”€ Fondo â”€â”€
function edPropBg(val){
  if(!_edSel){edMsg('âš ï¸ Selecciona un bloque primero');return;}
  _edSel.style.background=val;
  var h=rgb2hex(val);
  if(h)try{document.getElementById('prpBgPk').value=h;}catch(e){}
  var hx=document.getElementById('prpBgHex'); if(hx)hx.value=val;
  if(h&&document.getElementById('edBg'))try{document.getElementById('edBg').value=h;}catch(e){}
  edMsg('ðŸŽ¨ Fondo: '+val.substring(0,40)); edSnapshot();
}
function edPropBgInput(v){
  if(!_edSel)return;
  if(v.length===7&&v[0]==='#'){edPropBg(v);}
  else if(v==='transparent'||v.indexOf('gradient')>-1){edPropBg(v);}
}
function edBuildGrad(){
  var c1=document.getElementById('prpG1').value;
  var c2=document.getElementById('prpG2').value;
  var dir=document.getElementById('prpGDir').value;
  var g='linear-gradient('+dir+','+c1+','+c2+')';
  var prev=document.getElementById('prpGPreview');
  if(prev)prev.style.background=g;
}
// â”€â”€ Color texto del bloque â”€â”€
function edPropTxtColor(val){
  if(!_edSel){edMsg('âš ï¸ Selecciona un bloque');return;}
  _edSel.style.setProperty('color',val,'important');
  _edSel.querySelectorAll('*').forEach(function(n){n.style.color=val;});
  var h=rgb2hex(val);
  if(h)try{document.getElementById('prpTxtPk').value=h;}catch(e){}
  var tx=document.getElementById('prpTxtHex'); if(tx)tx.value=val;
  if(h&&document.getElementById('edFontColor'))try{document.getElementById('edFontColor').value=h;}catch(e){}
  edMsg('âœï¸ Color texto: '+val); edSnapshot();
}
// â”€â”€ Borde â”€â”€
function edPropBorder(val){
  if(!_edSel)return;
  if(val==='none'){_edSel.style.border='none';}
  else{_edSel.style.border=_edBW+' '+_edBS+' '+val;}
  var h=rgb2hex(val);
  if(h){try{document.getElementById('prpBdPk').value=h;}catch(e){}
    var bx=document.getElementById('prpBdHex');if(bx)bx.value=val;}
  if(h&&document.getElementById('edBorderColor'))try{document.getElementById('edBorderColor').value=h;}catch(e){}
  edMsg('ðŸ”² Borde: '+val); edSnapshot();
}
function edPropBorderW(w){_edBW=w;if(_edSel&&_edSel.style.borderColor){_edSel.style.borderWidth=w;edSnapshot();}}
function edPropBorderSt(st){_edBS=st;if(_edSel&&_edSel.style.borderColor){_edSel.style.borderStyle=st;edSnapshot();}}
function edPropCssApply(){
  if(!_edSel){edMsg('âš ï¸ Selecciona un elemento');return;}
  var v=document.getElementById('prpCss').value;
  _edSel.setAttribute('style',v);
  edMsg('ðŸ’» CSS aplicado'); edSnapshot();
}
function edPropCssRead(){
  if(!_edSel){edMsg('âš ï¸ Selecciona un elemento');return;}
  var css=document.getElementById('prpCss');
  if(css)css.value=_edSel.getAttribute('style')||'';
  edMsg('â†» CSS leÃ­do');
}

// â”€â”€ Floating format bar â”€â”€
function edFmtBarHide(){var b=document.getElementById('edFmtBar');if(b)b.style.display='none';}
document.addEventListener('mouseup',function(e){
  if(!_edOn)return;
  if(e.target.closest('#edFmtBar')||e.target.closest('#edPanel'))return;
  setTimeout(function(){
    var sel=window.getSelection();
    if(!sel||!sel.rangeCount||!sel.toString().trim()){edFmtBarHide();return;}
    var rect=sel.getRangeAt(0).getBoundingClientRect();
    var bar=document.getElementById('edFmtBar');
    var bx=rect.left+rect.width/2-300;
    bar.style.left=Math.max(6,Math.min(bx,window.innerWidth-610))+'px';
    bar.style.top=(rect.top-58+window.scrollY)+'px';
    bar.style.display='flex';
    // sync color picker with selection
    try{
      var anc=sel.anchorNode;
      var el2=anc.nodeType===3?anc.parentElement:anc;
      var fc=window.getComputedStyle(el2).color;
      var fh=rgb2hex(fc);
      if(fh)document.getElementById('efbTxtColor').value=fh;
    }catch(ex){}
  },12);
});
document.addEventListener('mousedown',function(e){if(!e.target.closest('#edFmtBar'))edFmtBarHide();});

// â”€â”€ execCommand format â”€â”€
function edFmt(cmd){
  if(_edOn){document.execCommand(cmd,false,null);edSnapshot();}
  else if(_edSel){
    if(cmd==='justifyLeft'){_edSel.style.textAlign='left';edSnapshot();}
    else if(cmd==='justifyCenter'){_edSel.style.textAlign='center';edSnapshot();}
    else if(cmd==='justifyRight'){_edSel.style.textAlign='right';edSnapshot();}
    else edMsg('âš ï¸ Activa "Editar textos" para formato de texto');
  }
}
function edFmtBlock(tag){
  if(!_edOn){edMsg('âš ï¸ Activa "Editar textos" primero');return;}
  document.execCommand('formatBlock',false,tag);
  edSnapshot(); edMsg('âœ… '+tag.toUpperCase()+' aplicado');
}
function edFmtHighlight(color){
  if(!_edOn){return;}
  var sel=window.getSelection();
  if(!sel||!sel.rangeCount||!sel.toString())return;
  try{
    var range=sel.getRangeAt(0);
    var span=document.createElement('span');
    span.style.backgroundColor=color;
    span.appendChild(range.extractContents());
    range.insertNode(span); sel.removeAllRanges();
    edMsg('â–“ Resaltado aplicado'); edSnapshot();
  }catch(e){}
}

// â”€â”€ SelecciÃ³n visual â”€â”€
function edClearSel(){if(_edSel){_edSel.classList.remove('ed-selected-ring');_edSel=null;}_edSelBtn=null;}
function edSelectEl(el){
  edClearSel(); _edSel=el; el.classList.add('ed-selected-ring');
  var lbl=el.id?'#'+el.id:el.tagName.toLowerCase();
  var txt=el.textContent.trim().substring(0,28);
  edMsg('âœ… '+lbl+(txt?': "'+txt+'"':'')+' â€” modifica en la barra o en âš™ Props');
  // Sync toolbar
  try{
    var cs=window.getComputedStyle(el);
    var bg=el.style.background||el.style.backgroundColor||cs.backgroundColor;
    var bgH=rgb2hex(bg);
    if(bgH)try{document.getElementById('edBg').value=bgH;}catch(e2){}
    var fc=el.style.color||cs.color; var fcH=rgb2hex(fc);
    if(fcH)try{document.getElementById('edFontColor').value=fcH;}catch(e2){}
    var wi=document.getElementById('edWInp'); if(wi)wi.value=el.style.width||'';
    var hi=document.getElementById('edHInp'); if(hi)hi.value=el.style.height||'';
  }catch(e){}
  if(_edPropsOpen)edFillProps(el);
}

// â”€â”€ Modo selecciÃ³n â”€â”€
function edToggleMode(){
  _edSelMode=!_edSelMode;
  var b=document.getElementById('edModeBtn');
  b.style.background=_edSelMode?'#b89558':'#2b7d7a';
  b.textContent=_edSelMode?'ðŸŽ¯ Activo':'ðŸ–± Seleccionar';
  edMsg(_edSelMode?'ðŸŽ¯ Clic en cualquier elemento para seleccionar':'');
  if(!_edSelMode)edClearSel();
}

// â”€â”€ Modo ediciÃ³n textos â”€â”€
function edToggleText(){
  _edOn=!_edOn;
  var b=document.getElementById('edTxtBtn');
  if(_edOn){
    edSnapshot();
    var BLOCK=['DIV','P','H1','H2','H3','H4','H5','H6','SECTION','ARTICLE','UL','OL','LI','BLOCKQUOTE','PRE','TABLE','TD','TH'];
    var SKIP=['SCRIPT','STYLE','INPUT','SELECT','TEXTAREA','IFRAME','BUTTON','SVG','CANVAS','VIDEO','AUDIO'];
    document.querySelectorAll('#page-public *').forEach(function(el){
      if(el.closest('#edPanel')||el.closest('nav')||el.closest('.modal-overlay'))return;
      if(SKIP.indexOf(el.tagName)>-1||el.contentEditable==='true')return;
      var txt=el.textContent.trim();
      if(!txt||txt.length>800)return;
      var bk=0,dt=false;
      el.childNodes.forEach(function(n){
        if(n.nodeType===3&&n.textContent.trim())dt=true;
        if(n.nodeType===1&&BLOCK.indexOf(n.tagName)>-1)bk++;
      });
      if(bk===0||(dt&&bk<=1)){
        el.contentEditable='true';
        el.setAttribute('data-edol',el.style.outline||'');
        el.setAttribute('data-edcu',el.style.cursor||'');
        el.style.setProperty('outline','1px dashed rgba(43,125,122,.5)','important');
        el.style.cursor='text';
      }
    });
    b.textContent='ðŸ”’ Fin ediciÃ³n'; b.style.background='#bf4637';
    edMsg('âœï¸ Textos activos â€” selecciona texto para barra flotante de formato');
  }else{
    document.querySelectorAll('[contenteditable="true"]').forEach(function(el){
      el.removeAttribute('contenteditable');
      el.style.outline=el.getAttribute('data-edol')||'';
      el.style.cursor=el.getAttribute('data-edcu')||'';
      el.removeAttribute('data-edol'); el.removeAttribute('data-edcu');
    });
    edFmtBarHide();
    b.textContent='âœï¸ Editar textos'; b.style.background='#2b7d7a';
    edMsg(''); edSnapshot();
  }
}

// â”€â”€ Color texto â”€â”€
function edApplyFontColor(v){
  var sel=window.getSelection();
  if(_edOn&&sel&&sel.rangeCount>0&&sel.toString().length>0){
    try{
      var range=sel.getRangeAt(0);
      var frag=range.extractContents();
      frag.querySelectorAll('*').forEach(function(n){n.style.color=v;});
      var sp=document.createElement('span');
      sp.style.setProperty('color',v,'important');
      sp.appendChild(frag); range.insertNode(sp); sel.removeAllRanges();
      edMsg('ðŸŽ¨ Color texto aplicado'); edSnapshot();
    }catch(e){edMsg('âš ï¸ '+e.message);}
  }else if(_edSel){
    _edSel.style.setProperty('color',v,'important');
    _edSel.querySelectorAll('*').forEach(function(n){n.style.color=v;});
    edMsg('ðŸŽ¨ Color aplicado al elemento'); edSnapshot();
  }else edMsg('âš ï¸ Activa ediciÃ³n y selecciona texto, o selecciona elemento');
}

// â”€â”€ TipografÃ­a bloque â”€â”€
function edApplyFont(v){
  if(!v)return;
  if(_edSel){_edSel.style.fontFamily=v;edMsg('ðŸ”¤ TipografÃ­a aplicada');edSnapshot();}
  else edMsg('âš ï¸ Selecciona un elemento');
  document.getElementById('edFont').value='';
}
function edApplyFontInline(v){
  if(!v||!_edOn)return;
  var sel=window.getSelection();
  if(sel&&sel.rangeCount>0&&sel.toString()){
    try{
      var range=sel.getRangeAt(0);
      var sp=document.createElement('span');
      sp.style.fontFamily=v; sp.appendChild(range.extractContents());
      range.insertNode(sp); sel.removeAllRanges();
      edMsg('ðŸ”¤ Fuente inline aplicada'); edSnapshot();
    }catch(e){}
  }else if(_edSel){edApplyFont(v);}
}

// â”€â”€ TamaÃ±o texto â”€â”€
function edApplyFontSize(v){
  if(!v)return;
  var sel=window.getSelection();
  if(_edOn&&sel&&sel.rangeCount>0&&sel.toString()){
    try{
      var range=sel.getRangeAt(0);
      var frag=range.extractContents();
      var sp=document.createElement('span');
      sp.style.fontSize=v; sp.appendChild(frag);
      range.insertNode(sp); sel.removeAllRanges();
      edMsg('ðŸ“ TamaÃ±o '+v); edSnapshot(); return;
    }catch(e){}
  }
  if(_edSel){_edSel.style.fontSize=v;edMsg('ðŸ“ TamaÃ±o '+v+' aplicado al bloque');edSnapshot();}
  else edMsg('âš ï¸ Selecciona texto o elemento');
  var fs=document.getElementById('edFontSize'); if(fs)fs.value='';
}

// â”€â”€ Fondo / Borde / BotÃ³n / Padding â”€â”€
function edApplyBg(v){
  if(_edSel){_edSel.style.background=v;edMsg('ðŸŽ¨ Fondo: '+v);edSnapshot();}
  else edMsg('âš ï¸ Selecciona un bloque primero');
}
function edApplyBorder(v){
  if(_edSel){
    if(v==='none')_edSel.style.border='none';
    else _edSel.style.border=_edBW+' '+_edBS+' '+v;
    edMsg('ðŸ”² Borde: '+v); edSnapshot();
  }else edMsg('âš ï¸ Selecciona un elemento');
}
function edApplyBtn(v){
  var t=_edSelBtn||_edSel;
  if(t){
    var btn=t.tagName==='BUTTON'?t:t.querySelector('button, a[href]');
    if(btn){
      btn.style.background=v;
      var r=parseInt(v.slice(1,3),16),g=parseInt(v.slice(3,5),16),b=parseInt(v.slice(5,7),16);
      btn.style.color=(r*299+g*587+b*114)/1000>128?'#1c1814':'white';
      edMsg('ðŸ”˜ BotÃ³n: '+v); edSnapshot();
    }else edMsg('âš ï¸ No hay botÃ³n en este elemento');
  }else edMsg('âš ï¸ Selecciona un elemento con botÃ³n');
}
function edApplyPadding(v){
  if(!v)return;
  if(_edSel){_edSel.style.padding=v;edMsg('ðŸ“ Padding: '+v);edSnapshot();}
  else edMsg('âš ï¸ Selecciona un elemento');
  document.getElementById('edPadding').value='';
}

// â”€â”€ Enlace â”€â”€
function edAddLink(){
  var url=prompt('URL del enlace (ej: https://frecuenciaintegral.com):');
  if(!url)return;
  var sel=window.getSelection();
  if(_edOn&&sel&&sel.rangeCount>0&&sel.toString()){
    try{
      var range=sel.getRangeAt(0);
      var a=document.createElement('a');
      a.href=url; a.target='_blank'; a.style.color='inherit'; a.style.textDecoration='underline';
      a.appendChild(range.extractContents()); range.insertNode(a); sel.removeAllRanges();
      edMsg('ðŸ”— Enlace aÃ±adido'); edSnapshot(); return;
    }catch(e){}
  }
  if(_edSel){
    _edSel.style.cursor='pointer';
    _edSel.setAttribute('onclick',"window.open('"+url+"','_blank')");
    edMsg('ðŸ”— Enlace aÃ±adido al elemento'); edSnapshot();
  }else edMsg('âš ï¸ Selecciona texto o un elemento');
}

// â”€â”€ Cambiar imagen â”€â”€
function edChangeImage(){
  var url=prompt('URL de la nueva imagen:');
  if(!url)return;
  var t=_edSel||document.body;
  var img=t.tagName==='IMG'?t:t.querySelector('img');
  if(img){img.src=url;edMsg('ðŸ–¼ï¸ Imagen cambiada');edSnapshot();}
  else if(_edSel){
    var ni=document.createElement('img');
    ni.src=url; ni.style.cssText='width:100%;border-radius:12px;margin-top:12px;object-fit:cover;max-height:400px';
    _edSel.appendChild(ni); edMsg('ðŸ–¼ï¸ Imagen aÃ±adida'); edSnapshot();
  }else edMsg('âš ï¸ Selecciona un elemento primero');
}

// â”€â”€ Duplicar / Mover / Eliminar â”€â”€
function edDuplicate(){
  if(!_edSel){edMsg('âš ï¸ Selecciona un elemento');return;}
  edSnapshot();
  var cl=_edSel.cloneNode(true); cl.classList.remove('ed-selected-ring');
  _edSel.parentNode.insertBefore(cl,_edSel.nextSibling);
  edSelectEl(cl); edMsg('ðŸ“‹ Duplicado'); edSnapshot();
}
function edMoveUp(){
  if(!_edSel){edMsg('âš ï¸ Selecciona un elemento');return;}
  var prev=_edSel.previousElementSibling;
  if(prev){edSnapshot();_edSel.parentNode.insertBefore(_edSel,prev);edMsg('â¬†ï¸ Movido arriba');}
  else edMsg('âš ï¸ Ya estÃ¡ al principio');
}
function edMoveDown(){
  if(!_edSel){edMsg('âš ï¸ Selecciona un elemento');return;}
  var next=_edSel.nextElementSibling;
  if(next){edSnapshot();_edSel.parentNode.insertBefore(next,_edSel);edMsg('â¬‡ï¸ Movido abajo');}
  else edMsg('âš ï¸ Ya estÃ¡ al final');
}
function edDeleteSelected(){
  if(!_edSel){edMsg('âš ï¸ Selecciona un elemento');return;}
  if(!confirm('Â¿Eliminar este elemento? (deshacer con â†©)'))return;
  edSnapshot(); _edSel.remove(); _edSel=null;
  edMsg('ðŸ—‘ï¸ Eliminado â€” â†© para deshacer'); edSnapshot();
}

// â”€â”€ MenÃº contextual â”€â”€
function edCtxClose(){document.getElementById('edCtxMenu').style.display='none';}
function edCtxAction(a){
  edCtxClose();
  if(a==='props'){if(!_edPropsOpen)edToggleProps();else edFillProps(_edSel);}
  else if(a==='editar')edToggleText();
  else if(a==='link')edAddLink();
  else if(a==='imagen')edChangeImage();
  else if(a==='duplicar')edDuplicate();
  else if(a==='subir')edMoveUp();
  else if(a==='bajar')edMoveDown();
  else if(a==='eliminar')edDeleteSelected();
}
document.addEventListener('contextmenu',function(e){
  if(document.getElementById('edPanel').style.display!=='flex')return;
  if(e.target.closest('#edPanel')||e.target.closest('#edCtxMenu'))return;
  e.preventDefault();
  var el=e.target.closest('div,section,article,p,h1,h2,h3,img,button,span');
  if(el&&!el.closest('nav')){
    edSelectEl(el);
    var ctx=document.getElementById('edCtxMenu');
    document.getElementById('edCtxTitle').textContent=el.tagName.toLowerCase()+(el.id?'#'+el.id:'');
    ctx.style.display='block';
    ctx.style.left=Math.min(e.clientX,window.innerWidth-200)+'px';
    ctx.style.top=Math.min(e.clientY,window.innerHeight-290)+'px';
  }
});
document.addEventListener('click',function(e){
  if(e.target.closest('#edCtxMenu'))return;
  edCtxClose();
  var panel=document.getElementById('edPanel');
  if(!panel||panel.style.display!=='flex')return;
  if(e.target.closest('#edPanel')||e.target.closest('#edPropsPanel'))return;
  if(_edOn)return;
  if(_edSelMode){
    var el2=e.target.closest('div[style],section,article,p,h1,h2,h3,h4,img,button,span[style]');
    if(el2&&!el2.closest('nav')){e.stopPropagation();edSelectEl(el2);}
    return;
  }
  var btn=e.target.closest('button');
  if(btn&&!btn.closest('#edPanel')){_edSelBtn=btn;edSelectEl(btn);return;}
  var sec=e.target.closest('[id],[style*="border-radius"],section');
  if(sec&&!sec.closest('#edPanel')&&!sec.closest('nav')&&sec!==document.documentElement&&sec!==document.body)edSelectEl(sec);
});

// â”€â”€ Insertar bloques â”€â”€
function edInsert(tipo){
  edSnapshot();
  var el,S="font-family:'DM Sans',sans-serif",CG="font-family:'Cormorant Garamond',serif";
  if(tipo==='texto'){
    el=document.createElement('div');
    el.style.cssText='padding:60px 40px;max-width:800px;margin:0 auto;text-align:center';
    el.innerHTML='<h2 style="'+CG+';font-size:36px;font-weight:300;color:#1c1814;margin-bottom:16px">Nuevo tÃ­tulo</h2><p style="font-size:15px;color:#7a7168;line-height:1.75;max-width:600px;margin:0 auto">Escribe aquÃ­ el contenido del bloque.</p>';
  }else if(tipo==='tarjeta'){
    var grid=(_edSel&&_edSel.querySelector('[style*="grid"]'))||document.querySelector('#pilares [style*="grid"]');
    if(!grid){edMsg('âš ï¸ Selecciona primero una secciÃ³n con tarjetas');return;}
    el=document.createElement('div');
    el.style.cssText='background:white;border-radius:20px;padding:32px;border:1px solid #d9d2c8';
    el.innerHTML='<div style="font-size:32px;margin-bottom:16px">âœ¨</div><div style="'+CG+';font-size:24px;color:#1c1814;margin-bottom:10px">Nueva Tarjeta</div><div style="font-size:13px;color:#5a5248;line-height:1.75">DescripciÃ³n de la tarjeta.</div>';
    grid.appendChild(el);edSelectEl(el);edMsg('âœ… Tarjeta aÃ±adida');edSnapshot();return;
  }else if(tipo==='banner-ancho'){
    el=document.createElement('div');
    el.style.cssText='width:100%;padding:80px 40px;background:linear-gradient(135deg,#2b7d7a,#1c5a58);text-align:center';
    el.innerHTML='<h2 style="'+CG+';font-size:clamp(32px,5vw,56px);font-weight:300;color:white;margin-bottom:16px">Banner Principal</h2><p style="font-size:16px;color:rgba(255,255,255,.8);max-width:600px;margin:0 auto 32px;line-height:1.7">Texto del banner.</p><button style="background:white;color:#2b7d7a;border:none;padding:14px 32px;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;'+S+'">Llamada a la acciÃ³n</button>';
  }else if(tipo==='banner-pequeÃ±o'){
    el=document.createElement('div');
    el.style.cssText='max-width:900px;margin:40px auto;padding:40px 48px;background:#f0ece4;border-radius:20px;border:1px solid #d9d2c8;display:flex;align-items:center;gap:32px;flex-wrap:wrap';
    el.innerHTML='<div style="flex:1;min-width:200px"><div style="font-size:11px;font-weight:700;color:#7a7168;text-transform:uppercase;letter-spacing:.1em;margin-bottom:8px">Etiqueta</div><h3 style="'+CG+';font-size:28px;font-weight:300;color:#1c1814;margin-bottom:8px">TÃ­tulo</h3><p style="font-size:14px;color:#7a7168;line-height:1.7">DescripciÃ³n del contenido.</p></div><button style="background:#2b7d7a;color:white;border:none;padding:12px 28px;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;'+S+';flex-shrink:0">AcciÃ³n â†’</button>';
  }else if(tipo==='imagen-banner'){
    var ur=prompt('URL de la imagen:')||'https://via.placeholder.com/1400x500/f0ece4/7a7168?text=Banner';
    el=document.createElement('div');
    el.style.cssText='width:100%;height:450px;overflow:hidden;position:relative';
    el.innerHTML='<img src="'+ur+'" style="width:100%;height:100%;object-fit:cover"><div style="position:absolute;inset:0;background:rgba(28,24,20,.4);display:flex;align-items:center;justify-content:center;text-align:center;padding:40px"><div><h2 style="'+CG+';font-size:clamp(32px,5vw,60px);font-weight:300;color:white;margin-bottom:16px">TÃ­tulo</h2><p style="font-size:16px;color:rgba(255,255,255,.85);max-width:500px;margin:0 auto">SubtÃ­tulo o descripciÃ³n</p></div></div>';
  }else if(tipo==='imagen-pequeÃ±a'){
    var ur2=prompt('URL de la imagen:')||'https://via.placeholder.com/600x400/f0ece4/7a7168?text=Imagen';
    el=document.createElement('div');
    el.style.cssText='max-width:1000px;margin:40px auto;display:grid;grid-template-columns:1fr 1fr;gap:48px;align-items:center;padding:0 32px';
    el.innerHTML='<img src="'+ur2+'" style="width:100%;border-radius:16px;object-fit:cover;height:320px"><div><h3 style="'+CG+';font-size:28px;font-weight:300;color:#1c1814;margin-bottom:12px">TÃ­tulo</h3><p style="font-size:14px;color:#7a7168;line-height:1.75">DescripciÃ³n.</p></div>';
  }else if(tipo==='boton'){
    el=document.createElement('div');
    el.style.cssText='text-align:center;padding:24px';
    var hr=prompt('URL del enlace (o vacÃ­o):')||'#';
    el.innerHTML='<a href="'+hr+'" target="_blank" style="display:inline-block;background:#2b7d7a;color:white;padding:14px 32px;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;'+S+';text-decoration:none">Nuevo BotÃ³n</a>';
  }else if(tipo==='separador'){
    el=document.createElement('div');
    el.style.cssText='max-width:600px;margin:40px auto;display:flex;align-items:center;gap:20px;padding:0 32px';
    el.innerHTML='<div style="flex:1;height:1px;background:#e4ddd3"></div><span style="font-size:12px;color:#b8ad9e;font-weight:600;letter-spacing:.1em">â€¢</span><div style="flex:1;height:1px;background:#e4ddd3"></div>';
  }
  if(el){
    var anchor=_edSel?_edSel:(document.getElementById('joyas')||document.getElementById('pilares'));
    var page=document.getElementById('page-public');
    if(anchor&&anchor.parentNode)anchor.parentNode.insertBefore(el,anchor.nextSibling);
    else page.appendChild(el);
    el.scrollIntoView({behavior:'smooth',block:'center'});
    edSelectEl(el);
    edMsg('âœ… Bloque aÃ±adido â€” activa "Editar textos" para modificarlo');
    edSnapshot();
  }
}

// â”€â”€ Guardar â”€â”€
function edSave(){
  if(_edOn)edToggleText();
  edClearSel(); edCtxClose(); edCloseProps();
  document.querySelectorAll('[contenteditable]').forEach(function(el){
    el.removeAttribute('contenteditable');el.style.outline='';el.style.cursor='';
  });
  var openBtn=document.getElementById('edOpenBtn');
  var panel=document.getElementById('edPanel');
  if(openBtn)openBtn.style.display='none';
  panel.style.display='none';
  setTimeout(function(){
    var blob=new Blob(['<!DOCTYPE html>'+document.documentElement.outerHTML],{type:'text/html'});
    var a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download='frecuencia-integral-editada.html';
    document.body.appendChild(a);a.click();document.body.removeChild(a);
    if(openBtn)openBtn.style.display='';
    toast('âœ… Guardado â€” renombra a index.html y sube a Vercel');
  },200);
}
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- GESTOR DE NAVEGACIÃ“N Y PÃGINAS                                 -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- BotÃ³n de acceso rÃ¡pido (junto al Editor) -->
<button onclick="navMgrOpen()" id="navMgrBtn" style="position: fixed; bottom: 80px; left: 130px; z-index: 99999; background: rgb(28, 24, 20); color: rgb(184, 149, 88); border: 2px solid rgba(184, 149, 88, 0.3); padding: 10px 18px; border-radius: 100px; font-size: 12px; font-weight: 700; cursor: pointer; font-family: &quot;DM Sans&quot;, sans-serif; box-shadow: rgba(0, 0, 0, 0.5) 0px 4px 20px;">ðŸ—‚ Nav &amp; PÃ¡ginas</button>

<!-- Panel principal del Gestor -->
<div id="navMgrPanel" style="display: none; position: fixed; inset: 0px; z-index: 100000; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px);">
  <div style="position:absolute;top:0;right:0;bottom:0;width:min(780px,98vw);background:#161210;display:flex;flex-direction:column;box-shadow:-8px 0 40px rgba(0,0,0,.7)">

    <!-- Header del gestor -->
    <div style="display:flex;align-items:center;justify-content:space-between;padding:18px 24px;border-bottom:1px solid rgba(255,255,255,.1);flex-shrink:0;background:#1c1814">
      <div style="display:flex;align-items:center;gap:14px">
        <span style="font-size:20px">ðŸ—‚</span>
        <div>
          <div style="font-size:15px;font-weight:700;color:white;font-family:'DM Sans',sans-serif">Gestor de NavegaciÃ³n y PÃ¡ginas</div>
          <div style="font-size:11px;color:rgba(255,255,255,.4);font-family:'DM Sans',sans-serif">Header Â· CategorÃ­as Â· PÃ¡ginas Ocultas</div>
        </div>
      </div>
      <button onclick="navMgrClose()" style="background:rgba(255,255,255,.07);border:none;color:rgba(255,255,255,.5);font-size:18px;cursor:pointer;padding:6px 12px;border-radius:8px">âœ•</button>
    </div>

    <!-- Tabs -->
    <div style="display:flex;border-bottom:1px solid rgba(255,255,255,.1);flex-shrink:0;background:#1c1814">
      <button onclick="nmTab('header')" id="nmTab-header" class="nm-tab">ðŸ· Header</button>
      <button onclick="nmTab('nav')" id="nmTab-nav" class="nm-tab nm-tab-active">ðŸ”— NavegaciÃ³n</button>
      <button onclick="nmTab('pages')" id="nmTab-pages" class="nm-tab">ðŸ“„ PÃ¡ginas</button>
      <button onclick="nmTab('cats')" id="nmTab-cats" class="nm-tab">ðŸ“‚ CategorÃ­as</button>
    </div>

    <!-- Contenido tabs -->
    <div style="flex:1;overflow-y:auto;padding:24px">

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <!-- TAB: HEADER                     -->
      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="nmPane-header" data-protonpass-form="" style="display: none;">
        <h3 class="nm-section-title">ðŸ· Editar Header / Logo</h3>

        <div class="nm-card">
          <div class="nm-card-title">Logo / Nombre del sitio</div>
          <div class="nm-form-row">
            <div style="flex:1">
              <div class="nm-label">Nombre principal</div>
              <input id="nmLogoText" type="text" class="nm-inp" placeholder="Frecuencia Integral">
            </div>
            <div style="flex:1">
              <div class="nm-label">SubtÃ­tulo / tagline</div>
              <input id="nmLogoSub" type="text" class="nm-inp" placeholder="Academy">
            </div>
          </div>
          <div class="nm-form-row" style="margin-top:10px">
            <div style="flex:1">
              <div class="nm-label">URL del logo (imagen) â€” opcional</div>
              <input id="nmLogoImg" type="text" class="nm-inp" placeholder="https://... (dejar vacÃ­o para texto)">
            </div>
            <div style="flex:0 0 80px">
              <div class="nm-label">Alto logo</div>
              <input id="nmLogoH" type="text" value="36px" class="nm-inp">
            </div>
          </div>
          <button onclick="nmApplyLogo()" class="nm-btn-teal" style="margin-top:12px">âœ… Aplicar Logo</button>
        </div>

        <div class="nm-card" style="margin-top:16px">
          <div class="nm-card-title">Estilo del header</div>
          <div class="nm-form-row">
            <div style="flex:1">
              <div class="nm-label">Color de fondo</div>
              <div style="display:flex;gap:6px">
                <input type="color" id="nmHdrBg" value="#f7f5f1" style="width:36px;height:36px;border:none;border-radius:6px;cursor:pointer;padding:0">
                <input id="nmHdrBgHex" type="text" value="rgba(247,245,241,.95)" class="nm-inp" style="flex:1">
              </div>
            </div>
            <div style="flex:1">
              <div class="nm-label">Color borde inferior</div>
              <div style="display:flex;gap:6px">
                <input type="color" id="nmHdrBd" value="#e4ddd3" style="width:36px;height:36px;border:none;border-radius:6px;cursor:pointer;padding:0">
                <input id="nmHdrBdHex" type="text" value="#e4ddd3" class="nm-inp" style="flex:1">
              </div>
            </div>
            <div style="flex:0 0 80px">
              <div class="nm-label">Altura</div>
              <input id="nmHdrH" type="text" value="66px" class="nm-inp">
            </div>
          </div>
          <div class="nm-form-row" style="margin-top:10px">
            <div style="flex:1">
              <div class="nm-label">Color links nav</div>
              <div style="display:flex;gap:6px">
                <input type="color" id="nmHdrLinkClr" value="#3d3730" style="width:36px;height:36px;border:none;border-radius:6px;cursor:pointer;padding:0">
                <input type="text" id="nmHdrLinkHex" value="#3d3730" class="nm-inp">
              </div>
            </div>
            <div style="flex:1">
              <div class="nm-label">Color hover links</div>
              <div style="display:flex;gap:6px">
                <input type="color" id="nmHdrHoverClr" value="#2b7d7a" style="width:36px;height:36px;border:none;border-radius:6px;cursor:pointer;padding:0">
                <input type="text" id="nmHdrHoverHex" value="#2b7d7a" class="nm-inp">
              </div>
            </div>
            <div style="flex:1">
              <div class="nm-label">Fijo en scroll</div>
              <select id="nmHdrFixed" class="nm-inp">
                <option value="fixed">SÃ­ (fixed)</option>
                <option value="sticky">SÃ­ (sticky)</option>
                <option value="relative">No (relativo)</option>
              </select>
            </div>
          </div>
          <button onclick="nmApplyHeaderStyle()" class="nm-btn-teal" style="margin-top:12px">âœ… Aplicar Estilo Header</button>
        </div>

        <div class="nm-card" style="margin-top:16px">
          <div class="nm-card-title">Botones del header</div>
          <div id="nmHdrBtnsList" style="display:flex;flex-direction:column;gap:8px"><div style="display:flex;gap:8px;align-items:center;background:rgba(255,255,255,.03);padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,.07)"><input type="text" value="Acceso Alumnos" class="nm-inp" style="flex:1" onchange="_nm.hdrBtns[0].text=this.value" placeholder="Texto botÃ³n"><select class="nm-inp" onchange="_nm.hdrBtns[0].type=this.value" style="flex:0 0 110px"><option value="primary">Primario</option><option value="ghost" selected="">Fantasma</option><option value="teal">Verde TCT</option><option value="gold">Dorado</option></select><label style="font-size:11px;color:rgba(255,255,255,.4);cursor:pointer;white-space:nowrap"><input type="checkbox" checked="" onchange="_nm.hdrBtns[0].show=this.checked" style="cursor:pointer"> Visible</label><button onclick="_nm.hdrBtns.splice(0,1);nmRenderHdrBtns()" class="nm-btn-danger" style="flex-shrink:0">âœ•</button></div><div style="display:flex;gap:8px;align-items:center;background:rgba(255,255,255,.03);padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,.07)"><input type="text" value="Iniciarse Ahora" class="nm-inp" style="flex:1" onchange="_nm.hdrBtns[1].text=this.value" placeholder="Texto botÃ³n"><select class="nm-inp" onchange="_nm.hdrBtns[1].type=this.value" style="flex:0 0 110px"><option value="primary">Primario</option><option value="ghost" selected="">Fantasma</option><option value="teal">Verde TCT</option><option value="gold">Dorado</option></select><label style="font-size:11px;color:rgba(255,255,255,.4);cursor:pointer;white-space:nowrap"><input type="checkbox" checked="" onchange="_nm.hdrBtns[1].show=this.checked" style="cursor:pointer"> Visible</label><button onclick="_nm.hdrBtns.splice(1,1);nmRenderHdrBtns()" class="nm-btn-danger" style="flex-shrink:0">âœ•</button></div><div style="display:flex;gap:8px;align-items:center;background:rgba(255,255,255,.03);padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,.07)"><input type="text" value="Mi Dashboard" class="nm-inp" style="flex:1" onchange="_nm.hdrBtns[2].text=this.value" placeholder="Texto botÃ³n"><select class="nm-inp" onchange="_nm.hdrBtns[2].type=this.value" style="flex:0 0 110px"><option value="primary">Primario</option><option value="ghost" selected="">Fantasma</option><option value="teal">Verde TCT</option><option value="gold">Dorado</option></select><label style="font-size:11px;color:rgba(255,255,255,.4);cursor:pointer;white-space:nowrap"><input type="checkbox" onchange="_nm.hdrBtns[2].show=this.checked" style="cursor:pointer"> Visible</label><button onclick="_nm.hdrBtns.splice(2,1);nmRenderHdrBtns()" class="nm-btn-danger" style="flex-shrink:0">âœ•</button></div><div style="display:flex;gap:8px;align-items:center;background:rgba(255,255,255,.03);padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,.07)"><input type="text" value="âš™ Admin" class="nm-inp" style="flex:1" onchange="_nm.hdrBtns[3].text=this.value" placeholder="Texto botÃ³n"><select class="nm-inp" onchange="_nm.hdrBtns[3].type=this.value" style="flex:0 0 110px"><option value="primary">Primario</option><option value="ghost" selected="">Fantasma</option><option value="teal">Verde TCT</option><option value="gold">Dorado</option></select><label style="font-size:11px;color:rgba(255,255,255,.4);cursor:pointer;white-space:nowrap"><input type="checkbox" onchange="_nm.hdrBtns[3].show=this.checked" style="cursor:pointer"> Visible</label><button onclick="_nm.hdrBtns.splice(3,1);nmRenderHdrBtns()" class="nm-btn-danger" style="flex-shrink:0">âœ•</button></div><div style="display:flex;gap:8px;align-items:center;background:rgba(255,255,255,.03);padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,.07)"><input type="text" value="Salir" class="nm-inp" style="flex:1" onchange="_nm.hdrBtns[4].text=this.value" placeholder="Texto botÃ³n"><select class="nm-inp" onchange="_nm.hdrBtns[4].type=this.value" style="flex:0 0 110px"><option value="primary">Primario</option><option value="ghost" selected="">Fantasma</option><option value="teal">Verde TCT</option><option value="gold">Dorado</option></select><label style="font-size:11px;color:rgba(255,255,255,.4);cursor:pointer;white-space:nowrap"><input type="checkbox" onchange="_nm.hdrBtns[4].show=this.checked" style="cursor:pointer"> Visible</label><button onclick="_nm.hdrBtns.splice(4,1);nmRenderHdrBtns()" class="nm-btn-danger" style="flex-shrink:0">âœ•</button></div></div>
          <button onclick="nmAddHdrBtn()" class="nm-btn-outline" style="margin-top:10px">+ AÃ±adir botÃ³n</button>
          <button onclick="nmApplyHdrBtns()" class="nm-btn-teal" style="margin-top:8px">âœ… Aplicar Botones</button>
        </div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <!-- TAB: NAVEGACIÃ“N                 -->
      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="nmPane-nav" style="display: block;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
          <h3 class="nm-section-title" style="margin:0">ðŸ”— MenÃº de NavegaciÃ³n</h3>
          <button onclick="nmAddNavItem(null)" class="nm-btn-teal" style="font-size:11px">+ AÃ±adir Ã­tem nivel 1</button>
        </div>
        <div style="font-size:11px;color:rgba(255,255,255,.35);margin-bottom:14px;background:rgba(255,255,255,.04);padding:10px 14px;border-radius:8px">
          ðŸ’¡ Arrastra para reordenar. Clic en â–¶ para expandir subcategorÃ­as. Hasta 3 niveles de profundidad.
        </div>
        <div id="nmNavTree" style="display:flex;flex-direction:column;gap:4px"><div class="nm-tree-item" id="nmni_nav17716996591321" style="margin-left:0px"><span style="font-size:10px;color:rgba(255,255,255,.2);min-width:14px;text-align:right">â—</span><div class="nm-tree-label"><span style="font-weight:600">El Viaje</span><span class="nm-tree-sub"></span></div><div class="nm-tree-actions"><button onclick="nmAddNavItem('nav17716996591321')" class="nm-tree-btn" title="AÃ±adir sub-Ã­tem">+ Sub</button><button onclick="nmEditNavItem('nav17716996591321')" class="nm-tree-btn">âœï¸</button><button onclick="nmMoveNavItem('nav17716996591321', -1)" class="nm-tree-btn">â†‘</button><button onclick="nmMoveNavItem('nav17716996591321', 1)" class="nm-tree-btn">â†“</button><button onclick="nmDeleteNavItem('nav17716996591321')" class="nm-btn-danger">âœ•</button></div></div><div class="nm-tree-item" id="nmni_nav17716996591322" style="margin-left:0px"><span style="font-size:10px;color:rgba(255,255,255,.2);min-width:14px;text-align:right">â—</span><div class="nm-tree-label"><span style="font-weight:600">Precios</span><span class="nm-tree-sub"></span></div><div class="nm-tree-actions"><button onclick="nmAddNavItem('nav17716996591322')" class="nm-tree-btn" title="AÃ±adir sub-Ã­tem">+ Sub</button><button onclick="nmEditNavItem('nav17716996591322')" class="nm-tree-btn">âœï¸</button><button onclick="nmMoveNavItem('nav17716996591322', -1)" class="nm-tree-btn">â†‘</button><button onclick="nmMoveNavItem('nav17716996591322', 1)" class="nm-tree-btn">â†“</button><button onclick="nmDeleteNavItem('nav17716996591322')" class="nm-btn-danger">âœ•</button></div></div></div>
        <button onclick="nmApplyNav()" class="nm-btn-teal" style="margin-top:20px;width:100%">âœ… Aplicar NavegaciÃ³n al Header</button>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <!-- TAB: PÃGINAS                    -->
      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="nmPane-pages" style="display:none">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
          <h3 class="nm-section-title" style="margin:0">ðŸ“„ PÃ¡ginas del sitio</h3>
          <button onclick="nmNewPage()" class="nm-btn-teal" style="font-size:11px">+ Nueva PÃ¡gina</button>
        </div>
        <div style="font-size:11px;color:rgba(255,255,255,.35);margin-bottom:14px;background:rgba(255,255,255,.04);padding:10px 14px;border-radius:8px">
          ðŸ’¡ <b style="color:rgba(255,255,255,.5)">PÃ¡ginas visibles:</b> aparecen en el menÃº de navegaciÃ³n. <b style="color:rgba(255,255,255,.5)">PÃ¡ginas ocultas (landing):</b> accesibles solo por URL directa, no aparecen en el menÃº.
        </div>
        <div id="nmPagesList" style="display:flex;flex-direction:column;gap:8px"><div style="color:rgba(255,255,255,.3);font-size:12px;padding:30px;text-align:center;border:1px dashed rgba(255,255,255,.08);border-radius:10px">Sin pÃ¡ginas definidas. Crea la primera.</div></div>
      </div>

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <!-- TAB: CATEGORÃAS                 -->
      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div id="nmPane-cats" style="display:none">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
          <h3 class="nm-section-title" style="margin:0">ðŸ“‚ GestiÃ³n de CategorÃ­as</h3>
          <button onclick="nmAddCat(null,0)" class="nm-btn-teal" style="font-size:11px">+ CategorÃ­a raÃ­z</button>
        </div>
        <div style="font-size:11px;color:rgba(255,255,255,.35);margin-bottom:14px;background:rgba(255,255,255,.04);padding:10px 14px;border-radius:8px">
          ðŸ’¡ Organiza tu contenido en hasta 3 niveles: <b style="color:rgba(255,255,255,.5)">CategorÃ­a â†’ SubcategorÃ­a â†’ Sub-subcategorÃ­a</b>. Asigna pÃ¡ginas a cualquier nivel.
        </div>
        <div id="nmCatTree" style="display:flex;flex-direction:column;gap:4px"><div style="color:rgba(255,255,255,.3);font-size:12px;padding:30px;text-align:center;border:1px dashed rgba(255,255,255,.08);border-radius:10px">Sin categorÃ­as. Crea la primera con el botÃ³n de arriba.</div></div>
        <button onclick="nmApplyCatsToNav()" class="nm-btn-teal" style="margin-top:20px;width:100%">âœ… Sincronizar categorÃ­as â†’ NavegaciÃ³n</button>
      </div>

    </div><!-- /content -->

    <!-- Footer del panel -->
    <div style="padding:14px 24px;border-top:1px solid rgba(255,255,255,.08);display:flex;gap:10px;flex-shrink:0;background:#1c1814">
      <button onclick="nmSaveAll()" style="flex:1;background:#b89558;color:white;border:none;padding:10px;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif">ðŸ’¾ Guardar todo</button>
      <button onclick="nmClose()" style="background:rgba(255,255,255,.07);color:rgba(255,255,255,.5);border:1px solid rgba(255,255,255,.1);padding:10px 18px;border-radius:8px;font-size:13px;cursor:pointer">Cerrar</button>
    </div>
  </div>
</div>

<!-- Modal: Editor de pÃ¡gina -->
<div id="nmPageEditor" style="display:none;position:fixed;inset:0;z-index:100002;background:rgba(0,0,0,.7)">
  <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:min(600px,95vw);background:#1c1814;border-radius:16px;padding:28px;border:1px solid rgba(255,255,255,.12);box-shadow:0 20px 60px rgba(0,0,0,.6)">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:22px">
      <div style="font-size:16px;font-weight:700;color:white;font-family:'DM Sans',sans-serif" id="nmPageEdTitle">Nueva PÃ¡gina</div>
      <button onclick="document.getElementById('nmPageEditor').style.display='none'" style="background:none;border:none;color:rgba(255,255,255,.4);font-size:18px;cursor:pointer">âœ•</button>
    </div>
    <input type="hidden" id="nmPageEdId">
    <div style="display:flex;flex-direction:column;gap:14px">
      <div>
        <div class="nm-label">TÃ­tulo de la pÃ¡gina *</div>
        <input id="nmPageEdName" type="text" class="nm-inp" style="width:100%;box-sizing:border-box" placeholder="Ej: Sobre nosotros">
      </div>
      <div class="nm-form-row">
        <div style="flex:1">
          <div class="nm-label">Slug / URL amigable *</div>
          <input id="nmPageEdSlug" type="text" class="nm-inp" style="width:100%;box-sizing:border-box" placeholder="sobre-nosotros">
        </div>
        <div style="flex:0 0 140px">
          <div class="nm-label">Tipo de pÃ¡gina</div>
          <select id="nmPageEdType" class="nm-inp" style="width:100%">
            <option value="visible">ðŸ”— Visible en menÃº</option>
            <option value="hidden">ðŸ”’ Landing oculta</option>
            <option value="redirect">â†— RedirecciÃ³n</option>
          </select>
        </div>
      </div>
      <div id="nmPageEdRedirectRow" style="display:none">
        <div class="nm-label">URL de destino (redirect)</div>
        <input id="nmPageEdRedirect" type="text" class="nm-inp" style="width:100%;box-sizing:border-box" placeholder="https://...">
      </div>
      <div>
        <div class="nm-label">DescripciÃ³n / Notas internas</div>
        <input id="nmPageEdDesc" type="text" class="nm-inp" style="width:100%;box-sizing:border-box" placeholder="Para quÃ© sirve esta pÃ¡gina...">
      </div>
      <div class="nm-form-row">
        <div style="flex:1">
          <div class="nm-label">CategorÃ­a asignada</div>
          <select id="nmPageEdCat" class="nm-inp" style="width:100%">
            <option value="">â€” Sin categorÃ­a â€”</option>
          </select>
        </div>
        <div style="flex:1">
          <div class="nm-label">Meta title (SEO)</div>
          <input id="nmPageEdMeta" type="text" class="nm-inp" style="width:100%;box-sizing:border-box" placeholder="TÃ­tulo para Google...">
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-size:12px;color:rgba(255,255,255,.6);font-family:'DM Sans',sans-serif">
          <input type="checkbox" id="nmPageEdIndex" checked="" style="cursor:pointer">
          Indexable por Google (noindex si desmarcas)
        </label>
        <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-size:12px;color:rgba(255,255,255,.6);font-family:'DM Sans',sans-serif;margin-left:12px">
          <input type="checkbox" id="nmPageEdPwd" style="cursor:pointer">
          Proteger con contraseÃ±a
        </label>
      </div>
      <div id="nmPageEdPwdRow" style="display:none">
        <div class="nm-label">ContraseÃ±a de acceso</div>
        <input id="nmPageEdPwdVal" type="text" class="nm-inp" style="width:100%;box-sizing:border-box" placeholder="contraseÃ±a">
      </div>
    </div>
    <div style="display:flex;gap:10px;margin-top:22px">
      <button onclick="nmSavePage()" class="nm-btn-teal" style="flex:1">ðŸ’¾ Guardar PÃ¡gina</button>
      <button onclick="nmOpenInEditor()" class="nm-btn-outline" style="flex:1">âœï¸ Abrir en Editor</button>
      <button onclick="document.getElementById('nmPageEditor').style.display='none'" style="background:rgba(255,255,255,.06);color:rgba(255,255,255,.4);border:1px solid rgba(255,255,255,.1);padding:10px 16px;border-radius:8px;font-size:12px;cursor:pointer">Cancelar</button>
    </div>
  </div>
</div>

<!-- Modal: Editor de Ã­tem de nav -->
<div id="nmNavItemEditor" style="display: none; position: fixed; inset: 0px; z-index: 100003; background: rgba(0, 0, 0, 0.7);">
  <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:min(520px,95vw);background:#1c1814;border-radius:16px;padding:28px;border:1px solid rgba(255,255,255,.12);box-shadow:0 20px 60px rgba(0,0,0,.6)">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px">
      <div style="font-size:15px;font-weight:700;color:white;font-family:'DM Sans',sans-serif">Editar Ã­tem de navegaciÃ³n</div>
      <button onclick="document.getElementById('nmNavItemEditor').style.display='none'" style="background:none;border:none;color:rgba(255,255,255,.4);font-size:18px;cursor:pointer">âœ•</button>
    </div>
    <input type="hidden" id="nmNavEdId" value="nav17716996591322">
    <div style="display:flex;flex-direction:column;gap:12px">
      <div class="nm-form-row">
        <div style="flex:1">
          <div class="nm-label">Etiqueta del menÃº</div>
          <input id="nmNavEdLabel" type="text" class="nm-inp" style="width:100%;box-sizing:border-box" placeholder="Inicio">
        </div>
        <div style="flex:0 0 36px;padding-top:22px">
          <input id="nmNavEdEmoji" type="text" class="nm-inp" style="width:100%;text-align:center" placeholder="ðŸ ">
        </div>
      </div>
      <div>
        <div class="nm-label">Enlace / AcciÃ³n</div>
        <select id="nmNavEdLinkType" class="nm-inp" style="width:100%;margin-bottom:6px" onchange="nmNavEdLinkTypeChange()">
          <option value="anchor">âš“ Ancla en la pÃ¡gina (#id)</option>
          <option value="page">ðŸ“„ PÃ¡gina del sitio</option>
          <option value="url">ðŸŒ URL externa</option>
          <option value="nolink">â€” Solo etiqueta (sin enlace)</option>
        </select>
        <input id="nmNavEdAnchor" type="text" class="nm-inp" style="width: 100%; box-sizing: border-box;" placeholder="#puertas">
        <select id="nmNavEdPage" class="nm-inp" style="width: 100%; display: none;"><option value="">â€” Selecciona pÃ¡gina â€”</option></select>
        <input id="nmNavEdUrl" type="text" class="nm-inp" style="display:none;width:100%;box-sizing:border-box" placeholder="https://...">
      </div>
      <div class="nm-form-row">
        <div style="flex:1">
          <div class="nm-label">Color texto (opcional)</div>
          <div style="display:flex;gap:6px">
            <input type="color" id="nmNavEdClr" value="#3d3730" style="width:32px;height:32px;border:none;border-radius:5px;cursor:pointer;padding:0">
            <input type="text" id="nmNavEdClrHex" class="nm-inp" style="flex:1" placeholder="inherit">
          </div>
        </div>
        <div style="flex:1">
          <div class="nm-label">Estilo especial</div>
          <select id="nmNavEdStyle" class="nm-inp" style="width:100%">
            <option value="normal">Normal</option>
            <option value="bold">Negrita</option>
            <option value="btn-teal">BotÃ³n verde</option>
            <option value="btn-gold">BotÃ³n dorado</option>
            <option value="btn-outline">BotÃ³n outline</option>
            <option value="badge-new">Badge "Nuevo"</option>
            <option value="divider-before">Separador antes</option>
          </select>
        </div>
      </div>
      <label style="display:flex;align-items:center;gap:8px;cursor:pointer;font-size:12px;color:rgba(255,255,255,.6);font-family:'DM Sans',sans-serif">
        <input type="checkbox" id="nmNavEdNewTab" style="cursor:pointer">
        Abrir en nueva pestaÃ±a
      </label>
    </div>
    <div style="display:flex;gap:8px;margin-top:20px">
      <button onclick="nmSaveNavItem()" class="nm-btn-teal" style="flex:1">ðŸ’¾ Guardar</button>
      <button onclick="document.getElementById('nmNavItemEditor').style.display='none'" style="background:rgba(255,255,255,.06);color:rgba(255,255,255,.4);border:1px solid rgba(255,255,255,.1);padding:10px 16px;border-radius:8px;font-size:12px;cursor:pointer">Cancelar</button>
    </div>
  </div>
</div>

<style>
/* â”€â”€ Nav Manager styles â”€â”€ */
.nm-tab{background:none;border:none;color:rgba(255,255,255,.45);padding:12px 18px;font-size:12px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;border-bottom:2px solid transparent;transition:all .15s}
.nm-tab:hover{color:rgba(255,255,255,.7)}
.nm-tab-active{color:#3d9e9b!important;border-bottom-color:#3d9e9b!important}
.nm-section-title{font-size:14px;font-weight:700;color:white;font-family:'DM Sans',sans-serif;margin-bottom:14px}
.nm-card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.09);border-radius:12px;padding:18px}
.nm-card-title{font-size:12px;font-weight:700;color:rgba(255,255,255,.6);text-transform:uppercase;letter-spacing:.07em;margin-bottom:12px}
.nm-label{font-size:10px;color:rgba(255,255,255,.35);text-transform:uppercase;letter-spacing:.06em;margin-bottom:4px;font-family:'DM Sans',sans-serif}
.nm-inp{background:#252118;color:white;border:1px solid rgba(255,255,255,.14);padding:8px 10px;border-radius:7px;font-size:12px;font-family:'DM Sans',sans-serif;outline:none}
.nm-inp:focus{border-color:#3d9e9b}
.nm-form-row{display:flex;gap:10px;align-items:flex-start}
.nm-btn-teal{background:#2b7d7a;color:white;border:none;padding:9px 18px;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;transition:background .15s}
.nm-btn-teal:hover{background:#3d9e9b}
.nm-btn-gold{background:#b89558;color:white;border:none;padding:9px 18px;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif}
.nm-btn-outline{background:rgba(255,255,255,.06);color:rgba(255,255,255,.7);border:1px solid rgba(255,255,255,.15);padding:9px 18px;border-radius:8px;font-size:12px;cursor:pointer;font-family:'DM Sans',sans-serif}
.nm-btn-outline:hover{background:rgba(255,255,255,.1)}
.nm-btn-danger{background:rgba(191,70,55,.15);color:#f08080;border:1px solid rgba(191,70,55,.2);padding:6px 12px;border-radius:6px;font-size:11px;cursor:pointer;font-family:'DM Sans',sans-serif}
.nm-btn-danger:hover{background:rgba(191,70,55,.3)}

/* Nav tree items */
.nm-tree-item{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:9px;padding:10px 14px;display:flex;align-items:center;gap:8px;transition:border-color .15s}
.nm-tree-item:hover{border-color:rgba(255,255,255,.18)}
.nm-tree-item.nm-l2{margin-left:24px;background:rgba(255,255,255,.03);border-style:dashed}
.nm-tree-item.nm-l3{margin-left:48px;background:rgba(255,255,255,.02);border-style:dashed;border-color:rgba(255,255,255,.06)}
.nm-tree-label{flex:1;font-size:13px;color:white;font-family:'DM Sans',sans-serif}
.nm-tree-sub{font-size:10px;color:rgba(255,255,255,.3);display:block}
.nm-tree-actions{display:flex;gap:4px}
.nm-tree-btn{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);color:rgba(255,255,255,.5);padding:4px 8px;border-radius:5px;font-size:11px;cursor:pointer;font-family:'DM Sans',sans-serif;white-space:nowrap}
.nm-tree-btn:hover{background:rgba(255,255,255,.12);color:white}
.nm-expand-btn{background:none;border:none;color:rgba(255,255,255,.35);font-size:11px;cursor:pointer;padding:2px 5px;border-radius:4px;flex-shrink:0}
.nm-expand-btn:hover{color:white}

/* Page list items */
.nm-page-item{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:9px;padding:12px 16px;display:flex;align-items:center;gap:10px}
.nm-page-item:hover{border-color:rgba(255,255,255,.16)}
.nm-page-badge{font-size:9px;font-weight:700;padding:3px 8px;border-radius:4px;text-transform:uppercase;letter-spacing:.05em;white-space:nowrap;flex-shrink:0}
.nm-page-badge.visible{background:rgba(43,125,122,.2);color:#3d9e9b}
.nm-page-badge.hidden{background:rgba(184,149,88,.15);color:#b89558}
.nm-page-badge.redirect{background:rgba(44,95,158,.2);color:#7ab3f0}

/* Cat tree */
.nm-cat-item{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:9px;padding:10px 14px;display:flex;align-items:center;gap:8px}
.nm-cat-item.nm-c2{margin-left:20px;background:rgba(255,255,255,.03);border-color:rgba(255,255,255,.06)}
.nm-cat-item.nm-c3{margin-left:40px;background:rgba(255,255,255,.02);border-color:rgba(255,255,255,.05);border-style:dashed}
</style>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAV & PAGE MANAGER â€” Gestor de NavegaciÃ³n y PÃ¡ginas
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€ Estado del gestor â”€â”€
var _nm = {
  nav: [],        // Ã¡rbol de navegaciÃ³n
  pages: [],      // pÃ¡ginas del sitio
  cats: [],       // categorÃ­as
  hdrBtns: [],    // botones del header
  activeTab: 'header'
};

// â”€â”€ InicializaciÃ³n â”€â”€
function nmInit() {
  // Leer nav actual del DOM
  var links = document.querySelectorAll('nav .nav-links a');
  if(_nm.nav.length === 0) {
    links.forEach(function(a,i){
      _nm.nav.push({id:'nav'+Date.now()+i, label:a.textContent.trim(), linkType:'anchor', anchor:'', color:'', style:'normal', emoji:'', newTab:false, children:[]});
    });
    // Defaults si no habÃ­a nada
    if(_nm.nav.length === 0) {
      _nm.nav = [
        {id:'nav1',label:'Las Puertas',linkType:'anchor',anchor:'#puertas',color:'',style:'normal',emoji:'',newTab:false,children:[]},
        {id:'nav2',label:'El Viaje',linkType:'anchor',anchor:'#pilares',color:'',style:'normal',emoji:'',newTab:false,children:[]},
        {id:'nav3',label:'Precios',linkType:'anchor',anchor:'#joyas',color:'',style:'normal',emoji:'',newTab:false,children:[]}
      ];
    }
  }
  // Leer logo actual
  var logoEl = document.querySelector('nav .nav-logo');
  if(logoEl) {
    var spanEl = logoEl.querySelector('span');
    document.getElementById('nmLogoText').value = logoEl.childNodes[0] ? logoEl.childNodes[0].textContent.trim() : 'Frecuencia Integral';
    document.getElementById('nmLogoSub').value = spanEl ? spanEl.textContent.trim() : 'Academy';
  }
  // Leer botones header
  if(_nm.hdrBtns.length === 0) {
    document.querySelectorAll('nav .nav-btns button, nav .nav-btns a').forEach(function(b,i){
      _nm.hdrBtns.push({id:'hb'+i, text:b.textContent.trim(), type:'ghost', show:b.style.display!=='none'});
    });
  }
  nmRenderAll();
}

function navMgrOpen() {
  document.getElementById('navMgrPanel').style.display='block';
  nmInit();
}
function navMgrClose(){document.getElementById('navMgrPanel').style.display='none';}
function nmClose(){navMgrClose();}

// â”€â”€ Tabs â”€â”€
function nmTab(t) {
  _nm.activeTab = t;
  ['header','nav','pages','cats'].forEach(function(tab){
    document.getElementById('nmPane-'+tab).style.display = tab===t ? 'block' : 'none';
    var btn = document.getElementById('nmTab-'+tab);
    btn.className = 'nm-tab' + (tab===t ? ' nm-tab-active' : '');
  });
  if(t==='nav') nmRenderNavTree();
  if(t==='pages') nmRenderPagesList();
  if(t==='cats') nmRenderCatTree();
  if(t==='header') nmRenderHdrBtns();
}

function nmRenderAll(){
  nmRenderNavTree();
  nmRenderPagesList();
  nmRenderCatTree();
  nmRenderHdrBtns();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â”€â”€ HEADER / LOGO                         â”€â”€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function nmApplyLogo() {
  var txt = document.getElementById('nmLogoText').value || 'Frecuencia Integral';
  var sub = document.getElementById('nmLogoSub').value;
  var img = document.getElementById('nmLogoImg').value;
  var h = document.getElementById('nmLogoH').value || '36px';
  var logoEl = document.querySelector('nav .nav-logo');
  if(!logoEl) return;
  if(img) {
    logoEl.innerHTML = '<img src="'+img+'" style="height:'+h+';max-width:200px;object-fit:contain;vertical-align:middle" alt="'+txt+'">';
  } else {
    logoEl.innerHTML = txt + (sub ? '<span>'+sub+'</span>' : '');
  }
  edSnapshot && edSnapshot();
  nmToast('âœ… Logo actualizado');
}

function nmApplyHeaderStyle() {
  var navEl = document.querySelector('nav');
  if(!navEl) return;
  var bg = document.getElementById('nmHdrBgHex').value || document.getElementById('nmHdrBg').value;
  var bd = document.getElementById('nmHdrBdHex').value || document.getElementById('nmHdrBd').value;
  var h = document.getElementById('nmHdrH').value || '66px';
  var pos = document.getElementById('nmHdrFixed').value;
  navEl.style.background = bg;
  navEl.style.borderBottomColor = bd;
  navEl.style.height = h;
  navEl.style.position = pos;
  // Apply link color via stylesheet injection
  var lc = document.getElementById('nmHdrLinkHex').value || document.getElementById('nmHdrLinkClr').value;
  var hc = document.getElementById('nmHdrHoverHex').value || document.getElementById('nmHdrHoverClr').value;
  var styleEl = document.getElementById('nmDynStyle') || (function(){
    var s=document.createElement('style');s.id='nmDynStyle';document.head.appendChild(s);return s;
  })();
  styleEl.textContent = '.nav-links a{color:'+lc+'!important}.nav-links a:hover{color:'+hc+'!important}';
  edSnapshot && edSnapshot();
  nmToast('âœ… Estilo header aplicado');
}

function nmRenderHdrBtns() {
  var c = document.getElementById('nmHdrBtnsList');
  if(!c) return;
  if(_nm.hdrBtns.length === 0) {
    c.innerHTML = '<div style="color:rgba(255,255,255,.3);font-size:12px;padding:10px 0">No hay botones definidos. AÃ±ade uno.</div>';
    return;
  }
  c.innerHTML = _nm.hdrBtns.map(function(b,i){
    return '<div style="display:flex;gap:8px;align-items:center;background:rgba(255,255,255,.03);padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,.07)">'
      +'<input type="text" value="'+b.text+'" class="nm-inp" style="flex:1" onchange="_nm.hdrBtns['+i+'].text=this.value" placeholder="Texto botÃ³n">'
      +'<select class="nm-inp" onchange="_nm.hdrBtns['+i+'].type=this.value" style="flex:0 0 110px">'
      +'<option value="primary"'+(b.type==='primary'?' selected':'')+'>Primario</option>'
      +'<option value="ghost"'+(b.type==='ghost'?' selected':'')+'>Fantasma</option>'
      +'<option value="teal"'+(b.type==='teal'?' selected':'')+'>Verde TCT</option>'
      +'<option value="gold"'+(b.type==='gold'?' selected':'')+'>Dorado</option>'
      +'</select>'
      +'<label style="font-size:11px;color:rgba(255,255,255,.4);cursor:pointer;white-space:nowrap"><input type="checkbox"'+(b.show?' checked':'')+' onchange="_nm.hdrBtns['+i+'].show=this.checked" style="cursor:pointer"> Visible</label>'
      +'<button onclick="_nm.hdrBtns.splice('+i+',1);nmRenderHdrBtns()" class="nm-btn-danger" style="flex-shrink:0">âœ•</button>'
      +'</div>';
  }).join('');
}
function nmAddHdrBtn() {
  _nm.hdrBtns.push({id:'hb'+Date.now(),text:'Nuevo BotÃ³n',type:'ghost',show:true});
  nmRenderHdrBtns();
}
function nmApplyHdrBtns() {
  var btns = document.querySelector('nav .nav-btns');
  if(!btns) return;
  // Keep existing functional buttons (login/dash/admin etc) â€” only update visible text/style for custom ones
  nmToast('âœ… Botones actualizados (para botones funcionales usa el Editor de textos)');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â”€â”€ NAVEGACIÃ“N (Ã¡rbol de 3 niveles)       â”€â”€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function nmGenId(){return 'ni'+Date.now()+Math.random().toString(36).slice(2,6);}

function nmRenderNavTree() {
  var c = document.getElementById('nmNavTree');
  if(!c) return;
  if(_nm.nav.length === 0) {
    c.innerHTML = '<div style="color:rgba(255,255,255,.3);font-size:12px;padding:20px;text-align:center">Sin Ã­tems. AÃ±ade el primero â†’</div>';
    return;
  }
  var html = '';
  _nm.nav.forEach(function(item, i){
    html += nmRenderNavItem(item, i, 0, '');
  });
  c.innerHTML = html;
}

function nmRenderNavItem(item, idx, level, parentPath) {
  var cls = level===0?'nm-tree-item':(level===1?'nm-tree-item nm-l2':'nm-tree-item nm-l3');
  var indent = level * 24;
  var linkInfo = item.linkType==='anchor'?item.anchor : item.linkType==='url'?'â†— '+item.url : item.linkType==='page'?'ðŸ“„ pg':'-';
  var hasChildren = item.children && item.children.length > 0;
  var levelLabel = ['', 'â†³ Nivel 2', 'â†³â†³ Nivel 3'][level];
  var path = parentPath ? parentPath+'.children['+idx+']' : '['+idx+']';
  var canAddChild = level < 2;
  var html = '<div class="'+cls+'" id="nmni_'+item.id+'" style="margin-left:'+indent+'px">'
    +'<span style="font-size:10px;color:rgba(255,255,255,.2);min-width:14px;text-align:right">'+['â—','â—‹','â—¦'][level]+'</span>'
    +'<div class="nm-tree-label">'
    +(item.emoji?'<span style="margin-right:5px">'+item.emoji+'</span>':'')
    +'<span style="font-weight:600">'+(item.label||'Sin nombre')+'</span>'
    +'<span class="nm-tree-sub">'+linkInfo+(levelLabel?' Â· <span style="color:rgba(61,158,155,.6)">'+levelLabel+'</span>':'')+'</span>'
    +'</div>'
    +'<div class="nm-tree-actions">'
    +(canAddChild?'<button onclick="nmAddNavItem(\''+item.id+'\')" class="nm-tree-btn" title="AÃ±adir sub-Ã­tem">+ Sub</button>':'')
    +'<button onclick="nmEditNavItem(\''+item.id+'\')" class="nm-tree-btn">âœï¸</button>'
    +'<button onclick="nmMoveNavItem(\''+item.id+'\', -1)" class="nm-tree-btn">â†‘</button>'
    +'<button onclick="nmMoveNavItem(\''+item.id+'\', 1)" class="nm-tree-btn">â†“</button>'
    +'<button onclick="nmDeleteNavItem(\''+item.id+'\')" class="nm-btn-danger">âœ•</button>'
    +'</div></div>';
  // Render children
  if(hasChildren) {
    item.children.forEach(function(child, ci){
      html += nmRenderNavItem(child, ci, level+1, path);
    });
  }
  return html;
}

// Buscar Ã­tem en Ã¡rbol por id
function nmFindNavItem(id, arr, parent) {
  if(!arr) return null;
  for(var i=0;i<arr.length;i++){
    if(arr[i].id===id) return {item:arr[i],arr:arr,idx:i,parent:parent};
    var found = nmFindNavItem(id, arr[i].children, arr[i]);
    if(found) return found;
  }
  return null;
}

function nmAddNavItem(parentId) {
  var newItem = {id:nmGenId(),label:'Nuevo Ã­tem',linkType:'anchor',anchor:'',color:'',style:'normal',emoji:'',newTab:false,children:[]};
  if(!parentId) {
    _nm.nav.push(newItem);
  } else {
    var found = nmFindNavItem(parentId, _nm.nav, null);
    if(found && found.item.children) {
      // Check max depth
      var depth = nmGetDepth(found.item);
      if(depth >= 2) { nmToast('âš ï¸ MÃ¡ximo 3 niveles de profundidad'); return; }
      found.item.children.push(newItem);
    }
  }
  // Open editor for new item
  _editingNavId = newItem.id;
  nmOpenNavEditor(newItem);
}

function nmGetDepth(item) {
  if(!item.children||item.children.length===0) return 0;
  return 1 + Math.max.apply(null, item.children.map(nmGetDepth));
}

function nmEditNavItem(id) {
  var found = nmFindNavItem(id, _nm.nav, null);
  if(found) { _editingNavId = id; nmOpenNavEditor(found.item); }
}

function nmDeleteNavItem(id) {
  if(!confirm('Â¿Eliminar este Ã­tem y sus subÃ­tems?')) return;
  function removeFrom(arr) {
    for(var i=arr.length-1;i>=0;i--){
      if(arr[i].id===id){arr.splice(i,1);return true;}
      if(arr[i].children && removeFrom(arr[i].children)) return true;
    }
    return false;
  }
  removeFrom(_nm.nav);
  nmRenderNavTree();
}

function nmMoveNavItem(id, dir) {
  function moveIn(arr) {
    for(var i=0;i<arr.length;i++){
      if(arr[i].id===id){
        var ni=i+dir;
        if(ni>=0&&ni<arr.length){var tmp=arr[i];arr[i]=arr[ni];arr[ni]=tmp;return true;}
        return false;
      }
      if(arr[i].children && moveIn(arr[i].children)) return true;
    }
    return false;
  }
  moveIn(_nm.nav); nmRenderNavTree();
}

var _editingNavId = null;
function nmOpenNavEditor(item) {
  document.getElementById('nmNavEdId').value = item.id;
  document.getElementById('nmNavEdLabel').value = item.label||'';
  document.getElementById('nmNavEdEmoji').value = item.emoji||'';
  document.getElementById('nmNavEdLinkType').value = item.linkType||'anchor';
  document.getElementById('nmNavEdAnchor').value = item.anchor||'';
  document.getElementById('nmNavEdUrl').value = item.url||'';
  document.getElementById('nmNavEdClr').value = item.color||'#3d3730';
  document.getElementById('nmNavEdClrHex').value = item.color||'';
  document.getElementById('nmNavEdStyle').value = item.style||'normal';
  document.getElementById('nmNavEdNewTab').checked = !!item.newTab;
  // Populate page select
  var pgSel = document.getElementById('nmNavEdPage');
  pgSel.innerHTML = '<option value="">â€” Selecciona pÃ¡gina â€”</option>';
  _nm.pages.forEach(function(p){ pgSel.innerHTML += '<option value="'+p.slug+'"'+(item.pageSlug===p.slug?' selected':'')+'>'+p.name+'</option>'; });
  pgSel.value = item.pageSlug||'';
  nmNavEdLinkTypeChange();
  document.getElementById('nmNavItemEditor').style.display='block';
}

function nmNavEdLinkTypeChange() {
  var t = document.getElementById('nmNavEdLinkType').value;
  document.getElementById('nmNavEdAnchor').style.display = t==='anchor'?'':'none';
  document.getElementById('nmNavEdPage').style.display = t==='page'?'':'none';
  document.getElementById('nmNavEdUrl').style.display = t==='url'?'':'none';
}

function nmSaveNavItem() {
  var id = document.getElementById('nmNavEdId').value;
  var found = nmFindNavItem(id, _nm.nav, null);
  if(!found) return;
  var t = document.getElementById('nmNavEdLinkType').value;
  found.item.label = document.getElementById('nmNavEdLabel').value;
  found.item.emoji = document.getElementById('nmNavEdEmoji').value;
  found.item.linkType = t;
  found.item.anchor = document.getElementById('nmNavEdAnchor').value;
  found.item.url = document.getElementById('nmNavEdUrl').value;
  found.item.pageSlug = document.getElementById('nmNavEdPage').value;
  found.item.color = document.getElementById('nmNavEdClrHex').value;
  found.item.style = document.getElementById('nmNavEdStyle').value;
  found.item.newTab = document.getElementById('nmNavEdNewTab').checked;
  document.getElementById('nmNavItemEditor').style.display='none';
  nmRenderNavTree();
  nmToast('âœ… Ãtem guardado');
}

function nmApplyNav() {
  var linksEl = document.querySelector('nav .nav-links');
  if(!linksEl) return;
  linksEl.innerHTML = '';
  function renderItems(items, container, level) {
    items.forEach(function(item){
      var a = document.createElement('a');
      a.textContent = (item.emoji?item.emoji+' ':'') + item.label;
      if(item.color) a.style.color = item.color;
      if(item.style==='bold') a.style.fontWeight='700';
      if(item.style==='btn-teal') a.style.cssText='background:#2b7d7a;color:white;padding:6px 14px;border-radius:7px;font-weight:600';
      if(item.style==='btn-gold') a.style.cssText='background:#b89558;color:white;padding:6px 14px;border-radius:7px;font-weight:600';
      if(item.style==='btn-outline') a.style.cssText='border:1.5px solid #2b7d7a;color:#2b7d7a;padding:5px 13px;border-radius:7px;font-weight:600';
      if(item.newTab) { a.target='_blank'; }
      // Build onclick
      if(item.linkType==='anchor'&&item.anchor) {
        var anc=item.anchor.replace('#','');
        a.setAttribute('onclick','(function(){var el=document.getElementById("'+anc+'");if(el)el.scrollIntoView({behavior:"smooth"});else window.location.hash="'+item.anchor+'";})()');
        a.href='#';
        a.addEventListener('click',function(e){e.preventDefault();});
      } else if(item.linkType==='url'&&item.url) {
        a.href=item.url;
      } else if(item.linkType==='page'&&item.pageSlug) {
        a.href=item.pageSlug;
      } else if(item.linkType==='nolink') {
        a.style.cursor='default'; a.style.pointerEvents='none';
      }
      // Badge
      if(item.style==='badge-new') {
        var badge=document.createElement('span');
        badge.textContent='New'; badge.style.cssText='background:#bf4637;color:white;font-size:8px;font-weight:700;padding:1px 5px;border-radius:3px;margin-left:4px;vertical-align:middle;letter-spacing:.04em';
        a.appendChild(badge);
      }
      // Divider
      if(item.style==='divider-before') {
        var div=document.createElement('span'); div.style.cssText='width:1px;height:14px;background:rgba(0,0,0,.15);margin:0 4px;display:inline-block;vertical-align:middle';
        container.appendChild(div);
      }
      container.appendChild(a);
      // Sub-items: create a dropdown wrapper if children
      if(item.children&&item.children.length>0&&level===0) {
        a.style.cursor='pointer';
        var wrapper=document.createElement('div');
        wrapper.style.cssText='position:relative;display:inline-block';
        container.removeChild(a); wrapper.appendChild(a);
        var drop=document.createElement('div');
        drop.style.cssText='display:none;position:absolute;top:100%;left:0;background:rgba(247,245,241,.98);border:1px solid #e4ddd3;border-radius:10px;padding:6px;min-width:180px;box-shadow:0 8px 24px rgba(0,0,0,.12);z-index:1000;margin-top:4px';
        renderItems(item.children, drop, level+1);
        wrapper.appendChild(drop);
        a.addEventListener('mouseenter',function(){drop.style.display='block';});
        wrapper.addEventListener('mouseleave',function(){drop.style.display='none';});
        container.appendChild(wrapper);
      }
    });
  }
  renderItems(_nm.nav, linksEl, 0);
  edSnapshot && edSnapshot();
  nmToast('âœ… NavegaciÃ³n aplicada al header');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â”€â”€ PÃGINAS                               â”€â”€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function nmRenderPagesList() {
  var c = document.getElementById('nmPagesList');
  if(!c) return;
  if(_nm.pages.length === 0) {
    c.innerHTML = '<div style="color:rgba(255,255,255,.3);font-size:12px;padding:30px;text-align:center;border:1px dashed rgba(255,255,255,.08);border-radius:10px">Sin pÃ¡ginas definidas. Crea la primera.</div>';
    return;
  }
  c.innerHTML = _nm.pages.map(function(p,i){
    var badge = p.type==='hidden'?'<span class="nm-page-badge hidden">ðŸ”’ Landing oculta</span>':
               p.type==='redirect'?'<span class="nm-page-badge redirect">â†— Redirect</span>':
               '<span class="nm-page-badge visible">ðŸ”— Visible</span>';
    return '<div class="nm-page-item">'
      +badge
      +'<div style="flex:1">'
      +'<div style="font-size:13px;font-weight:600;color:white;font-family:\'DM Sans\',sans-serif">'+p.name+'</div>'
      +'<div style="font-size:10px;color:rgba(255,255,255,.35);font-family:monospace">/'+p.slug+(p.desc?' Â· '+p.desc:'')+'</div>'
      +'</div>'
      +'<div style="display:flex;gap:5px">'
      +'<button onclick="nmEditPage('+i+')" class="nm-tree-btn">âœï¸ Editar</button>'
      +'<button onclick="nmOpenInEditorById(\''+p.id+'\')" class="nm-tree-btn" title="Editar contenido">ðŸ–Š Contenido</button>'
      +'<button onclick="_nm.pages.splice('+i+',1);nmRenderPagesList()" class="nm-btn-danger">âœ•</button>'
      +'</div></div>';
  }).join('');
  // Update page selector in nav editor
  var sel = document.getElementById('nmNavEdPage');
  if(sel) {
    sel.innerHTML = '<option value="">â€” Selecciona pÃ¡gina â€”</option>';
    _nm.pages.forEach(function(p){ sel.innerHTML += '<option value="'+p.slug+'">'+p.name+'</option>'; });
  }
  // Update cat page selector
  nmUpdatePageSelectors();
}

function nmNewPage() {
  document.getElementById('nmPageEdId').value = nmGenId();
  document.getElementById('nmPageEdTitle').textContent = 'Nueva PÃ¡gina';
  document.getElementById('nmPageEdName').value = '';
  document.getElementById('nmPageEdSlug').value = '';
  document.getElementById('nmPageEdDesc').value = '';
  document.getElementById('nmPageEdType').value = 'hidden';
  document.getElementById('nmPageEdMeta').value = '';
  document.getElementById('nmPageEdIndex').checked = true;
  document.getElementById('nmPageEdPwd').checked = false;
  document.getElementById('nmPageEdPwdRow').style.display = 'none';
  document.getElementById('nmPageEdRedirectRow').style.display = 'none';
  nmUpdateCatSelector();
  document.getElementById('nmPageEditor').style.display = 'block';
  // Auto-gen slug
  document.getElementById('nmPageEdName').addEventListener('input', function(){
    var slug = this.value.toLowerCase().replace(/\s+/g,'-').replace(/[^a-z0-9-]/g,'').replace(/-+/g,'-');
    document.getElementById('nmPageEdSlug').value = slug;
    document.getElementById('nmPageEdMeta').value = this.value;
  }, {once:false});
  document.getElementById('nmPageEdPwd').onchange = function(){
    document.getElementById('nmPageEdPwdRow').style.display = this.checked ? '' : 'none';
  };
  document.getElementById('nmPageEdType').onchange = function(){
    document.getElementById('nmPageEdRedirectRow').style.display = this.value==='redirect' ? '' : 'none';
  };
}

function nmEditPage(i) {
  var p = _nm.pages[i];
  document.getElementById('nmPageEdId').value = p.id;
  document.getElementById('nmPageEdTitle').textContent = 'Editar: ' + p.name;
  document.getElementById('nmPageEdName').value = p.name||'';
  document.getElementById('nmPageEdSlug').value = p.slug||'';
  document.getElementById('nmPageEdDesc').value = p.desc||'';
  document.getElementById('nmPageEdType').value = p.type||'hidden';
  document.getElementById('nmPageEdMeta').value = p.meta||'';
  document.getElementById('nmPageEdIndex').checked = p.index!==false;
  document.getElementById('nmPageEdPwd').checked = !!p.pwd;
  document.getElementById('nmPageEdPwdRow').style.display = p.pwd ? '' : 'none';
  document.getElementById('nmPageEdPwdVal').value = p.pwd||'';
  document.getElementById('nmPageEdRedirect').value = p.redirect||'';
  document.getElementById('nmPageEdRedirectRow').style.display = p.type==='redirect' ? '' : 'none';
  nmUpdateCatSelector(p.catId);
  document.getElementById('nmPageEditor').style.display = 'block';
}

function nmSavePage() {
  var id = document.getElementById('nmPageEdId').value;
  var name = document.getElementById('nmPageEdName').value.trim();
  var slug = document.getElementById('nmPageEdSlug').value.trim();
  if(!name){alert('El tÃ­tulo es obligatorio');return;}
  if(!slug){alert('El slug es obligatorio');return;}
  var page = {
    id: id, name: name, slug: slug,
    type: document.getElementById('nmPageEdType').value,
    desc: document.getElementById('nmPageEdDesc').value,
    meta: document.getElementById('nmPageEdMeta').value,
    index: document.getElementById('nmPageEdIndex').checked,
    pwd: document.getElementById('nmPageEdPwd').checked ? document.getElementById('nmPageEdPwdVal').value : '',
    redirect: document.getElementById('nmPageEdRedirect').value,
    catId: document.getElementById('nmPageEdCat').value,
    html: ''
  };
  var existing = _nm.pages.findIndex(function(p){return p.id===id;});
  if(existing>-1) _nm.pages[existing] = Object.assign(_nm.pages[existing], page);
  else _nm.pages.push(page);
  document.getElementById('nmPageEditor').style.display = 'none';
  nmRenderPagesList();
  nmToast('âœ… PÃ¡gina "'+name+'" guardada');
  if(page.type==='visible') {
    if(confirm('Â¿AÃ±adir "'+name+'" al menÃº de navegaciÃ³n?')) {
      _nm.nav.push({id:nmGenId(),label:name,linkType:'page',pageSlug:slug,color:'',style:'normal',emoji:'',newTab:false,children:[]});
      nmRenderNavTree();
    }
  }
}

function nmOpenInEditor() {
  var name = document.getElementById('nmPageEdName').value;
  nmSavePage();
  nmToast('ðŸ’¡ Usa el Editor WYSIWYG para editar el contenido de la pÃ¡gina en el canvas.');
  navMgrClose();
}

function nmOpenInEditorById(id) {
  nmToast('ðŸ’¡ Selecciona el contenido de la pÃ¡gina en el canvas y edita con el Editor WYSIWYG.');
  navMgrClose();
}

function nmUpdateCatSelector(selId) {
  var sel = document.getElementById('nmPageEdCat');
  if(!sel) return;
  sel.innerHTML = '<option value="">â€” Sin categorÃ­a â€”</option>';
  function addOpts(cats, prefix) {
    cats.forEach(function(c){
      sel.innerHTML += '<option value="'+c.id+'"'+(selId===c.id?' selected':'')+'>'+prefix+c.name+'</option>';
      if(c.children) addOpts(c.children, prefix+'â†³ ');
    });
  }
  addOpts(_nm.cats, '');
}

function nmUpdatePageSelectors() {
  nmUpdateCatSelector();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â”€â”€ CATEGORÃAS (Ã¡rbol 3 niveles)          â”€â”€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function nmRenderCatTree() {
  var c = document.getElementById('nmCatTree');
  if(!c) return;
  if(_nm.cats.length === 0) {
    c.innerHTML = '<div style="color:rgba(255,255,255,.3);font-size:12px;padding:30px;text-align:center;border:1px dashed rgba(255,255,255,.08);border-radius:10px">Sin categorÃ­as. Crea la primera con el botÃ³n de arriba.</div>';
    return;
  }
  c.innerHTML = renderCatItems(_nm.cats, 0);
}

function renderCatItems(items, level) {
  if(level > 2) return '';
  var html = '';
  items.forEach(function(c,i){
    var cls = ['nm-cat-item','nm-cat-item nm-c2','nm-cat-item nm-c3'][level];
    var icon = ['ðŸ“','ðŸ“‚','ðŸ“Œ'][level];
    var pages = _nm.pages.filter(function(p){return p.catId===c.id;});
    var canAddChild = level < 2;
    html += '<div class="'+cls+'">'
      +'<span>'+icon+'</span>'
      +'<div style="flex:1">'
      +'<div style="font-size:13px;font-weight:600;color:white;font-family:\'DM Sans\',sans-serif">'+c.name+'</div>'
      +'<div style="font-size:10px;color:rgba(255,255,255,.35)">'+['CategorÃ­a','SubcategorÃ­a','Sub-sub'][level]
      +(pages.length?' Â· '+pages.length+' pÃ¡gina'+(pages.length>1?'s':''):'')
      +(c.slug?' Â· /'+c.slug:'')+'</div>'
      +'</div>'
      +'<div style="display:flex;gap:4px">'
      +(canAddChild?'<button onclick="nmAddCat(\''+c.id+'\','+level+')" class="nm-tree-btn">+ Sub</button>':'')
      +'<button onclick="nmEditCat(\''+c.id+'\')" class="nm-tree-btn">âœï¸</button>'
      +'<button onclick="nmMoveCat(\''+c.id+'\', -1)" class="nm-tree-btn">â†‘</button>'
      +'<button onclick="nmMoveCat(\''+c.id+'\', 1)" class="nm-tree-btn">â†“</button>'
      +'<button onclick="nmDeleteCat(\''+c.id+'\')" class="nm-btn-danger">âœ•</button>'
      +'</div></div>';
    if(c.children&&c.children.length>0) {
      html += renderCatItems(c.children, level+1);
    }
  });
  return html;
}

function nmFindCat(id, arr) {
  for(var i=0;i<arr.length;i++){
    if(arr[i].id===id) return {cat:arr[i],arr:arr,idx:i};
    if(arr[i].children){var f=nmFindCat(id,arr[i].children);if(f)return f;}
  }
  return null;
}

function nmAddCat(parentId, parentLevel) {
  var name = prompt('Nombre de la '+(parentLevel===0?'sub':'sub-sub')+'categorÃ­a:');
  if(!name) return;
  var slug = name.toLowerCase().replace(/\s+/g,'-').replace(/[^a-z0-9-]/g,'');
  var newCat = {id:'cat'+Date.now(),name:name,slug:slug,desc:'',children:[]};
  if(!parentId) {
    _nm.cats.push(newCat);
  } else {
    var found = nmFindCat(parentId, _nm.cats);
    if(found && found.cat.children) found.cat.children.push(newCat);
  }
  nmRenderCatTree(); nmUpdateCatSelector();
  nmToast('âœ… CategorÃ­a "'+name+'" creada');
}

function nmEditCat(id) {
  var found = nmFindCat(id, _nm.cats);
  if(!found) return;
  var c = found.cat;
  var name = prompt('Nombre:', c.name);
  if(name===null) return;
  var slug = prompt('Slug (URL):', c.slug||name.toLowerCase().replace(/\s+/g,'-').replace(/[^a-z0-9-]/g,''));
  if(slug===null) return;
  c.name = name; c.slug = slug;
  nmRenderCatTree(); nmUpdateCatSelector();
  nmToast('âœ… CategorÃ­a actualizada');
}

function nmDeleteCat(id) {
  if(!confirm('Â¿Eliminar esta categorÃ­a y sus subcategorÃ­as?')) return;
  function removeFrom(arr) {
    for(var i=arr.length-1;i>=0;i--){
      if(arr[i].id===id){arr.splice(i,1);return true;}
      if(arr[i].children&&removeFrom(arr[i].children))return true;
    }
    return false;
  }
  removeFrom(_nm.cats);
  // Remove cat assignment from pages
  _nm.pages.forEach(function(p){if(p.catId===id)p.catId='';});
  nmRenderCatTree(); nmUpdateCatSelector(); nmRenderPagesList();
}

function nmMoveCat(id, dir) {
  function moveIn(arr){
    for(var i=0;i<arr.length;i++){
      if(arr[i].id===id){var ni=i+dir;if(ni>=0&&ni<arr.length){var t=arr[i];arr[i]=arr[ni];arr[ni]=t;return true;}return false;}
      if(arr[i].children&&moveIn(arr[i].children))return true;
    }
    return false;
  }
  moveIn(_nm.cats); nmRenderCatTree();
}

function nmApplyCatsToNav() {
  // Build nav items from categories (top-level only â†’ with children as sub-items)
  if(!confirm('Esto aÃ±adirÃ¡ las categorÃ­as al menÃº de navegaciÃ³n. Â¿Continuar?')) return;
  _nm.cats.forEach(function(cat){
    var existing = _nm.nav.find(function(n){return n.label===cat.name;});
    if(!existing){
      var navItem = {id:nmGenId(),label:cat.name,linkType:'anchor',anchor:'#'+cat.slug,color:'',style:'normal',emoji:'ðŸ“‚',newTab:false,children:[]};
      if(cat.children){
        cat.children.forEach(function(sub){
          var pages = _nm.pages.filter(function(p){return p.catId===sub.id;});
          navItem.children.push({id:nmGenId(),label:sub.name,linkType:'anchor',anchor:'#'+sub.slug,color:'',style:'normal',emoji:'',newTab:false,children:sub.children?sub.children.map(function(ss){
            return {id:nmGenId(),label:ss.name,linkType:'anchor',anchor:'#'+ss.slug,color:'',style:'normal',emoji:'',newTab:false,children:[]};
          }):[]});
        });
      }
      _nm.nav.push(navItem);
    }
  });
  nmRenderNavTree();
  nmTab('nav');
  nmToast('âœ… CategorÃ­as sincronizadas en navegaciÃ³n');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â”€â”€ GUARDAR TODO                          â”€â”€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function nmSaveAll() {
  nmApplyNav();
  // Save state to a data attribute on body for persistence
  try {
    document.body.setAttribute('data-nm-state', JSON.stringify({nav:_nm.nav,pages:_nm.pages,cats:_nm.cats}));
  } catch(e){}
  edSnapshot && edSnapshot();
  nmToast('âœ… Todo guardado. Usa "ðŸ’¾ Guardar" en el Editor para exportar el HTML.');
}

// â”€â”€ Restaurar estado guardado â”€â”€
(function(){
  var saved = document.body.getAttribute('data-nm-state');
  if(saved){
    try{
      var d=JSON.parse(saved);
      if(d.nav)_nm.nav=d.nav;
      if(d.pages)_nm.pages=d.pages;
      if(d.cats)_nm.cats=d.cats;
    }catch(e){}
  }
})();

// â”€â”€ Toast notifications â”€â”€
function nmToast(msg){
  var t=document.createElement('div');
  t.style.cssText='position:fixed;bottom:140px;left:50%;transform:translateX(-50%);background:#1c1814;color:#3d9e9b;border:1px solid rgba(61,158,155,.3);padding:10px 22px;border-radius:20px;font-size:12px;font-weight:600;z-index:200000;font-family:\'DM Sans\',sans-serif;box-shadow:0 4px 16px rgba(0,0,0,.4);pointer-events:none';
  t.textContent=msg; document.body.appendChild(t);
  setTimeout(function(){if(t.parentNode)t.parentNode.removeChild(t);},3000);
}
</script>
<deepl-input-controller translate="no"></deepl-input-controller>
<protonpass-root-7163 data-protonpass-role="root" data-protonpass-theme="os" popover="manual"></protonpass-root-7163></body></html>
